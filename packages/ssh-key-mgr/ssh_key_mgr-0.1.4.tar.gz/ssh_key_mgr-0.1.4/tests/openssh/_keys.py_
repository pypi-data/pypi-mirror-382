from ssh_key_mgr.putty import (
    EncryptedBytes,
    PuttyFileV3EncryptedAes,
    PuttyFileV3EncryptedNone,
    PuttyKeyEd25519,
    PuttyKeyRSA,
    PuttyPrivateKeyEd25519,
    PuttyPrivateKeyRSA,
    PuttyPublicKeyEd25519,
    PuttyPublicKeyRSA,
)
from ssh_key_mgr.putty.encryption.argon.base import Argon2Params, ArgonID, MemoryCost, Parallelism, Salt, TimeCost
from ssh_key_mgr.putty.macchecksum import Mac
from ssh_key_mgr.secretstr import SecretBytes

PASSPHRASE_ENC = SecretBytes(b"correct horse battery staple")
PASSPHRASE_NONE = None
PASSPHRASE_NONE_ALT = SecretBytes(b"")


""" @dataclasses.dataclass(frozen=True, slots=True)
class PUBLICSECTION:
    CLS
    OBJ
    WIRE


@dataclasses.dataclass(frozen=True, slots=True)
class PRIVATESECTION:
    CLS
    OBJ
    WIRE
    ENC_NONE
    ENC_AES
 """

""" @dataclasses.dataclass(frozen=True, slots=True)
class KeyData:
    KEY_TYPE
    COMMENT
    PUBLIC
    CLS
    OBJ
    FILE_V3_NONE
    FILE_V3_AES
    AES_PARAMS
 """


class RSA_1024:
    # https://www.rfc-editor.org/rfc/rfc9500.html#name-rsa-keys
    KEY_TYPE = "ssh-rsa"
    COMMENT = "testRSA1024"

    class PUBLIC:
        class DATA:
            N = 124166110122983991337731418229841999167986890488136991126459644695937663637108054071234119214658061209219033982063559594860422206527401406163421984469998420544922913916890534314339062844667145883359856186081887902775389730749339136775309884506601471604371451873922100276327703518816242681897912234232574009919
            E = 65537

        CLS = PuttyPublicKeyRSA
        OBJ = PuttyPublicKeyRSA(E=DATA.E, N=DATA.N)
        WIRE = b'\x00\x00\x00\x07ssh-rsa\x00\x00\x00\x03\x01\x00\x01\x00\x00\x00\x81\x00\xb0\xd1\x83R\xa8\x8fS\xd5QoF\xc2\x0ez6}}\xe8\x8a\xcfT\xa0\x19\xf6\xde\xf5z\xb9\xb4L\xed\xdb"B\xb1\xbc\xa0\xfb\x1b\\\xb8+06\x17jc\x905d\xde\xc6\xebA\xdb/\x8f\xc7\x87\xf4\xe5.\x11I\xe33GW)s\xf6`\xc3\xc7|\xa9\xe0\x82\x1c+i[\xe7\xae\x9d}0\xf4\x07\x91\x10\xf4\x8a\xaeo\x8bp-GK)\x00\x81\x7f(f$\x9b\xec\x12\xa2\xb1\x9b\x82xAh\x08\xf8\x1a\xe1\xfc\xf9\xb7w\x8ab?'

    class PRIVATE:
        class DATA:
            D = 50688009982610032565568554607644427510266281155982377292175432720373472282026776914137016120191064125477913776281008795045481723506326155003985409349075135333555250930208896999943793436402173025416065009528317001623325861083349036647037001868439386253544446323125514634028814260359707199682725199871422345873
            IQMP = 9721458286354115561136508670716762220861275896641841230665434115409468173060220159554666387496302638490101614064924388438264332619353455984953340421959387
            P = 12247479110638677755006895685292383938869968447801678697985070722715761107234923761151478498897073403331761752633108460282473931019601399842965881751672901
            Q = 10138095276694782246202662171361003801557508450601288242196414844672242494972243383075875829566498578855752497012485563974824462328158407661799412592304819

        CLS = PuttyPrivateKeyRSA
        OBJ = PuttyPrivateKeyRSA(D=DATA.D, P=DATA.P, Q=DATA.Q, Iqmp=DATA.IQMP)
        WIRE = b"\x00\x00\x00\x80H.\x9f\x8f\xa4\xe4-\xf3\ru\x81\xcbB\xa1\xbd\x90\xe9O\x7f+8~\xcbZ\xae\x96C\xed\x7f\x9fP\x12\x7f\x1f\xfe\xf2\xe4<\xded\xb1\x82`\x02\x14\xf9\x07\x80\x1dk\xfaM\xf6HB4^[\xb42\xd3DE%\xd80\x16T\xc5D+\n^\x11\xb9\xc7\xe2\x01\xfa2\xf4\x1a\xba\xf4\xf0\xa6\xe0<\xf0\xe0\xcb\x82f\xc6*\xd1\x1d\x95mS\xc9FnH\x99_\xea&\x0c\x856\xf0A\xcb5b\xfa\xacQ\x1cMf\xa8\xfe\xd1\x11\xb2\x91\x00\x00\x00A\x00\xe9\xd8nM\xc3J\x98Z~\xc7ZoT\xa7\\\xe4Q9\xe4R@\xb3\x86\xabq\x1d\xb7\x91\xbc\xd9\x87\x18\xa1;\xaf!\x8c$I6Fh\x07V\xcbP\xa6\xcb\xee\x15\x8e%!D\x99\x120\x1c\rAI\x11\x18E\x00\x00\x00A\x00\xc1\x91\xfa;U\x0b9\x1a|\xb0r\x83v'r\x95\xe6\x1ceO\x0b\xef/X\xdc\xe5\xc9b\xa1\x0b}\xd7_\x06\x01Te\xe5Pv\xe4f&>\xeb\xca\xed \xd2\xeb\xab91>\x8b\xc5g2\x0f\xe8\xb2\xdcb\xb3\x00\x00\x00A\x00\xb9\x9d\x7f\x8fMME_\x1f\xbaF-\x99\n.\x84\x8cB\x8c\x1e\xbe\xe0\x1d\xc0\x01\x84\xc8\xa7e\x83\xad7\x9fi\xad\xafTuT0\xf6<BS\xd1\xbbx\xcc\x9b\xd22d4\x00\x80\xb8L\x1a\x91}\xe0\x8bn\xdb"
        ENC_NONE = EncryptedBytes(WIRE)
        ENC_AES = EncryptedBytes(
            b'\x0f\x86\xc7\x11w~qf\xa5.\xd6\x01}\xad\xcd\xffd\xfe9\x15\x8f(\xff\xd8\x02l5\xa5\xc6je3\xd3\x8c\x93\x82\x87\xbb\'\xd3x\x9eg\x97\n\xe0\xdc>\x15\xc4\xb7\x1c\xe6D\x88\xa3\x7f\x96\x93\xaf\xb4\x98\x15\xb1\xba\xb9\x815\xe6\xd9\x1eT\x06\x14\x8b\xea\xc3q\xdc7\xcd\x1a\xcf\xd06\xf8\xb3-\xa5\xf5\x82\x9f\xe9\xf1jk\x86;\xcb\x0e\x95rd\xbf%\x1c\xd2&Ny\x96\x9b\xee\xc96\xdfr\x17\xaf\xdf\xbf\xe3\x9ff\xd5\xce\xf4\x7f\xa1\xf8\xe0\x1e\x87j\x80u)Q%k\x97\xbf\x13\xc7\x18bE\xf3\xcc\xbf\xa7\xe8\xc9\x93\x15\xac\xc5\xcb5w\t3<p\xd7?)\xbe\xfe\x19\xac[\x8aJ\t\xc0"v\xf1\xef}?x\x8b\x1d\x80{X_w\xc4i\xf8\x83\x00hkg-\xe7)\xcc\xd8v\xb2\xee\xecA\x96M\x04\xad\xe6\xe4\x14=\xae\xa9\xf6N\xcc{Of\xbf\x9d\x96\xaf_\xbdb\x16\xb3\x02\xead\x1eJ\x17_\x0ba\xc9\xafTn\x16M\x05_w\xfd`\xa5\x9f\x98\xec\x08\xa1\xbaOM2>\xcdg\x0cZ\x81\xff\x16\xa0\xbbU\x9di\xb9\xfe\xc4\x8d\xeb\x18\xff\x96\xeb_\xc0\x8d3U\xf61\x1bF\x9a\x8f\x03_\x97s\x00\xfd\x19\xb4\xd8C\xa2\xaf\xb5`\xfb\xfer\xb8w\xb8\xd9\x08\xf7Y\xb7\x08@B\xd3\xc0\xc4md\x11\xee\x13\x02\x1a\x1f\x1c"S\xf8\xad\x9f\xfb(y\x9d&\nj\xb9\xc4=f'
        )

    CLS = PuttyKeyRSA
    OBJ = PuttyKeyRSA(public=PUBLIC.OBJ, private=PRIVATE.OBJ, comment=COMMENT)
    FILE_V3_NONE = PuttyFileV3EncryptedNone(
        key_type=KEY_TYPE,
        public_lines=PUBLIC.WIRE,
        private_lines=PRIVATE.ENC_NONE,
        comment=COMMENT,
        mac=Mac(
            private_mac=b"\x8b\x0c6\xad\xd1\x82c\xe2\x13\x1e\x94O\xc4\xa7\xe1MW\x9e\xae\xbd\x96IW\x7f|\xb1\x85\xc5\xf5Wc\xe5"
        ),
    )
    FILE_V3_AES = PuttyFileV3EncryptedAes(
        key_type=KEY_TYPE,
        public_lines=PUBLIC.WIRE,
        key_derivation=ArgonID.ID,
        argon2_memory=MemoryCost(8192),
        argon2_passes=TimeCost(21),
        argon2_parallelism=Parallelism(1),
        argon2_salt=Salt(b"\x01\x02\x03\x04\x05\x06\x07\x08\t\n\x0b\x0c\r\x0e\x0f\x10"),
        private_lines=PRIVATE.ENC_AES,
        comment=COMMENT,
        mac=Mac(
            private_mac=b"\xf54_\xc5n{\xc6\xb8\xa1\xa1\x1c\x13\x90\x80\xb6\xe1l\xed\xbd\x80\xb603sQ\xa8\x8e>\xad\xe6c4"
        ),
    )
    AES_PARAMS = Argon2Params(
        key_derivation=ArgonID.ID,
        argon2_memory=MemoryCost(8192),
        argon2_passes=TimeCost(21),
        argon2_parallelism=Parallelism(1),
    )


class ED25519:
    # https://www.rfc-editor.org/rfc/rfc8032.html#section-7.1
    KEY_TYPE = "ssh-ed25519"
    COMMENT = "RFC8032 Test Vector 1"

    class PUBLIC:
        class DATA:
            BYTES = bytes.fromhex("d75a980182b10ab7d54bfed3c964073a0ee172f3daa62325af021a68f707511a")

        CLS = PuttyPublicKeyEd25519
        OBJ = CLS(key=DATA.BYTES)
        WIRE = b"\x00\x00\x00\x0bssh-ed25519\x00\x00\x00 " + DATA.BYTES

    class PRIVATE:
        class DATA:
            BYTES = bytes.fromhex("9d61b19deffd5a60ba844af492ec2cc44449c5697b326919703bac031cae7f60")

        CLS = PuttyPrivateKeyEd25519
        OBJ = CLS(key=DATA.BYTES)
        WIRE = b"\x00\x00\x00 \x9da\xb1\x9d\xef\xfdZ`\xba\x84J\xf4\x92\xec,\xc4DI\xc5i{2i\x19p;\xac\x03\x1c\xae\x7f`"
        ENC_NONE = EncryptedBytes(WIRE)
        ENC_AES = EncryptedBytes(
            b"^\xff]x\x97\x06`3\x84 \xaf\x07\x94{q\xff!\x1f3v\x8e\x7f\\\xad\xaaV\xff\r\xb7\xb1\x105\xc2Y4\x1c#d\xe82\xedq?z/\x0c\xe7\x84"
        )

    CLS = PuttyKeyEd25519
    OBJ = PuttyKeyEd25519(public=PUBLIC.OBJ, private=PRIVATE.OBJ, comment=COMMENT)
    FILE_V3_NONE = PuttyFileV3EncryptedNone(
        key_type=KEY_TYPE,
        public_lines=PUBLIC.WIRE,
        private_lines=PRIVATE.ENC_NONE,
        comment=COMMENT,
        mac=Mac(
            private_mac=b"vF\x18\xaa\xe8\xffG\x81\xe2q\x81\xdc\x01\xf8\xc7\x06\x0c\xe6z\x9e\x10a1\xfe\xfa\xd2\x9fh\x94[PH"
        ),
    )
    FILE_V3_AES = PuttyFileV3EncryptedAes(
        key_type=KEY_TYPE,
        public_lines=PUBLIC.WIRE,
        key_derivation=ArgonID.ID,
        argon2_memory=MemoryCost(8192),
        argon2_passes=TimeCost(21),
        argon2_parallelism=Parallelism(1),
        argon2_salt=Salt(b"\x01\x02\x03\x04\x05\x06\x07\x08\t\n\x0b\x0c\r\x0e\x0f\x10"),
        private_lines=PRIVATE.ENC_AES,
        comment=COMMENT,
        mac=Mac(private_mac=b"\x177&\x98\x87I@\x11\xc8\x14\xcb,i5=\x1b/\x81\xd6\x1d\x98O\xed#Un\x10\xe8\xc6#d\xed"),
    )
    AES_PARAMS = Argon2Params(
        key_derivation=ArgonID.ID,
        argon2_memory=MemoryCost(8192),
        argon2_passes=TimeCost(21),
        argon2_parallelism=Parallelism(1),
    )


KEYS = (RSA_1024, ED25519)

KeyData = RSA_1024 | ED25519
