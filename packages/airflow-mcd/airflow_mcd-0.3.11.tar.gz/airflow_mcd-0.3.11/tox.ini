[tox]
envlist =
    py38-airflow1,
    py39-airflow2, py310-airflow2, py311-airflow2, py312-airflow2,
    py310-airflow3, py311-airflow3, py312-airflow3,
    py310-airflow31, py311-airflow31, py312-airflow31

[testenv]
deps =
    -rrequirements.txt
    -rrequirements-dev.txt
commands =
    pytest --ignore=~/airflow/dags/ --cov=airflow_mcd --cov-report=xml --cov-report=term-missing {posargs}

# Airflow 1.x
[testenv:py38-airflow1]
basepython = python3.8
deps =
    pip==20.2.4
    apache-airflow==1.10.14
    pendulum<3.0
    markupsafe<2.1.0
    {[testenv]deps}
setenv =
    AIRFLOW__CORE__EXECUTOR=SequentialExecutor
    AIRFLOW__CORE__DAGBAG_IMPORT_TIMEOUT=30
    AIRFLOW__CORE__XCOM_BACKEND=

[testenv:py39-airflow2]
basepython = python3.9
deps =
    apache-airflow==2.7.3
    pendulum<3.0
    {[testenv]deps}
setenv =
    AIRFLOW__CORE__XCOM_BACKEND=airflow.models.xcom.BaseXCom

[testenv:py310-airflow2]
basepython = python3.10
deps =
    apache-airflow==2.7.3
    pendulum<3.0
    {[testenv]deps}
setenv =
    AIRFLOW__CORE__XCOM_BACKEND=airflow.models.xcom.BaseXCom

[testenv:py311-airflow2]
basepython = python3.11
deps =
    apache-airflow==2.7.3
    pendulum<3.0
    {[testenv]deps}
setenv =
    AIRFLOW__CORE__XCOM_BACKEND=airflow.models.xcom.BaseXCom

# Note: Python 3.12 is only supported in higher versions of Airflow 2 so we test it in Airflow 2.11.0
[testenv:py312-airflow2]
basepython = python3.12
deps =
    apache-airflow==2.11.0
    {[testenv]deps}
setenv =
    AIRFLOW__CORE__XCOM_BACKEND=airflow.models.xcom.BaseXCom

# Airflow 3.x
[testenv:py310-airflow3]
basepython = python3.10
deps =
    apache-airflow==3.0.3
    pendulum>=3.0
    {[testenv]deps}

[testenv:py311-airflow3]
basepython = python3.11
deps =
    apache-airflow==3.0.3
    pendulum>=3.0
    {[testenv]deps}

[testenv:py312-airflow3]
basepython = python3.12
deps =
    apache-airflow==3.0.3
    pendulum>=3.0
    {[testenv]deps}

# Airflow 3.1.x (latest stable as of Oct 2025)
[testenv:py310-airflow31]
basepython = python3.10
deps =
    apache-airflow==3.1.0
    pendulum>=3.0
    {[testenv]deps}

[testenv:py311-airflow31]
basepython = python3.11
deps =
    apache-airflow==3.1.0
    pendulum>=3.0
    {[testenv]deps}

[testenv:py312-airflow31]
basepython = python3.12
deps =
    apache-airflow==3.1.0
    pendulum>=3.0
    {[testenv]deps} 