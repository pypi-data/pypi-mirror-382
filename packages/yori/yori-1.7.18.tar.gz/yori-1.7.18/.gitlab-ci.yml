stages:
  - test
  - deploy

test:
  stage: test
  tags:
    - ssec_shared
  image: mambaorg/micromamba:1.3.1
  script:
    - micromamba install -y hatch libnetcdf -c conda-forge
    - hatch run pytest -xv

deploy:
  stage: deploy
  only:
    - /^[0-9]+\.[0-9]+\.[0-9]+$/
  tags:
    - ssec_shared
  image: python:3.10
  before_script:
    - pip install hatch twine
  script:
    - hatch build
    - twine upload -u __token__ -p $PYPI_PASSWORD dist/*.whl --non-interactive
