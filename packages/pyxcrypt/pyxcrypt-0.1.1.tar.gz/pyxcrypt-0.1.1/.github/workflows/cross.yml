---
name: check_on_linux
on: [push, pull_request]

jobs:
  check_development:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        release:
          - bionic
          - focal
          - jammy
          - noble
          - plucky
          - questing
    steps:
      - uses: actions/checkout@v5
        with:
          ref: development
      - run: sudo apt-get update
      - run: sudo apt-get install libcrypt-dev meson
      - name: Prepare
        run: meson linux_build
      - name: Run tests
        run: meson test -C linux_build
      - name: Print log on failure
        if: failure()
        run: cat linux_build/meson-logs/testlog.txt
  check_master:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        release:
          - bionic
          - focal
          - jammy
          - noble
          - plucky
          - questing
    steps:
      - run: sudo apt-get update
      - run: sudo apt-get install libcrypt-dev
      - uses: actions/checkout@v5
      - uses: actions/setup-python@v6
        with:
          python-version: "3.13"
          check-latest: true
      - name: Build and install wheel
        run: pip install .
      - name: Run tests
        run: python3 -m unittest discover -s tests/ -v
  check_pypi:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        release:
          - bionic
          - focal
          - jammy
          - noble
          - plucky
          - questing
    steps:
      - run: sudo apt-get update
      - run: sudo apt-get install libcrypt-dev
      - uses: actions/checkout@v5
      - uses: actions/setup-python@v6
        with:
          python-version: "3.13"
          check-latest: true
      - name: Build and install wheel
        run: pip3 install pyxcrypt
      - name: Run tests
        run: python3 -m unittest discover -s tests/ -v
