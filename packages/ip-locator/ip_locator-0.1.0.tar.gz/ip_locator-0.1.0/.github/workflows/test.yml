name: Test and Validate

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install uv
      run: pip install uv
    
    - name: Install dependencies
      run: uv sync
    
    - name: Validate project structure
      run: uv run python -c "import sys; print(f'Python {sys.version}')"
    
    - name: Test dependencies
      run: |
        uv run python -c "
        import requests
        import json
        print('✓ All dependencies imported successfully')
        "
    
    - name: Test IP locator module
      run: |
        uv run python -c "
        from tracker import track_ip
        print('✓ IP locator module imported successfully')
        "
    
    - name: Check file structure
      run: |
        ls -la
        ls -la src/
        ls -la src/tracker/
        echo '✓ File structure validated'
    
    - name: Test PyInstaller build
      run: |
        uv sync --all-extras
        uv run pyinstaller --onefile --name "test-ip-locator" main.py
        ls -la dist/
        echo '✓ PyInstaller build successful'

