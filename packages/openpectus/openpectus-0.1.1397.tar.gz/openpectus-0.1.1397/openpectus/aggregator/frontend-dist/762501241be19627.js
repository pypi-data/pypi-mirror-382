var _asyncToGenerator=require("/home/runner/work/Open-Pectus/Open-Pectus/frontend/node_modules/@babel/runtime/helpers/asyncToGenerator.js").default;const sw=self,VERSION=4,resourceCacheName="vscode-resource-cache-4",rootPath=sw.location.pathname.replace(/\/service-worker.js$/,""),searchParams=new URL(location.toString()).searchParams,remoteAuthority=searchParams.get("remoteAuthority"),ID=searchParams.get("id"),resourceBaseAuthority=searchParams.get("vscode-resource-base-authority"),resolveTimeout=3e4;class RequestStore{constructor(){this.map=new Map,this.requestPool=0}create(){const t=++this.requestPool;let r;const s=new Promise(c=>r=c),i={resolve:r,promise:s};this.map.set(t,i);const l=setTimeout(()=>{clearTimeout(l);const c=this.map.get(t);if(c===i)return c.resolve({status:"timeout"}),void this.map.delete(t)},3e4);return{requestId:t,promise:s}}resolve(t,r){const s=this.map.get(t);return!!s&&(s.resolve({status:"ok",value:r}),this.map.delete(t),!0)}}const resourceRequestStore=new RequestStore,localhostRequestStore=new RequestStore,unauthorized=()=>new Response("Unauthorized",{status:401}),notFound=()=>new Response("Not Found",{status:404}),methodNotAllowed=()=>new Response("Method Not Allowed",{status:405}),requestTimeout=()=>new Response("Request Timeout",{status:408});function processResourceRequest(e,t){return _processResourceRequest.apply(this,arguments)}function _processResourceRequest(){return(_processResourceRequest=_asyncToGenerator(function*(e,t){const r=yield sw.clients.get(e.clientId);let s;if(r)s=getWebviewIdForClient(r);else{const n=yield getWorkerClientForId(e.clientId);if(!n)return console.error("Could not find inner client for request"),notFound();s=getWebviewIdForClient(n)}if(!s)return console.error("Could not resolve webview id"),notFound();const i="GET"===e.request.method,l=yield getOuterIframeClient(s);if(!l.length)return console.log("Could not find parent client for request"),notFound();let c;i&&(c=yield(yield caches.open(resourceCacheName)).match(e.request));const{requestId:f,promise:u}=resourceRequestStore.create();for(const n of l)n.postMessage({channel:"load-resource",id:f,scheme:t.scheme,authority:t.authority,path:t.path,query:t.query,ifNoneMatch:c?.headers.get("ETag")});return u.then(n=>((n,d)=>{if("timeout"===n.status)return requestTimeout();const o=n.value;if(304===o.status){if(d)return d.clone();throw new Error("No cache found")}if(401===o.status)return unauthorized();if(200!==o.status)return notFound();const m={"Access-Control-Allow-Origin":"*"},g=o.data.byteLength,w=e.request.headers.get("range");if(w){const h=w.match(/^bytes\=(\d+)\-(\d+)?$/g);if(h){const R=Number(h[1]),q=Number(h[2])||g-1;return new Response(o.data.slice(R,q+1),{status:206,headers:{...m,"Content-range":`bytes 0-${q}/${g}`}})}return new Response(null,{status:416,headers:{...m,"Content-range":`*/${g}`}})}const a={...m,"Content-Type":o.mime,"Content-Length":g.toString()};o.etag&&(a.ETag=o.etag,a["Cache-Control"]="no-cache"),o.mtime&&(a["Last-Modified"]=new Date(o.mtime).toUTCString());const y=new URL(e.request.url).searchParams.get("vscode-coi");"3"===y?(a["Cross-Origin-Opener-Policy"]="same-origin",a["Cross-Origin-Embedder-Policy"]="require-corp"):"2"===y?a["Cross-Origin-Embedder-Policy"]="require-corp":"1"===y&&(a["Cross-Origin-Opener-Policy"]="same-origin");const C=new Response(o.data,{status:200,headers:a});return i&&o.etag&&caches.open(resourceCacheName).then(h=>h.put(e.request,C)),C.clone()})(n,c))})).apply(this,arguments)}function processLocalhostRequest(e,t){return _processLocalhostRequest.apply(this,arguments)}function _processLocalhostRequest(){return _processLocalhostRequest=_asyncToGenerator(function*(e,t){const r=yield sw.clients.get(e.clientId);if(!r)return fetch(e.request);const s=getWebviewIdForClient(r);if(!s)return console.error("Could not resolve webview id"),fetch(e.request);const i=t.origin,p=function(){var u=_asyncToGenerator(function*(n){if("ok"!==n.status||!n.value)return fetch(e.request);const d=n.value,o=e.request.url.replace(new RegExp(`^${t.origin}(/|$)`),`${d}$1`);return new Response(null,{status:302,headers:{Location:o}})});return function(d){return u.apply(this,arguments)}}(),l=yield getOuterIframeClient(s);if(!l.length)return console.log("Could not find parent client for request"),notFound();const{requestId:c,promise:f}=localhostRequestStore.create();for(const u of l)u.postMessage({channel:"load-localhost",origin:i,id:c});return f.then(p)}),_processLocalhostRequest.apply(this,arguments)}function getWebviewIdForClient(e){return"worker"===e.type||"sharedworker"===e.type?ID:new URL(e.url).searchParams.get("id")}function getOuterIframeClient(e){return _getOuterIframeClient.apply(this,arguments)}function _getOuterIframeClient(){return(_getOuterIframeClient=_asyncToGenerator(function*(e){return(yield sw.clients.matchAll({includeUncontrolled:!0})).filter(r=>new URL(r.url).searchParams.get("id")===e)})).apply(this,arguments)}function getWorkerClientForId(e){return _getWorkerClientForId.apply(this,arguments)}function _getWorkerClientForId(){return(_getWorkerClientForId=_asyncToGenerator(function*(e){return[...yield sw.clients.matchAll({type:"worker"}),...yield sw.clients.matchAll({type:"sharedworker"})].find(i=>i.id===e)})).apply(this,arguments)}sw.addEventListener("message",function(){var e=_asyncToGenerator(function*(t){switch(t.data.channel){case"version":return void sw.clients.get(t.source.id).then(s=>{s&&s.postMessage({channel:"version",version:4})});case"did-load-resource":{const r=t.data.data;return void(resourceRequestStore.resolve(r.id,r)||console.log("Could not resolve unknown resource",r.path))}case"did-load-localhost":{const r=t.data.data;return void(localhostRequestStore.resolve(r.id,r.location)||console.log("Could not resolve unknown localhost",r.origin))}default:return void console.log("Unknown message")}});return function(t){return e.apply(this,arguments)}}()),sw.addEventListener("fetch",e=>{const t=new URL(e.request.url);if("string"==typeof resourceBaseAuthority&&"https:"===t.protocol&&t.hostname.endsWith("."+resourceBaseAuthority))switch(e.request.method){case"GET":case"HEAD":{const r=t.hostname.slice(0,t.hostname.length-(resourceBaseAuthority.length+1)),s=r.split("+",1)[0],i=r.slice(s.length+1);return e.respondWith(processResourceRequest(e,{scheme:s,authority:i,path:t.pathname,query:t.search.replace(/^\?/,"")}))}default:return e.respondWith(methodNotAllowed())}if(t.origin!==sw.origin&&t.host===remoteAuthority)switch(e.request.method){case"GET":case"HEAD":return e.respondWith(processResourceRequest(e,{path:t.pathname,scheme:t.protocol.slice(0,t.protocol.length-1),authority:t.host,query:t.search.replace(/^\?/,"")}));default:return e.respondWith(methodNotAllowed())}if(t.origin!==sw.origin&&t.host.match(/^(localhost|127.0.0.1|0.0.0.0):(\d+)$/))return e.respondWith(processLocalhostRequest(e,t))}),sw.addEventListener("install",e=>{e.waitUntil(sw.skipWaiting())}),sw.addEventListener("activate",e=>{e.waitUntil(sw.clients.claim())});