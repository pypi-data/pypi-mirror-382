"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[837],{27895:(Q,Y,d)=>{d.d(Y,{x:()=>$});var T,O=d(10467),g=d(38035),L=d(98039),u=d(51627),N=d(38743),F=d(90498),_=d(70976),W=d(96459),K=d(18438),M=d(48738),G=d(48408),B=d(53899),A=d(84736),m=d(84946),C=d(84169),P=d(36376),R=d(19657),n=d(81856),h=d(52814),v=d(37106),E=d(21030),V=(d(79758),d(93319)),p=d(75864),b=d(57430),f=d(88039),I=d(51890);let z=class extends h.jG{static{T=this}static{this.STORAGE_KEY="editors.mru"}get count(){return this.mostRecentEditorsMap.size}get editors(){return[...this.mostRecentEditorsMap.values()]}hasEditor(e){return this.editorsPerResourceCounter.get(e.resource)?.has(this.toIdentifier(e))??!1}hasEditors(e){return this.editorsPerResourceCounter.has(e)}toIdentifier(e,o){return"string"!=typeof e?this.toIdentifier(e.typeId,e.editorId):o?`${e}/${o}`:e}constructor(e,o,t){super(),this.editorGroupService=o,this.storageService=t,this.keyMap=new Map,this.mostRecentEditorsMap=new _.I4,this.editorsPerResourceCounter=new _.fT,this._onDidMostRecentlyActiveEditorsChange=this._register(new M.vl),this.onDidMostRecentlyActiveEditorsChange=this._onDidMostRecentlyActiveEditorsChange.event,this.editorGroupsContainer=e??o,this.isScoped=!!e,this.registerListeners(),this.loadState()}registerListeners(){this._register(this.editorGroupsContainer.onDidAddGroup(e=>this.onGroupAdded(e))),this._register(this.editorGroupService.onDidChangeEditorPartOptions(e=>this.onDidChangeEditorPartOptions(e))),this._register(this.storageService.onWillSaveState(()=>this.saveState()))}onGroupAdded(e){const o=e.getEditors(u.bS.MOST_RECENTLY_ACTIVE);for(let t=o.length-1;t>=0;t--)this.addMostRecentEditor(e,o[t],!1,!0);this.editorGroupsContainer.activeGroup===e&&e.activeEditor&&this.addMostRecentEditor(e,e.activeEditor,!0,!1),this.registerGroupListeners(e)}registerGroupListeners(e){const o=new h.Cm;o.add(e.onDidModelChange(t=>{switch(t.kind){case u.LO.GROUP_ACTIVE:this.editorGroupsContainer.activeGroup===e&&e.activeEditor&&this.addMostRecentEditor(e,e.activeEditor,!0,!1);break;case u.LO.EDITOR_OPEN:t.editor&&(this.addMostRecentEditor(e,t.editor,!1,!0),this.ensureOpenedEditorsLimit({groupId:e.id,editor:t.editor},e.id))}})),o.add(e.onDidCloseEditor(t=>{this.removeMostRecentEditor(e,t.editor)})),o.add(e.onDidActiveEditorChange(t=>{t.editor&&this.addMostRecentEditor(e,t.editor,this.editorGroupsContainer.activeGroup===e,!1)})),M.Jh.once(e.onWillDispose)(()=>(0,h.AS)(o))}onDidChangeEditorPartOptions(e){if(!(0,I.aI)(e.newPartOptions.limit,e.oldPartOptions.limit)){const o=this.editorGroupsContainer.activeGroup;let t;o.activeEditor&&(t={editor:o.activeEditor,groupId:o.id}),this.ensureOpenedEditorsLimit(t)}}addMostRecentEditor(e,o,t,s){const r=this.ensureKey(e,o),c=this.mostRecentEditorsMap.first;t||!c?this.mostRecentEditorsMap.set(r,r,c?_.Up.AsOld:void 0):(this.mostRecentEditorsMap.set(r,r,_.Up.AsOld),this.mostRecentEditorsMap.set(c,c,_.Up.AsOld)),s&&this.updateEditorResourcesMap(o,!0),this._onDidMostRecentlyActiveEditorsChange.fire()}updateEditorResourcesMap(e,o){let t,s,r;if(e instanceof F.JL?(t=e.primary.resource,s=e.primary.typeId,r=e.primary.editorId):(t=e.resource,s=e.typeId,r=e.editorId),!t)return;const c=this.toIdentifier(s,r);if(o){let a=this.editorsPerResourceCounter.get(t);a||(a=new Map,this.editorsPerResourceCounter.set(t,a)),a.set(c,(a.get(c)??0)+1)}else{const a=this.editorsPerResourceCounter.get(t);if(a){const l=a.get(c)??0;l>1?a.set(c,l-1):(a.delete(c),0===a.size&&this.editorsPerResourceCounter.delete(t))}}}removeMostRecentEditor(e,o){this.updateEditorResourcesMap(o,!1);const t=this.findKey(e,o);if(t){this.mostRecentEditorsMap.delete(t);const s=this.keyMap.get(e.id);s&&s.delete(t.editor)&&0===s.size&&this.keyMap.delete(e.id),this._onDidMostRecentlyActiveEditorsChange.fire()}}findKey(e,o){const t=this.keyMap.get(e.id);if(t)return t.get(o)}ensureKey(e,o){let t=this.keyMap.get(e.id);t||(t=new Map,this.keyMap.set(e.id,t));let s=t.get(o);return s||(s={groupId:e.id,editor:o},t.set(o,s)),s}ensureOpenedEditorsLimit(e,o){var t=this;return(0,O.A)(function*(){if(!t.editorGroupService.partOptions.limit?.enabled||"number"!=typeof t.editorGroupService.partOptions.limit.value||t.editorGroupService.partOptions.limit.value<=0)return;const s=t.editorGroupService.partOptions.limit.value;if(t.editorGroupService.partOptions.limit?.perEditorGroup)if("number"==typeof o){const r=t.editorGroupsContainer.getGroup(o);r&&(yield t.doEnsureOpenedEditorsLimit(s,r.getEditors(u.bS.MOST_RECENTLY_ACTIVE).map(c=>({editor:c,groupId:o})),e))}else for(const r of t.editorGroupsContainer.groups)yield t.ensureOpenedEditorsLimit(e,r.id);else yield t.doEnsureOpenedEditorsLimit(s,[...t.mostRecentEditorsMap.values()],e)})()}doEnsureOpenedEditorsLimit(e,o,t){var s=this;return(0,O.A)(function*(){let r;if(r=s.editorGroupService.partOptions.limit?.excludeDirty?o.filter(({editor:S})=>!(S.isDirty()&&!S.isSaving()||S.hasCapability(u.oG.Scratchpad))):o,e>=r.length)return;const c=r.reverse().filter(({editor:S,groupId:D})=>!(S.isDirty()&&!S.isSaving()||S.hasCapability(u.oG.Scratchpad)||t&&S===t.editor&&D===t.groupId||s.editorGroupsContainer.getGroup(D)?.isSticky(S)));let a=r.length-e;const l=new Map;for(const{groupId:S,editor:D}of c){let x=l.get(S);if(x||(x=[],l.set(S,x)),x.push(D),a--,0===a)break}for(const[S,D]of l){const x=s.editorGroupsContainer.getGroup(S);x&&(yield x.closeEditors(D,{preserveFocus:!0}))}})()}saveState(){this.isScoped||(this.mostRecentEditorsMap.isEmpty()?this.storageService.remove(T.STORAGE_KEY,p.YM.WORKSPACE):this.storageService.store(T.STORAGE_KEY,JSON.stringify(this.serialize()),p.YM.WORKSPACE,p.vi.MACHINE))}serialize(){const e=f.O.as(u.q5.EditorFactory),o=[...this.mostRecentEditorsMap.values()],t=new Map;return{entries:(0,v.Yc)(o.map(({editor:s,groupId:r})=>{const c=this.editorGroupsContainer.getGroup(r);if(!c)return;let a=t.get(c);a||(a=c.getEditors(u.bS.SEQUENTIAL).filter(S=>e.getEditorSerializer(S)?.canSerialize(S)),t.set(c,a));const l=a.indexOf(s);return-1!==l?{groupId:r,index:l}:void 0}))}}loadState(){var e=this;return(0,O.A)(function*(){(e.editorGroupsContainer===e.editorGroupService.mainPart||e.editorGroupsContainer===e.editorGroupService)&&(yield e.editorGroupService.whenReady);let o=!1;if(!e.isScoped){const t=e.storageService.get(T.STORAGE_KEY,p.YM.WORKSPACE);t&&(o=!0,e.deserialize(JSON.parse(t)))}if(!o){const t=e.editorGroupsContainer.getGroups(C.L0.MOST_RECENTLY_ACTIVE);for(let s=t.length-1;s>=0;s--){const r=t[s],c=r.getEditors(u.bS.MOST_RECENTLY_ACTIVE);for(let a=c.length-1;a>=0;a--)e.addMostRecentEditor(r,c[a],!0,!0)}}for(const t of e.editorGroupsContainer.groups)e.registerGroupListeners(t)})()}deserialize(e){const o=[];for(const{groupId:t,index:s}of e.entries){const r=this.editorGroupsContainer.getGroup(t);if(!r)continue;const c=r.getEditorByIndex(s);if(!c)continue;const a=this.ensureKey(r,c);o.push([a,a]),this.updateEditorResourcesMap(c,!0)}this.mostRecentEditorsMap.fromJSON(o)}};z=T=(0,g.C)([(0,g.Q)(1,P.m),(0,g.Q)(2,b.C)],z);var J,U=d(23838),X=d(75158),Z=d(68110),q=d(40660),w=d(10515),ee=d(56206),k=d(68473),te=d(95368),ie=d(46836),j=d(79360),oe=d(65125);let $=J=class extends h.jG{constructor(i,e,o,t,s,r,c,a,l,S,D){super(),this.editorGroupService=e,this.instantiationService=o,this.fileService=t,this.configurationService=s,this.contextService=r,this.uriIdentityService=c,this.editorResolverService=a,this.workspaceTrustRequestService=l,this.hostService=S,this.textEditorService=D,this._onDidActiveEditorChange=this._register(new M.vl),this.onDidActiveEditorChange=this._onDidActiveEditorChange.event,this._onDidVisibleEditorsChange=this._register(new M.vl),this.onDidVisibleEditorsChange=this._onDidVisibleEditorsChange.event,this._onDidEditorsChange=this._register(new M.vl),this.onDidEditorsChange=this._onDidEditorsChange.event,this._onWillOpenEditor=this._register(new M.vl),this.onWillOpenEditor=this._onWillOpenEditor.event,this._onDidCloseEditor=this._register(new M.vl),this.onDidCloseEditor=this._onDidCloseEditor.event,this._onDidOpenEditorFail=this._register(new M.vl),this.onDidOpenEditorFail=this._onDidOpenEditorFail.event,this._onDidMostRecentlyActiveEditorsChange=this._register(new M.vl),this.onDidMostRecentlyActiveEditorsChange=this._onDidMostRecentlyActiveEditorsChange.event,this.lastActiveEditor=void 0,this.activeOutOfWorkspaceWatchers=new _.fT,this.closeOnFileDelete=!1,this.editorGroupsContainer=i??e,this.editorsObserver=this._register(this.instantiationService.createInstance(z,this.editorGroupsContainer)),this.onConfigurationUpdated(),this.registerListeners()}createScoped(i,e){return e.add(new J("main"===i?this.editorGroupService.mainPart:i,this.editorGroupService,this.instantiationService,this.fileService,this.configurationService,this.contextService,this.uriIdentityService,this.editorResolverService,this.workspaceTrustRequestService,this.hostService,this.textEditorService))}registerListeners(){this.editorGroupsContainer===this.editorGroupService.mainPart||this.editorGroupsContainer===this.editorGroupService?this.editorGroupService.whenReady.then(()=>this.onEditorGroupsReady()):this.onEditorGroupsReady(),this._register(this.editorGroupsContainer.onDidChangeActiveGroup(i=>this.handleActiveEditorChange(i))),this._register(this.editorGroupsContainer.onDidAddGroup(i=>this.registerGroupListeners(i))),this._register(this.editorsObserver.onDidMostRecentlyActiveEditorsChange(()=>this._onDidMostRecentlyActiveEditorsChange.fire())),this._register(this.onDidVisibleEditorsChange(()=>this.handleVisibleEditorsChange())),this._register(this.fileService.onDidRunOperation(i=>this.onDidRunFileOperation(i))),this._register(this.fileService.onDidFilesChange(i=>this.onDidFilesChange(i))),this._register(this.configurationService.onDidChangeConfiguration(i=>this.onConfigurationUpdated(i)))}onEditorGroupsReady(){for(const i of this.editorGroupsContainer.groups)this.registerGroupListeners(i);this.activeEditor&&(this.doHandleActiveEditorChangeEvent(),this._onDidVisibleEditorsChange.fire())}handleActiveEditorChange(i){i===this.editorGroupsContainer.activeGroup&&(!this.lastActiveEditor&&!i.activeEditor||this.doHandleActiveEditorChangeEvent())}doHandleActiveEditorChangeEvent(){this.lastActiveEditor=this.editorGroupsContainer.activeGroup.activeEditor??void 0,this._onDidActiveEditorChange.fire()}registerGroupListeners(i){const e=new h.Cm;e.add(i.onDidModelChange(o=>{this._onDidEditorsChange.fire({groupId:i.id,event:o})})),e.add(i.onDidActiveEditorChange(()=>{this.handleActiveEditorChange(i),this._onDidVisibleEditorsChange.fire()})),e.add(i.onWillOpenEditor(o=>{this._onWillOpenEditor.fire(o)})),e.add(i.onDidCloseEditor(o=>{this._onDidCloseEditor.fire(o)})),e.add(i.onDidOpenEditorFail(o=>{this._onDidOpenEditorFail.fire({editor:o,groupId:i.id})})),M.Jh.once(i.onWillDispose)(()=>{(0,h.AS)(e)})}handleVisibleEditorsChange(){const i=new _.rm;for(const e of this.visibleEditors){const o=(0,v.dM)((0,v.Yc)([u.tf.getCanonicalUri(e,{supportSideBySide:u.zX.PRIMARY}),u.tf.getCanonicalUri(e,{supportSideBySide:u.zX.SECONDARY})]),t=>t.toString());for(const t of o)this.fileService.hasProvider(t)&&!this.contextService.isInsideWorkspace(t)&&i.add(t)}for(const e of this.activeOutOfWorkspaceWatchers.keys())i.has(e)||((0,h.AS)(this.activeOutOfWorkspaceWatchers.get(e)),this.activeOutOfWorkspaceWatchers.delete(e));for(const e of i.keys())if(!this.activeOutOfWorkspaceWatchers.get(e)){const o=this.fileService.watch(e);this.activeOutOfWorkspaceWatchers.set(e,o)}}onDidRunFileOperation(i){var e=this;return(0,O.A)(function*(){i.isOperation(W.a4.MOVE)&&e.handleMovedFile(i.resource,i.target.resource),(i.isOperation(W.a4.DELETE)||i.isOperation(W.a4.MOVE))&&e.handleDeletedFile(i.resource,!1,i.target?i.target.resource:void 0)})()}onDidFilesChange(i){i.gotDeleted()&&this.handleDeletedFile(i,!0)}handleMovedFile(i,e){var o=this;return(0,O.A)(function*(){for(const t of o.editorGroupsContainer.groups){const s=[];for(const r of t.editors){const c=r.resource;if(!c||!o.uriIdentityService.extUri.isEqualOrParent(c,i))continue;let a;if(o.uriIdentityService.extUri.isEqual(i,c))a=e;else{const D=(0,Z.p4)(c.path,i.path,o.uriIdentityService.extUri.ignorePathCasing(c));a=(0,B.uJ)(e,c.path.substr(D+i.path.length+1))}const l=yield r.rename(t.id,a);if(!l)return;const S={preserveFocus:!0,pinned:t.isPinned(r),sticky:t.isSticky(r),index:t.getIndexOfEditor(r),inactive:!t.isActive(r)};(0,u.ct)(l.editor)?s.push({editor:r,replacement:l.editor,options:{...l.options,...S}}):s.push({editor:r,replacement:{...l.editor,options:{...l.editor.options,...S}}})}s.length&&o.replaceEditors(s,t)}})()}onConfigurationUpdated(i){if(i&&!i.affectsConfiguration("workbench.editor.closeOnFileDelete"))return;const e=this.configurationService.getValue();this.closeOnFileDelete="boolean"==typeof e.workbench?.editor?.closeOnFileDelete&&e.workbench.editor.closeOnFileDelete}handleDeletedFile(i,e,o){var t=this;for(const s of this.getAllNonDirtyEditors({includeUntitled:!1,supportSideBySide:!0}))(0,O.A)(function*(){const r=s.resource;if(r&&(t.closeOnFileDelete||!e)){if(o&&t.uriIdentityService.extUri.isEqualOrParent(r,o))return;let c=!1;if(c=i instanceof W.Qt?i.contains(r,W.Jx.DELETED):t.uriIdentityService.extUri.isEqualOrParent(r,i),!c)return;let a=!1;e&&t.fileService.hasProvider(r)&&(yield(0,U.wR)(100),a=yield t.fileService.exists(r)),!a&&!s.isDisposed()&&s.dispose()}})()}getAllNonDirtyEditors(i){const e=[];function o(t){t.hasCapability(u.oG.Untitled)&&!i.includeUntitled||t.isDirty()||e.push(t)}for(const t of this.editors)i.supportSideBySide&&t instanceof F.JL?(o(t.primary),o(t.secondary)):o(t);return e}get activeEditorPane(){return this.editorGroupsContainer.activeGroup?.activeEditorPane}get activeTextEditorControl(){const i=this.activeEditorPane;if(i){const e=i.getControl();if((0,E.z9)(e)||(0,E.Np)(e))return e;if((0,E.Pf)(e)&&(0,E.z9)(e.activeCodeEditor))return e.activeCodeEditor}}get activeTextEditorLanguageId(){let i;const e=this.activeTextEditorControl;return i=(0,E.Np)(e)?e.getModifiedEditor():e,i?.getModel()?.getLanguageId()}get count(){return this.editorsObserver.count}get editors(){return this.getEditors(u.bS.SEQUENTIAL).map(({editor:i})=>i)}getEditors(i,e){switch(i){case u.bS.MOST_RECENTLY_ACTIVE:return e?.excludeSticky?this.editorsObserver.editors.filter(({groupId:o,editor:t})=>!this.editorGroupsContainer.getGroup(o)?.isSticky(t)):this.editorsObserver.editors;case u.bS.SEQUENTIAL:{const o=[];for(const t of this.editorGroupsContainer.getGroups(C.L0.GRID_APPEARANCE))o.push(...t.getEditors(u.bS.SEQUENTIAL,e).map(s=>({editor:s,groupId:t.id})));return o}}}get activeEditor(){const i=this.editorGroupsContainer.activeGroup;return i?i.activeEditor??void 0:void 0}get visibleEditorPanes(){return(0,v.Yc)(this.editorGroupsContainer.groups.map(i=>i.activeEditorPane))}get visibleTextEditorControls(){return this.doGetVisibleTextEditorControls(this.visibleEditorPanes)}doGetVisibleTextEditorControls(i){const e=[];for(const o of i){const t=[];o instanceof m.z?(t.push(o.getPrimaryEditorPane()?.getControl()),t.push(o.getSecondaryEditorPane()?.getControl())):t.push(o.getControl());for(const s of t)((0,E.z9)(s)||(0,E.Np)(s))&&e.push(s)}return e}getVisibleTextEditorControls(i){return this.doGetVisibleTextEditorControls((0,v.Yc)(this.editorGroupsContainer.getGroups(i===u.bS.SEQUENTIAL?C.L0.GRID_APPEARANCE:C.L0.MOST_RECENTLY_ACTIVE).map(e=>e.activeEditorPane)))}get visibleEditors(){return(0,v.Yc)(this.editorGroupsContainer.groups.map(i=>i.activeEditor))}openEditor(i,e,o){var t=this;return(0,O.A)(function*(){let s,c,r=(0,u.ct)(i)?e:i.options;if((0,R.BS)(e)&&(o=e),!(0,u.ct)(i)){const a=yield t.editorResolverService.resolveEditor(i,o);if(a===w.HI.ABORT)return;(0,u.kc)(a)&&(s=a.editor,r=a.options,c=a.group)}if(s||(s=(0,u.ct)(i)?i:yield t.textEditorService.resolveTextEditor(i)),!c){let a;const l=t.instantiationService.invokeFunction(j.$,{editor:s,options:r},o);[c,a]=l instanceof Promise?yield l:l,a&&(r={...r,activation:a})}return c.openEditor(s,r)})()}openEditors(i,e,o){var t=this;return(0,O.A)(function*(){if(o?.validateTrust&&!(yield t.handleWorkspaceTrust(i)))return[];const s=new Map;for(const c of i){let a,l;if(!(0,u.cs)(c)){const D=yield t.editorResolverService.resolveEditor(c,e);if(D===w.HI.ABORT)continue;(0,u.kc)(D)&&(a=D,l=D.group)}if(a||(a=(0,u.cs)(c)?c:{editor:yield t.textEditorService.resolveTextEditor(c),options:c.options}),!l){const D=t.instantiationService.invokeFunction(j.$,a,e);[l]=D instanceof Promise?yield D:D}let S=s.get(l);S||(S=[],s.set(l,S)),S.push(a)}const r=[];for(const[c,a]of s)r.push(c.openEditors(a));return(0,v.Yc)(yield U.HC.settled(r))})()}handleWorkspaceTrust(i){var e=this;return(0,O.A)(function*(){const{resources:o,diffMode:t,mergeMode:s}=e.extractEditorResources(i);switch(yield e.workspaceTrustRequestService.requestOpenFilesTrust(o)){case k.h.Open:return!0;case k.h.OpenInNewWindow:return yield e.hostService.openWindow(o.map(c=>({fileUri:c})),{forceNewWindow:!0,diffMode:t,mergeMode:s}),!1;case k.h.Cancel:return!1}})()}extractEditorResources(i){const e=new _.rm;let o=!1,t=!1;for(const s of i)if((0,u.cs)(s)){const r=u.tf.getOriginalUri(s.editor,{supportSideBySide:u.zX.BOTH});G.rz.isUri(r)?e.add(r):r&&(r.primary&&e.add(r.primary),r.secondary&&e.add(r.secondary),o=s.editor instanceof A.p)}else(0,u.CD)(s)&&(G.rz.isUri(s.input1)&&e.add(s.input1.resource),G.rz.isUri(s.input2)&&e.add(s.input2.resource),G.rz.isUri(s.base)&&e.add(s.base.resource),G.rz.isUri(s.result)&&e.add(s.result.resource),t=!0),(0,u.bV)(s)?(G.rz.isUri(s.original.resource)&&e.add(s.original.resource),G.rz.isUri(s.modified.resource)&&e.add(s.modified.resource),o=!0):(0,u.iY)(s)&&e.add(s.resource);return{resources:Array.from(e.keys()),diffMode:o,mergeMode:t}}isOpened(i){return this.editorsObserver.hasEditor({resource:this.uriIdentityService.asCanonicalUri(i.resource),typeId:i.typeId,editorId:i.editorId})}isVisible(i){for(const e of this.editorGroupsContainer.groups)if(e.activeEditor?.matches(i))return!0;return!1}closeEditor(i,e){var o=this;return(0,O.A)(function*({editor:t,groupId:s},r){yield o.editorGroupsContainer.getGroup(s)?.closeEditor(t,r)}).apply(this,arguments)}closeEditors(i,e){var o=this;return(0,O.A)(function*(){const t=new Map;for(const{editor:s,groupId:r}of i){const c=o.editorGroupsContainer.getGroup(r);if(!c)continue;let a=t.get(c);a||(a=[],t.set(c,a)),a.push(s)}for(const[s,r]of t)yield s.closeEditors(r,e)})()}findEditors(i,e,o){const t=G.rz.isUri(i)?i:i.resource,s=G.rz.isUri(i)?void 0:i.typeId;if(e?.supportSideBySide!==u.zX.ANY&&e?.supportSideBySide!==u.zX.SECONDARY&&!this.editorsObserver.hasEditors(t))return G.rz.isUri(i)||(0,V.b0)(o)?[]:void 0;if((0,V.b0)(o)){const r=[];for(const c of this.editorGroupsContainer.getGroups(C.L0.MOST_RECENTLY_ACTIVE)){const a=[];if(G.rz.isUri(i))a.push(...this.findEditors(i,e,c));else{const l=this.findEditors(i,e,c);l&&a.push(l)}r.push(...a.map(l=>({editor:l,groupId:c.id})))}return r}{const r="number"==typeof o?this.editorGroupsContainer.getGroup(o):o;if(G.rz.isUri(i))return r?r.findEditors(t,e):[];{if(!r)return;const c=r.findEditors(t,e);for(const a of c)if(a.typeId===s)return a;return}}}replaceEditors(i,e){var o=this;return(0,O.A)(function*(){const t="number"==typeof e?o.editorGroupsContainer.getGroup(e):e,s=[];for(const r of i){let c;if(!(0,u.ct)(r.replacement)){const a=yield o.editorResolverService.resolveEditor(r.replacement,t);if(a===w.HI.ABORT)continue;(0,u.kc)(a)&&(c={editor:r.editor,replacement:a.editor,options:a.options,forceReplaceDirty:r.forceReplaceDirty})}c||(c={editor:r.editor,replacement:(0,C.Km)(r)?r.replacement:yield o.textEditorService.resolveTextEditor(r.replacement),options:(0,C.Km)(r)?r.options:r.replacement.options,forceReplaceDirty:r.forceReplaceDirty}),s.push(c)}return t?.replaceEditors(s)})()}save(i,e){var o=this;return(0,O.A)(function*(){Array.isArray(i)||(i=[i]);const t=o.getUniqueEditors(i),s=[],r=[];if(e?.saveAs)r.push(...t);else for(const{groupId:a,editor:l}of t)l.hasCapability(u.oG.Untitled)?r.push({groupId:a,editor:l}):s.push({groupId:a,editor:l});const c=yield U.HC.settled(s.map(({groupId:a,editor:l})=>(e?.reason===u.Mr.EXPLICIT&&o.editorGroupsContainer.getGroup(a)?.pinEditor(l),l.save(a,e))));for(const{groupId:a,editor:l}of r){if(l.isDisposed())continue;const D={pinned:!0,viewState:(yield o.openEditor(l,a))?.getViewState()},x=e?.saveAs?yield l.saveAs(a,e):yield l.save(a,e);if(c.push(x),!x)break;if(!l.matches(x)){const se=l.hasCapability(u.oG.Untitled)?o.editorGroupsContainer.groups.map(H=>H.id):[a];for(const H of se)x instanceof N.m?yield o.replaceEditors([{editor:l,replacement:x,options:D}],H):yield o.replaceEditors([{editor:l,replacement:{...x,options:D}}],H)}}return{success:c.every(a=>!!a),editors:(0,v.Yc)(c)}})()}saveAll(i){return this.save(this.getAllModifiedEditors(i),i)}revert(i,e){var o=this;return(0,O.A)(function*(){Array.isArray(i)||(i=[i]);const t=o.getUniqueEditors(i);return yield U.HC.settled(t.map(function(){var s=(0,O.A)(function*({groupId:r,editor:c}){return o.editorGroupsContainer.getGroup(r)?.pinEditor(c),c.revert(r,e)});return function(r){return s.apply(this,arguments)}}())),!t.some(({editor:s})=>s.isDirty())})()}revertAll(i){var e=this;return(0,O.A)(function*(){return e.revert(e.getAllModifiedEditors(i),i)})()}getAllModifiedEditors(i){const e=[];for(const o of this.editorGroupsContainer.getGroups(C.L0.MOST_RECENTLY_ACTIVE))for(const t of o.getEditors(u.bS.MOST_RECENTLY_ACTIVE))t.isModified()&&(("boolean"==typeof i?.includeUntitled||!i?.includeUntitled?.includeScratchpad)&&t.hasCapability(u.oG.Scratchpad)||!i?.includeUntitled&&t.hasCapability(u.oG.Untitled)||i?.excludeSticky&&o.isSticky(t)||e.push({groupId:o.id,editor:t}));return e}getUniqueEditors(i){const e=[];for(const{editor:o,groupId:t}of i)e.some(s=>s.editor.matches(o))||e.push({editor:o,groupId:t});return e}dispose(){super.dispose(),this.activeOutOfWorkspaceWatchers.forEach(i=>(0,h.AS)(i)),this.activeOutOfWorkspaceWatchers.clear()}};$=J=(0,g.C)([(0,g.Q)(1,P.m),(0,g.Q)(2,L._Y),(0,g.Q)(3,K.$),(0,g.Q)(4,n.p),(0,g.Q)(5,X.V),(0,g.Q)(6,q.J),(0,g.Q)(7,ee.Y),(0,g.Q)(8,te.ZE),(0,g.Q)(9,ie.v),(0,g.Q)(10,oe.P)],$)},42079:(Q,Y,d)=>{var O=d(88039),g=d(51627),L=d(10145),u=d(96452);O.O.as(g.q5.EditorFactory).registerFileEditorFactory({typeId:L.Io,createFileEditor:(N,F,_,W,K,M,G,B)=>B.createInstance(u.K,N,F,_,W,K,M,G),isFileEditor:N=>N instanceof u.K})},61649:(Q,Y,d)=>{var O=d(29647),g=d(38035),L=d(52814),u=d(74933),N=d(40628),F=d(46836),_=d(51627),W=d(8472),K=d(36376),M=d(72462),G=d(56862),B=d(25552),A=d(27126),m=d(70976),C=d(40660);let P=class extends L.jG{static{this.ID="workbench.contrib.editorAutoSave"}constructor(n,h,v,E,y,V,p,b){super(),this.filesConfigurationService=n,this.hostService=h,this.editorService=v,this.editorGroupService=E,this.workingCopyService=y,this.logService=V,this.markerService=p,this.uriIdentityService=b,this.scheduledAutoSavesAfterDelay=new Map,this.lastActiveEditor=void 0,this.lastActiveGroupId=void 0,this.lastActiveEditorControlDisposable=this._register(new L.Cm),this.waitingOnConditionAutoSaveWorkingCopies=new m.fT(f=>this.uriIdentityService.extUri.getComparisonKey(f)),this.waitingOnConditionAutoSaveEditors=new m.fT(f=>this.uriIdentityService.extUri.getComparisonKey(f));for(const f of this.workingCopyService.dirtyWorkingCopies)this.onDidRegister(f);this.registerListeners()}registerListeners(){this._register(this.hostService.onDidChangeFocus(n=>this.onWindowFocusChange(n))),this._register(this.hostService.onDidChangeActiveWindow(()=>this.onActiveWindowChange())),this._register(this.editorService.onDidActiveEditorChange(()=>this.onDidActiveEditorChange())),this._register(this.filesConfigurationService.onDidChangeAutoSaveConfiguration(()=>this.onDidChangeAutoSaveConfiguration())),this._register(this.workingCopyService.onDidRegister(n=>this.onDidRegister(n))),this._register(this.workingCopyService.onDidUnregister(n=>this.onDidUnregister(n))),this._register(this.workingCopyService.onDidChangeDirty(n=>this.onDidChangeDirty(n))),this._register(this.workingCopyService.onDidChangeContent(n=>this.onDidChangeContent(n))),this._register(this.markerService.onMarkerChanged(n=>this.onConditionChanged(n,u.vq.ERRORS))),this._register(this.filesConfigurationService.onDidChangeAutoSaveDisabled(n=>this.onConditionChanged([n],u.vq.DISABLED)))}onConditionChanged(n,h){for(const v of n){const E=this.waitingOnConditionAutoSaveWorkingCopies.get(v);if(E?.condition===h)E.workingCopy.isDirty()&&this.filesConfigurationService.getAutoSaveMode(E.workingCopy.resource,E.reason).mode!==u.O6.OFF&&(this.discardAutoSave(E.workingCopy),this.logService.trace("[editor auto save] running auto save from condition change event",E.workingCopy.resource.toString(),E.workingCopy.typeId),E.workingCopy.save({reason:E.reason}));else{const y=this.waitingOnConditionAutoSaveEditors.get(v);y?.condition===h&&!y.editor.editor.isDisposed()&&y.editor.editor.isDirty()&&this.filesConfigurationService.getAutoSaveMode(y.editor.editor,y.reason).mode!==u.O6.OFF&&(this.waitingOnConditionAutoSaveEditors.delete(v),this.logService.trace(`[editor auto save] running auto save from condition change event with reason ${y.reason}`),this.editorService.save(y.editor,{reason:y.reason}))}}}onWindowFocusChange(n){n||this.maybeTriggerAutoSave(_.Mr.WINDOW_CHANGE)}onActiveWindowChange(){this.maybeTriggerAutoSave(_.Mr.WINDOW_CHANGE)}onDidActiveEditorChange(){this.lastActiveEditor&&"number"==typeof this.lastActiveGroupId&&this.maybeTriggerAutoSave(_.Mr.FOCUS_CHANGE,{groupId:this.lastActiveGroupId,editor:this.lastActiveEditor});const n=this.editorGroupService.activeGroup,h=this.lastActiveEditor=n.activeEditor??void 0;this.lastActiveGroupId=n.id,this.lastActiveEditorControlDisposable.clear();const v=this.editorService.activeEditorPane;h&&v&&this.lastActiveEditorControlDisposable.add(v.onDidBlur(()=>{this.maybeTriggerAutoSave(_.Mr.FOCUS_CHANGE,{groupId:n.id,editor:h})}))}maybeTriggerAutoSave(n,h){if(h){if(!h.editor.isDirty()||h.editor.isReadonly()||h.editor.hasCapability(_.oG.Untitled))return;const v=this.filesConfigurationService.getAutoSaveMode(h.editor,n);v.mode!==u.O6.OFF?(n===_.Mr.WINDOW_CHANGE&&(v.mode===u.O6.ON_FOCUS_CHANGE||v.mode===u.O6.ON_WINDOW_CHANGE)||n===_.Mr.FOCUS_CHANGE&&v.mode===u.O6.ON_FOCUS_CHANGE)&&(this.logService.trace(`[editor auto save] triggering auto save with reason ${n}`),this.editorService.save(h,{reason:n})):h.editor.resource&&(v.reason===u.vq.ERRORS||v.reason===u.vq.DISABLED)&&this.waitingOnConditionAutoSaveEditors.set(h.editor.resource,{editor:h,reason:n,condition:v.reason})}else this.saveAllDirtyAutoSaveables(n)}onDidChangeAutoSaveConfiguration(){let n;switch(this.filesConfigurationService.getAutoSaveMode(void 0).mode){case u.O6.ON_FOCUS_CHANGE:n=_.Mr.FOCUS_CHANGE;break;case u.O6.ON_WINDOW_CHANGE:n=_.Mr.WINDOW_CHANGE;break;case u.O6.AFTER_SHORT_DELAY:case u.O6.AFTER_LONG_DELAY:n=_.Mr.AUTO}n&&this.saveAllDirtyAutoSaveables(n)}saveAllDirtyAutoSaveables(n){for(const h of this.workingCopyService.dirtyWorkingCopies){if(h.capabilities&G.i.Untitled)continue;const v=this.filesConfigurationService.getAutoSaveMode(h.resource,n);v.mode!==u.O6.OFF?h.save({reason:n}):(v.reason===u.vq.ERRORS||v.reason===u.vq.DISABLED)&&this.waitingOnConditionAutoSaveWorkingCopies.set(h.resource,{workingCopy:h,reason:n,condition:v.reason})}}onDidRegister(n){n.isDirty()&&this.scheduleAutoSave(n)}onDidUnregister(n){this.discardAutoSave(n)}onDidChangeDirty(n){n.isDirty()?this.scheduleAutoSave(n):this.discardAutoSave(n)}onDidChangeContent(n){n.isDirty()&&this.scheduleAutoSave(n)}scheduleAutoSave(n){if(n.capabilities&G.i.Untitled)return;const h=this.filesConfigurationService.getAutoSaveConfiguration(n.resource).autoSaveDelay;if("number"!=typeof h)return;this.discardAutoSave(n),this.logService.trace(`[editor auto save] scheduling auto save after ${h}ms`,n.resource.toString(),n.typeId);const v=setTimeout(()=>{if(this.discardAutoSave(n),n.isDirty()){const E=_.Mr.AUTO,y=this.filesConfigurationService.getAutoSaveMode(n.resource,E);y.mode!==u.O6.OFF?(this.logService.trace("[editor auto save] running auto save",n.resource.toString(),n.typeId),n.save({reason:E})):(y.reason===u.vq.ERRORS||y.reason===u.vq.DISABLED)&&this.waitingOnConditionAutoSaveWorkingCopies.set(n.resource,{workingCopy:n,reason:E,condition:y.reason})}},h);this.scheduledAutoSavesAfterDelay.set(n,(0,L.s)(()=>{this.logService.trace("[editor auto save] clearing pending auto save",n.resource.toString(),n.typeId),clearTimeout(v)}))}discardAutoSave(n){(0,L.AS)(this.scheduledAutoSavesAfterDelay.get(n)),this.scheduledAutoSavesAfterDelay.delete(n),this.waitingOnConditionAutoSaveWorkingCopies.delete(n.resource),this.waitingOnConditionAutoSaveEditors.delete(n.resource)}};P=(0,g.C)([(0,g.Q)(0,N.U),(0,g.Q)(1,F.v),(0,g.Q)(2,W.I),(0,g.Q)(3,K.m),(0,g.Q)(4,M.v),(0,g.Q)(5,B.r),(0,g.Q)(6,A.D),(0,g.Q)(7,C.J)],P),(0,O.tr)(P.ID,P,O.lw.BlockRestore)},79360:(Q,Y,d)=>{d.d(Y,{$:()=>_});var O=d(81856),g=d(86827),L=d(51627),u=d(84169),N=d(36376),F=d(19657);function _(A,m,C){const P=A.get(N.m),R=A.get(O.p),n=function K(A,m,C,P){let R;const n=(0,L.cs)(A)?A.editor:A,h=A.options;if(m&&"number"!=typeof m)R=m;else if("number"==typeof m&&m>=0)R=C.getGroup(m);else if(m===F.Sd){const v=(0,u.BD)(P);let E=C.findGroup({direction:v});(!E||M(E,n))&&(E=C.addGroup(C.activeGroup,v)),R=E}else if(m===F.eV)R=C.createAuxiliaryEditorPart({compact:h?.compact}).then(v=>v.activeGroup);else if(!h||"number"!=typeof h.index){const v=C.getGroups(u.L0.MOST_RECENTLY_ACTIVE);if(h?.revealIfVisible)for(const E of v)if(G(E,n)){R=E;break}if(!R&&(h?.revealIfOpened||P.getValue("workbench.editor.revealIfOpen")||(0,L.ct)(n)&&n.hasCapability(L.oG.Singleton))){let E,y;for(const V of v)if(B(V,n)&&(y||(y=V),!E&&V.isActive(n)&&(E=V)),y&&E)break;R=E||y}}if(!R){let v=C.activeGroup;if(M(v,n)){for(const E of C.getGroups(u.L0.MOST_RECENTLY_ACTIVE))if(!M(E,n)){v=E;break}R=M(v,n)?C.addGroup(v,(0,u.BD)(P)):v}else R=v}return R}(m,C,P,R);return n instanceof Promise?n.then(h=>W(h,m,C,P)):W(n,m,C,P)}function W(A,m,C,P){let R;return P.activeGroup!==A&&m.options&&!m.options.inactive&&m.options.preserveFocus&&"number"!=typeof m.options.activation&&C!==F.Sd&&(R=g.u2.ACTIVATE),[A,R]}function M(A,m){return!(!A.isLocked||B(A,m))}function G(A,m){return!!A.activeEditor&&A.activeEditor.matches(m)}function B(A,m){for(const C of A.editors)if(C.matches(m))return!0;return!1}},96353:(Q,Y,d)=>{d.d(Y,{E:()=>y});var O=d(10467),g=d(38035),L=d(48738),u=d(88039),N=d(70976),F=d(98039),_=d(51627),W=d(95958),K=d(2744),M=d(84736),G=d(90498),B=d(35770),A=d(44819),m=d(53899),C=d(48408),P=d(40660),R=d(18438),n=d(10515),h=d(56206),v=d(52814);d(79758);let y=class extends v.jG{constructor(p,b,f,I,T){super(),this.untitledTextEditorService=p,this.instantiationService=b,this.uriIdentityService=f,this.fileService=I,this.editorResolverService=T,this.editorInputCache=new N.fT,this.fileEditorFactory=u.O.as(_.q5.EditorFactory).getFileEditorFactory(),this.registerDefaultEditor()}registerDefaultEditor(){this._register(this.editorResolverService.registerEditor("*",{id:_.Ie.id,label:_.Ie.displayName,detail:_.Ie.providerDisplayName,priority:n.C8.builtin},{},{createEditorInput:p=>({editor:this.createTextEditor(p)}),createUntitledEditorInput:p=>({editor:this.createTextEditor(p)}),createDiffEditorInput:p=>({editor:this.createTextEditor(p)})}))}resolveTextEditor(p){var b=this;return(0,O.A)(function*(){return b.createTextEditor(p)})()}createTextEditor(p){if((0,_.CD)(p))return this.createTextEditor(p.result);if((0,_.bV)(p)){const I=this.createTextEditor(p.original),T=this.createTextEditor(p.modified);return this.instantiationService.createInstance(M.p,p.label,p.description,I,T,void 0)}if((0,_.nM)(p)){const I=this.createTextEditor(p.primary),T=this.createTextEditor(p.secondary);return this.instantiationService.createInstance(G.JL,p.label,p.description,T,I)}const b=p;if(b.forceUntitled||!b.resource||b.resource.scheme===K.ny.untitled){const I={languageId:b.languageId,initialValue:b.contents,encoding:b.encoding};let T;return T=this.untitledTextEditorService.create(b.resource?.scheme===K.ny.untitled?{untitledResource:b.resource,...I}:{associatedResource:b.resource,...I}),this.createOrGetCached(T.resource,()=>this.instantiationService.createInstance(A.m,T))}const f=p;if(f.resource instanceof C.rz){const I=f.label||(0,m.P8)(f.resource),T=f.resource,z=this.uriIdentityService.asCanonicalUri(T);return this.createOrGetCached(z,()=>f.forceFile||this.fileService.hasProvider(z)?this.fileEditorFactory.createFileEditor(z,T,f.label,f.description,f.encoding,f.languageId,f.contents,this.instantiationService):this.instantiationService.createInstance(B.r,z,f.label,f.description,f.languageId,f.contents),U=>{U instanceof A.m||(U instanceof B.r?(I&&U.setName(I),f.description&&U.setDescription(f.description),f.languageId&&U.setPreferredLanguageId(f.languageId),"string"==typeof f.contents&&U.setPreferredContents(f.contents)):(U.setPreferredResource(T),f.label&&U.setPreferredName(f.label),f.description&&U.setPreferredDescription(f.description),f.encoding&&U.setPreferredEncoding(f.encoding),f.languageId&&U.setPreferredLanguageId(f.languageId),"string"==typeof f.contents&&U.setPreferredContents(f.contents)))})}throw new Error(`ITextEditorService: Unable to create texteditor from ${JSON.stringify(p)}`)}createOrGetCached(p,b,f){let I=this.editorInputCache.get(p);return I?(f?.(I),I):(I=b(),this.editorInputCache.set(p,I),L.Jh.once(I.onWillDispose)(()=>this.editorInputCache.delete(p)),I)}};y=(0,g.C)([(0,g.Q)(0,W.g),(0,g.Q)(1,F._Y),(0,g.Q)(2,P.J),(0,g.Q)(3,R.$),(0,g.Q)(4,h.Y)],y)}}]);