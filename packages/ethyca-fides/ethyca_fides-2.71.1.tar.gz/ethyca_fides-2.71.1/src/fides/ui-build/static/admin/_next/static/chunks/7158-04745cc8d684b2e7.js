"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7158],{90980:function(e,i,s){s.d(i,{R:function(){return o}});var t=s(24246),a=s(96306),r=s(79894),l=s.n(r),n=s(63662);let o=e=>{let{onClick:i,...s}=e;return(0,t.jsxs)(a.kCb,{alignItems:"center",mt:-4,mb:3,onClick:i,cursor:"pointer",...s,children:[(0,t.jsx)(a.wpx,{"aria-label":"Back",icon:(0,t.jsx)(a.Rpv,{}),className:"mr-2",size:"small"}),(0,t.jsx)(a.xvT,{as:"a",fontSize:"sm",fontWeight:"500",children:"Back"})]})};i.Z=e=>{let{backPath:i,...s}=e,r=(0,n.useRouter)();return(0,t.jsxs)(a.kCb,{alignItems:"center",mb:6,...s,children:[(0,t.jsx)(a.wpx,{onClick:()=>r.push(i),"aria-label":"Back",icon:(0,t.jsx)(a.Rpv,{}),className:"mr-2",size:"small"}),(0,t.jsx)(a.xvT,{as:l(),href:i,fontSize:"sm",fontWeight:"500",children:"Back"})]})}},10792:function(e,i,s){s.d(i,{Z:function(){return E}});var t=s(24246),a=s(96306),r=s(27378),l=s(17245),n=s(90710),o=s(51980),d=s(90104),c=s.n(d),u=s(56141),m=s.n(u),f=s(92465),_=s.n(f),y=s(25389),p=s.n(y),x=s(15539),g=s.n(x),h=s(86677),v=s(812),w=s(77830),k=s(17828),j=s(42478);let b=e=>{let{serviceType:i,isOpen:s,onClose:l}=e,[o]=(0,j.SU)(),[d,c]=(0,r.useState)(!1),[u]=a.PPS.useForm(),m=i===n.q.twilio_text,f=e=>{let i="An unexpected error occurred. Please try again.";return(0,v.Ot)(e)?i=e.data.detail:(0,v.tB)(e)&&(i=e.data.detail[0].msg),i},_=async e=>{c(!0);try{let s=await o({service_type:i,details:{to_identity:m?{phone_number:e.phone}:{email:e.email}}});(0,v.D4)(s)?a.Pg3.error(f(s.error)):(a.Pg3.success("Test message sent successfully!"),l())}catch(e){a.Pg3.error(f(e))}finally{c(!1)}},y=m?"SMS":"email",p=()=>{l()};return(0,t.jsx)(a.$zI,{title:"Test ".concat(y),open:s,onCancel:p,footer:null,children:(0,t.jsx)(a.gCW,{spacing:4,children:(0,t.jsxs)(a.PPS,{form:u,onFinish:_,layout:"vertical",style:{width:"100%"},children:[m?(0,t.jsx)(a.PPS.Item,{name:"phone",label:"Phone number",rules:[{required:!0,message:"Phone number is required"},{pattern:/^\+?[1-9]\d{1,14}$/,message:"Please enter a valid phone number"}],children:(0,t.jsx)(a.uFc,{placeholder:"+1234567890"})}):(0,t.jsx)(a.PPS.Item,{name:"email",label:"Email address",rules:[{required:!0,message:"Email address is required"},{type:"email",message:"Please enter a valid email address"}],children:(0,t.jsx)(a.uFc,{placeholder:"test@example.com"})}),(0,t.jsx)(a.PPS.Item,{style:{marginBottom:0,marginTop:24},children:(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[(0,t.jsx)(a.wpx,{onClick:p,disabled:d,children:"Cancel"}),(0,t.jsx)(a.wpx,{type:"primary",htmlType:"submit",loading:d,"data-testid":"send-test-message-btn",children:d?"Sending...":"Send test ".concat(y)})]})})]})})})},S=()=>{let[e]=(0,j.SU)(),[i,s]=(0,r.useState)(!1),[t,l]=(0,r.useState)({}),o=e=>{let i="An unexpected error occurred. Please try again.";return(0,v.Ot)(e)?i=e.data.detail:(0,v.tB)(e)&&(i=e.data.detail[0].msg),i};return{verifyConfiguration:async i=>{s(!0);try{let s=i===n.q.twilio_text,t=await e({service_type:i,details:{to_identity:s?{phone_number:"+15551234567"}:{email:"test@example.com"}}});if((0,v.D4)(t)){a.Pg3.error(o(t.error));let e=new Date().toISOString();return l(s=>({...s,[i]:{timestamp:e,success:!1}})),!1}a.Pg3.success("Configuration verified successfully!");let r=new Date().toISOString();return l(e=>({...e,[i]:{timestamp:r,success:!0}})),!0}catch(e){return a.Pg3.error(o(e)),!1}finally{s(!1)}},isVerifying:i,isConfigurationVerified:e=>{var i;return!!(null===(i=t[e])||void 0===i?void 0:i.success)},getVerificationData:e=>t[e]}};var P=e=>{var i,s,d;let{configKey:u}=e,f=(0,h.useRouter)(),{handleError:y}=(0,l.HK)(),{verifyConfiguration:x,isVerifying:P,getVerificationData:V}=S(),q=!!u,[D,C]=(0,r.useState)(!1),[I,E]=(0,r.useState)(!1),[A,F]=(0,r.useState)(q?"**********":"secret_keys"),[B]=a.PPS.useForm(),[T]=(0,j.h9)(),[W]=(0,j.sn)(),[N]=(0,j.Ki)(),{data:R,refetch:O}=(0,j.FU)({key:u},{skip:!u}),M={email_from:(null==R?void 0:null===(i=R.details)||void 0===i?void 0:i.email_from)||"",domain:(null==R?void 0:null===(s=R.details)||void 0===s?void 0:s.domain)||"",aws_region:(null==R?void 0:null===(d=R.details)||void 0===d?void 0:d.aws_region)||"",auth_method:q?"**********":"secret_keys",aws_access_key_id:q?"**********":"",aws_secret_access_key:q?"**********":"",aws_assume_role_arn:q?"**********":""};(0,r.useEffect)(()=>{if(R){var e,i,s;let t={email_from:(null===(e=R.details)||void 0===e?void 0:e.email_from)||"",domain:(null===(i=R.details)||void 0===i?void 0:i.domain)||"",aws_region:(null===(s=R.details)||void 0===s?void 0:s.aws_region)||"",auth_method:"**********",aws_access_key_id:"**********",aws_secret_access_key:"**********",aws_assume_role_arn:"**********"};B.setFieldsValue(t),F("**********"),E(!1)}},[R,B]);let K=(()=>{let e=V(n.q.aws_ses);if(e){if(!e.success)return{isVerified:!1,status:"Verify configuration"};let i=new Date(e.timestamp),s=(0,o.B)(i,new Date,{addSuffix:!0});return{isVerified:!0,status:"Verified ".concat(s),timestamp:e.timestamp}}if(R){let{last_test_succeeded:e,last_test_timestamp:i}=R;if(i){let s=new Date(i),t=(0,o.B)(s,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(t):"Verify configuration",timestamp:i}}}let i=f.query.last_test_succeeded,s=f.query.last_test_timestamp;if(s){let e="true"===i||"1"===i,t=new Date(s),a=(0,o.B)(t,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(a):"Verify configuration",timestamp:s}}return{isVerified:!1,status:"Verify configuration"}})(),U=e=>g()(p()(e,e=>q&&"**********"===e?void 0:e),_()),z=(0,r.useCallback)(()=>{let e=B.getFieldsValue(),i=e.email_from,{domain:s}=e,t=i&&""!==i.trim(),a=s&&""!==s.trim();return t||a?Promise.resolve():Promise.reject(Error("Either email from or domain must be provided"))},[B]),Z=async e=>{try{var i,s,t,r;if(q&&u){let r=[],l=(null==R?void 0:null===(i=R.details)||void 0===i?void 0:i.email_from)||"",o=(null==R?void 0:null===(s=R.details)||void 0===s?void 0:s.domain)||"",d=(null==R?void 0:null===(t=R.details)||void 0===t?void 0:t.aws_region)||"";(e.email_from!==l||e.domain!==o||e.aws_region!==d)&&r.push(W({key:u,config:{key:(null==R?void 0:R.key)||u,name:null==R?void 0:R.name,service_type:(null==R?void 0:R.service_type)||n.q.aws_ses,details:{...null==R?void 0:R.details,email_from:e.email_from||null,domain:e.domain||null,aws_region:e.aws_region}}}));let m={auth_method:e.auth_method,aws_access_key_id:e.aws_access_key_id,aws_secret_access_key:e.aws_secret_access_key,aws_assume_role_arn:e.aws_assume_role_arn},f=U(m);if(c()(f)||r.push(N({key:u,secrets:f})),0===r.length){a.Pg3.info("No changes to save.");return}let _=await Promise.all(r);if(_.some(e=>(0,v.D4)(e))){let e=_.find(e=>(0,v.D4)(e));y(null==e?void 0:e.error)}else a.Pg3.success("AWS SES configuration successfully updated."),E(!1),O&&O()}else{let i={service_type:n.q.aws_ses,details:{email_from:e.email_from||null,domain:e.domain||null,aws_region:e.aws_region},secrets:{auth_method:e.auth_method,aws_access_key_id:e.aws_access_key_id,aws_secret_access_key:e.aws_secret_access_key,aws_assume_role_arn:e.aws_assume_role_arn}},s=await T(i);if((0,v.D4)(s))y(s.error);else{a.Pg3.success("AWS SES configuration successfully created."),E(!1);let e=null===(r=s.data)||void 0===r?void 0:r.key;if(e){let i=w.GE.replace("[key]",e);f.push(i)}else f.push(w.AD)}}}catch(e){y(e)}},X=async()=>{try{await x(n.q.aws_ses)&&O&&setTimeout(()=>{O()},500)}catch(e){y(e)}},G=()=>{B.validateFields(["email_from","domain"]).catch(()=>{})};return(0,t.jsxs)(a.xuv,{position:"relative",children:[(0,t.jsx)(a.PPS,{form:B,layout:"vertical",initialValues:M,onFinish:Z,onValuesChange:(e,i)=>{let s={...i},t={...M};q&&Object.keys(s).forEach(e=>{"**********"===s[e]&&(s[e]=t[e])}),void 0!==e.auth_method&&(F(e.auth_method),"automatic"===e.auth_method&&B.setFieldsValue({aws_access_key_id:"",aws_secret_access_key:""})),E(!m()(s,t))},children:(0,t.jsxs)(a.xuv,{maxWidth:"720px",border:"1px",borderColor:"gray.200",borderRadius:6,overflow:"visible",mt:6,children:[(0,t.jsx)(a.xuv,{backgroundColor:"gray.50",px:6,py:4,display:"flex",flexDirection:"row",alignItems:"center",borderBottom:"1px",borderColor:"gray.200",borderTopRadius:6,children:(0,t.jsxs)(a.Ugi,{children:[(0,t.jsx)(k.Z,{}),(0,t.jsx)(a.X6q,{as:"h3",size:"xs",children:"AWS SES email messaging configuration"})]})}),(0,t.jsxs)(a.xuv,{px:6,py:6,children:[(0,t.jsx)(a.PPS.Item,{name:"email_from",label:"Email from",rules:[{validator:z}],style:{marginBottom:24},children:(0,t.jsx)(a.uFc,{placeholder:q?"Enter new email from":"Enter email from",onChange:()=>G()})}),(0,t.jsx)(a.PPS.Item,{name:"domain",label:"Domain",rules:[{validator:z}],style:{marginBottom:24},children:(0,t.jsx)(a.uFc,{placeholder:q?"Enter new domain":"Enter domain",onChange:()=>G()})}),(0,t.jsx)(a.PPS.Item,{name:"aws_region",label:"AWS region",rules:[{required:!0,message:"AWS region is required"}],style:{marginBottom:24},children:(0,t.jsx)(a.uFc,{placeholder:q?"Enter new AWS region":"Enter AWS region (e.g., us-east-1)"})}),(0,t.jsx)(a.PPS.Item,{name:"auth_method",label:"Authentication method",rules:[{required:!0,message:"Authentication method is required"}],style:{marginBottom:24},children:(0,t.jsx)(a.WPr,{placeholder:"Select authentication method",options:[{label:"Secret keys",value:"secret_keys"},{label:"Automatic",value:"automatic"}]})}),("secret_keys"===A||q&&"**********"===A)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.PPS.Item,{name:"aws_access_key_id",label:"AWS access key ID",rules:"secret_keys"===A||q&&"**********"===A?[{required:!0,message:"AWS access key ID is required for secret keys authentication"}]:[],style:{marginBottom:24},children:(0,t.jsx)(a.uFc.Password,{placeholder:q?"Enter new AWS access key ID":"Enter AWS access key ID"})}),(0,t.jsx)(a.PPS.Item,{name:"aws_secret_access_key",label:"AWS secret access key",rules:"secret_keys"===A||q&&"**********"===A?[{required:!0,message:"AWS secret access key is required for secret keys authentication"}]:[],style:{marginBottom:24},children:(0,t.jsx)(a.uFc.Password,{placeholder:q?"Enter new AWS secret access key":"Enter AWS secret access key"})})]}),(0,t.jsx)(a.PPS.Item,{name:"aws_assume_role_arn",label:"AWS assume role ARN",children:(0,t.jsx)(a.uFc.Password,{placeholder:q?"Enter new AWS assume role ARN":"Enter AWS assume role ARN (optional)"})}),(0,t.jsxs)(a.xuv,{mt:6,className:"flex justify-between",children:[(0,t.jsx)(a.xuv,{children:q&&K.isVerified&&(0,t.jsx)(a.wpx,{type:"default",onClick:()=>C(!0),"data-testid":"send-test-message-btn",children:"Send test email"})}),(0,t.jsxs)(a.xuv,{className:"flex",children:[q?(0,t.jsx)(a.wpx,{onClick:X,className:"mr-2","data-testid":"test-btn",loading:P,icon:K.isVerified&&!P?(0,t.jsx)(a.StI,{}):void 0,children:P?"Verifying":K.isVerified?"Verified":K.status}):(0,t.jsx)(a.wpx,{onClick:()=>f.push(w.AD),className:"mr-2",children:"Cancel"}),(0,t.jsx)(a.wpx,{htmlType:"submit",type:"primary","data-testid":"save-btn",disabled:!I,children:"Save"})]})]})]})]})}),(0,t.jsx)(b,{serviceType:n.q.aws_ses,isOpen:D,onClose:()=>C(!1)})]})},V=s(44907),q=e=>{var i;let{configKey:s}=e,d=(0,h.useRouter)(),{handleError:u}=(0,l.HK)(),{verifyConfiguration:f,isVerifying:y,getVerificationData:x}=S(),[k,P]=(0,r.useState)(!1),[q,D]=(0,r.useState)(!1),[C]=a.PPS.useForm(),[I]=(0,j.h9)(),[E]=(0,j.sn)(),[A]=(0,j.Ki)(),F=!!s,{data:B,refetch:T}=(0,j.FU)({key:s},{skip:!s}),W={domain:(null==B?void 0:null===(i=B.details)||void 0===i?void 0:i.domain)||"",mailgun_api_key:F?"**********":""};(0,r.useEffect)(()=>{if(B){var e;let i={domain:(null===(e=B.details)||void 0===e?void 0:e.domain)||"",mailgun_api_key:"**********"};C.setFieldsValue(i),D(!1)}},[B,C]);let N=(()=>{let e=x(n.q.mailgun);if(e){if(!e.success)return{isVerified:!1,status:"Verify configuration"};let i=new Date(e.timestamp),s=(0,o.B)(i,new Date,{addSuffix:!0});return{isVerified:!0,status:"Verified ".concat(s),timestamp:e.timestamp}}if(B){let{last_test_succeeded:e,last_test_timestamp:i}=B;if(i){let s=new Date(i),t=(0,o.B)(s,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(t):"Verify configuration",timestamp:i}}}let i=d.query.last_test_succeeded,s=d.query.last_test_timestamp;if(s){let e="true"===i||"1"===i,t=new Date(s),a=(0,o.B)(t,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(a):"Verify configuration",timestamp:s}}return{isVerified:!1,status:"Verify configuration"}})(),R=e=>g()(p()(e,e=>F&&"**********"===e?void 0:e),_()),O=async e=>{try{var i,t;if(F&&s){let t=[],r=(null==B?void 0:null===(i=B.details)||void 0===i?void 0:i.domain)||"";e.domain!==r&&""!==e.domain.trim()&&t.push(E({key:s,config:{key:(null==B?void 0:B.key)||s,name:null==B?void 0:B.name,service_type:(null==B?void 0:B.service_type)||n.q.mailgun,details:{...null==B?void 0:B.details,is_eu_domain:"false",domain:e.domain}}}));let l=R({mailgun_api_key:e.mailgun_api_key});if(c()(l)||t.push(A({key:s,secrets:l})),0===t.length){a.Pg3.info("No changes to save.");return}let o=await Promise.all(t);if(o.some(e=>(0,v.D4)(e))){let e=o.find(e=>(0,v.D4)(e));u(null==e?void 0:e.error)}else a.Pg3.success("Mailgun configuration successfully updated."),D(!1),T&&T()}else{let i={service_type:n.q.mailgun,details:{is_eu_domain:"false",domain:e.domain},secrets:{mailgun_api_key:e.mailgun_api_key}},s=await I(i);if((0,v.D4)(s))u(s.error);else{a.Pg3.success("Mailgun configuration successfully created."),D(!1);let e=null===(t=s.data)||void 0===t?void 0:t.key;if(e){let i=w.GE.replace("[key]",e);d.push(i)}else d.push(w.AD)}}}catch(e){u(e)}},M=async()=>{try{await f(n.q.mailgun)&&T&&setTimeout(()=>{T()},500)}catch(e){u(e)}};return(0,t.jsxs)(a.xuv,{position:"relative",children:[(0,t.jsx)(a.PPS,{form:C,layout:"vertical",initialValues:W,onFinish:O,onValuesChange:(e,i)=>{let s={...i},t={...W};F&&"**********"===s.mailgun_api_key&&(s.mailgun_api_key=t.mailgun_api_key),D(!m()(s,t))},children:(0,t.jsxs)(a.xuv,{maxWidth:"720px",border:"1px",borderColor:"gray.200",borderRadius:6,overflow:"visible",mt:6,children:[(0,t.jsx)(a.xuv,{backgroundColor:"gray.50",px:6,py:4,display:"flex",flexDirection:"row",alignItems:"center",borderBottom:"1px",borderColor:"gray.200",borderTopRadius:6,children:(0,t.jsxs)(a.Ugi,{children:[(0,t.jsx)(V.Z,{}),(0,t.jsx)(a.X6q,{as:"h3",size:"xs",children:"Mailgun email messaging configuration"})]})}),(0,t.jsxs)(a.xuv,{px:6,py:6,children:[(0,t.jsx)(a.PPS.Item,{name:"domain",label:"Domain",rules:[{required:!0,message:"Domain is required"},{type:"string",min:1,message:"Domain cannot be empty"}],style:{marginBottom:24},children:(0,t.jsx)(a.uFc,{placeholder:F?"Enter new domain":"Enter domain"})}),(0,t.jsx)(a.PPS.Item,{name:"mailgun_api_key",label:"API key",rules:[{required:!0,message:"API key is required"},{type:"string",min:1,message:"API key cannot be empty"}],children:(0,t.jsx)(a.uFc.Password,{placeholder:F?"Enter new API key":"Enter API key"})}),(0,t.jsxs)(a.xuv,{mt:6,className:"flex justify-between",children:[(0,t.jsx)(a.xuv,{children:F&&N.isVerified&&(0,t.jsx)(a.wpx,{type:"default",onClick:()=>P(!0),"data-testid":"send-test-message-btn",children:"Send test email"})}),(0,t.jsxs)(a.xuv,{className:"flex",children:[F?(0,t.jsx)(a.wpx,{onClick:M,className:"mr-2","data-testid":"test-btn",loading:y,icon:N.isVerified&&!y?(0,t.jsx)(a.StI,{}):void 0,children:y?"Verifying":N.isVerified?"Verified":N.status}):(0,t.jsx)(a.wpx,{onClick:()=>d.push(w.AD),className:"mr-2",children:"Cancel"}),(0,t.jsx)(a.wpx,{htmlType:"submit",type:"primary","data-testid":"save-btn",disabled:!q,children:"Save"})]})]})]})]})}),(0,t.jsx)(b,{serviceType:n.q.mailgun,isOpen:k,onClose:()=>P(!1)})]})},D=s(5144),C=e=>{var i;let{configKey:s}=e,d=(0,h.useRouter)(),{handleError:u}=(0,l.HK)(),{verifyConfiguration:f,isVerifying:y,getVerificationData:x}=S(),[k,P]=(0,r.useState)(!1),[V,q]=(0,r.useState)(!1),[C]=a.PPS.useForm(),[I]=(0,j.h9)(),[E]=(0,j.sn)(),[A]=(0,j.Ki)(),F=!!s,{data:B,refetch:T}=(0,j.FU)({key:s},{skip:!s}),W={email:(null==B?void 0:null===(i=B.details)||void 0===i?void 0:i.twilio_email_from)||"",twilio_api_key:F?"**********":""};(0,r.useEffect)(()=>{if(B){var e;let i={email:(null===(e=B.details)||void 0===e?void 0:e.twilio_email_from)||"",twilio_api_key:"**********"};C.setFieldsValue(i),q(!1)}},[B,C]);let N=(()=>{let e=x(n.q.twilio_email);if(e){if(!e.success)return{isVerified:!1,status:"Verify configuration"};let i=new Date(e.timestamp),s=(0,o.B)(i,new Date,{addSuffix:!0});return{isVerified:!0,status:"Verified ".concat(s),timestamp:e.timestamp}}if(B){let{last_test_succeeded:e,last_test_timestamp:i}=B;if(i){let s=new Date(i),t=(0,o.B)(s,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(t):"Verify configuration",timestamp:i}}}let i=d.query.last_test_succeeded,s=d.query.last_test_timestamp;if(s){let e="true"===i||"1"===i,t=new Date(s),a=(0,o.B)(t,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(a):"Verify configuration",timestamp:s}}return{isVerified:!1,status:"Verify configuration"}})(),R=e=>g()(p()(e,e=>F&&"**********"===e?void 0:e),_()),O=async e=>{try{var i,t;if(F&&s){let t=[],r=(null==B?void 0:null===(i=B.details)||void 0===i?void 0:i.twilio_email_from)||"";e.email!==r&&""!==e.email.trim()&&t.push(E({key:s,config:{key:(null==B?void 0:B.key)||s,name:null==B?void 0:B.name,service_type:(null==B?void 0:B.service_type)||n.q.twilio_email,details:{...null==B?void 0:B.details,twilio_email_from:e.email}}}));let l=R({twilio_api_key:e.twilio_api_key});if(c()(l)||t.push(A({key:s,secrets:l})),0===t.length){a.Pg3.info("No changes to save.");return}let o=await Promise.all(t);if(o.some(e=>(0,v.D4)(e))){let e=o.find(e=>(0,v.D4)(e));u(null==e?void 0:e.error)}else a.Pg3.success("Twilio email configuration successfully updated."),q(!1),T&&T()}else{let i={service_type:n.q.twilio_email,details:{twilio_email_from:e.email},secrets:{twilio_api_key:e.twilio_api_key}},s=await I(i);if((0,v.D4)(s))u(s.error);else{a.Pg3.success("Twilio email configuration successfully created."),q(!1);let e=null===(t=s.data)||void 0===t?void 0:t.key;if(e){let i=w.GE.replace("[key]",e);d.push(i)}else d.push(w.AD)}}}catch(e){u(e)}},M=async()=>{try{await f(n.q.twilio_email)&&T&&setTimeout(()=>{T()},500)}catch(e){u(e)}};return(0,t.jsxs)(a.xuv,{position:"relative",children:[(0,t.jsx)(a.PPS,{form:C,layout:"vertical",initialValues:W,onFinish:O,onValuesChange:(e,i)=>{let s={...i},t={...W};F&&"**********"===s.twilio_api_key&&(s.twilio_api_key=t.twilio_api_key),q(!m()(s,t))},children:(0,t.jsxs)(a.xuv,{maxWidth:"720px",border:"1px",borderColor:"gray.200",borderRadius:6,overflow:"visible",mt:6,children:[(0,t.jsx)(a.xuv,{backgroundColor:"gray.50",px:6,py:4,display:"flex",flexDirection:"row",alignItems:"center",borderBottom:"1px",borderColor:"gray.200",borderTopRadius:6,children:(0,t.jsxs)(a.Ugi,{children:[(0,t.jsx)(D.Z,{}),(0,t.jsx)(a.X6q,{as:"h3",size:"xs",children:"Twilio email messaging configuration"})]})}),(0,t.jsxs)(a.xuv,{px:6,py:6,children:[(0,t.jsx)(a.PPS.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"},{type:"email",message:"Please enter a valid email"}],style:{marginBottom:24},children:(0,t.jsx)(a.uFc,{placeholder:F?"Enter new email":"Enter email"})}),(0,t.jsx)(a.PPS.Item,{name:"twilio_api_key",label:"API key",rules:[{required:!0,message:"API key is required"},{type:"string",min:1,message:"API key cannot be empty"}],children:(0,t.jsx)(a.uFc.Password,{placeholder:F?"Enter new API key":"Enter API key"})}),(0,t.jsxs)(a.xuv,{mt:6,className:"flex justify-between",children:[(0,t.jsx)(a.xuv,{children:F&&N.isVerified&&(0,t.jsx)(a.wpx,{type:"default",onClick:()=>P(!0),"data-testid":"send-test-message-btn",children:"Send test email"})}),(0,t.jsxs)(a.xuv,{className:"flex",children:[F?(0,t.jsx)(a.wpx,{onClick:M,className:"mr-2","data-testid":"test-btn",loading:y,icon:N.isVerified&&!y?(0,t.jsx)(a.StI,{}):void 0,children:y?"Verifying":N.isVerified?"Verified":N.status}):(0,t.jsx)(a.wpx,{onClick:()=>d.push(w.AD),className:"mr-2",children:"Cancel"}),(0,t.jsx)(a.wpx,{htmlType:"submit",type:"primary","data-testid":"save-btn",disabled:!V,children:"Save"})]})]})]})]})}),(0,t.jsx)(b,{serviceType:n.q.twilio_email,isOpen:k,onClose:()=>P(!1)})]})},I=e=>{let{configKey:i}=e,s=(0,h.useRouter)(),{verifyConfiguration:l,isVerifying:d,getVerificationData:u}=S(),[f,y]=(0,r.useState)(!1),[x,k]=(0,r.useState)(!1),[P]=a.PPS.useForm(),[V]=(0,j.h9)(),[q]=(0,j.Ki)(),C=!!i,{data:I,refetch:E}=(0,j.FU)({key:i},{skip:!i}),A={account_sid:C?"**********":"",auth_token:C?"**********":"",messaging_service_sid:C?"**********":"",phone:C?"**********":""};(0,r.useEffect)(()=>{I&&(P.setFieldsValue({account_sid:"**********",auth_token:"**********",messaging_service_sid:"**********",phone:"**********"}),k(!1))},[I,P]);let F=(()=>{let e=u(n.q.twilio_text);if(e){if(!e.success)return{isVerified:!1,status:"Verify configuration"};let i=new Date(e.timestamp),s=(0,o.B)(i,new Date,{addSuffix:!0});return{isVerified:!0,status:"Verified ".concat(s),timestamp:e.timestamp}}if(I){let{last_test_succeeded:e,last_test_timestamp:i}=I;if(i){let s=new Date(i),t=(0,o.B)(s,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(t):"Verify configuration",timestamp:i}}}let i=s.query.last_test_succeeded,t=s.query.last_test_timestamp;if(t){let e="true"===i||"1"===i,s=new Date(t),a=(0,o.B)(s,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(a):"Verify configuration",timestamp:t}}return{isVerified:!1,status:"Verify configuration"}})(),B=e=>g()(p()(e,e=>C&&"**********"===e?void 0:e),_()),T=e=>{let i="An unexpected error occurred. Please try again.";return(0,v.Ot)(e)?i=e.data.detail:(0,v.tB)(e)&&(i=e.data.detail[0].msg),i},W=(0,r.useCallback)(()=>{let e=P.getFieldsValue(),i=e.messaging_service_sid,s=e.phone,t=i&&""!==i.trim()&&"**********"!==i,a=s&&""!==s.trim()&&"**********"!==s;return t||a?Promise.resolve():Promise.reject(Error("Either messaging service SID or phone number must be provided"))},[P]),N=async e=>{try{if(C&&i){let s={twilio_account_sid:e.account_sid,twilio_auth_token:e.auth_token,twilio_messaging_service_sid:e.messaging_service_sid,twilio_sender_phone_number:e.phone},t=B(s);if(c()(t)){a.Pg3.info("No changes to save.");return}let r=await q({key:i,secrets:t});(0,v.D4)(r)?a.Pg3.error(T(r.error)):(a.Pg3.success("Twilio SMS configuration successfully updated."),k(!1),E&&E())}else{let i={service_type:n.q.twilio_text,secrets:{twilio_account_sid:e.account_sid,twilio_auth_token:e.auth_token,twilio_messaging_service_sid:e.messaging_service_sid,twilio_sender_phone_number:e.phone}},r=await V(i);if((0,v.D4)(r))a.Pg3.error(T(r.error));else{var t;a.Pg3.success("Twilio SMS configuration successfully created."),k(!1);let e=null===(t=r.data)||void 0===t?void 0:t.key;if(e){let i=w.GE.replace("[key]",e);s.push(i)}else s.push(w.AD)}}}catch(e){a.Pg3.error("An unexpected error occurred. Please try again.")}},R=async()=>{try{await l(n.q.twilio_text)&&E&&setTimeout(()=>{E()},500)}catch(e){a.Pg3.error("An unexpected error occurred during verification.")}},O=()=>{P.validateFields(["messaging_service_sid","phone"]).catch(()=>{})};return(0,t.jsxs)(a.xuv,{position:"relative",children:[(0,t.jsx)(a.PPS,{form:P,layout:"vertical",initialValues:A,onFinish:N,onValuesChange:(e,i)=>{let s={...i},t={...A};C&&Object.keys(s).forEach(e=>{"**********"===s[e]&&(s[e]=t[e])}),k(!m()(s,t))},children:(0,t.jsxs)(a.xuv,{maxWidth:"720px",border:"1px",borderColor:"gray.200",borderRadius:6,overflow:"visible",mt:6,children:[(0,t.jsx)(a.xuv,{backgroundColor:"gray.50",px:6,py:4,display:"flex",flexDirection:"row",alignItems:"center",borderBottom:"1px",borderColor:"gray.200",borderTopRadius:6,children:(0,t.jsxs)(a.Ugi,{children:[(0,t.jsx)(D.Z,{}),(0,t.jsx)(a.X6q,{as:"h3",size:"xs",children:"Twilio SMS messaging configuration"})]})}),(0,t.jsxs)(a.xuv,{px:6,py:6,children:[(0,t.jsx)(a.PPS.Item,{name:"account_sid",label:"Account SID",rules:[{required:!0,message:"Account SID is required"},{type:"string",min:1,message:"Account SID cannot be empty"}],style:{marginBottom:24},children:(0,t.jsx)(a.uFc.Password,{placeholder:C?"Enter new account SID":"Enter account SID"})}),(0,t.jsx)(a.PPS.Item,{name:"auth_token",label:"Auth token",rules:[{required:!0,message:"Auth token is required"},{type:"string",min:1,message:"Auth token cannot be empty"}],style:{marginBottom:24},children:(0,t.jsx)(a.uFc.Password,{placeholder:C?"Enter new auth token":"Enter auth token"})}),(0,t.jsx)(a.PPS.Item,{name:"messaging_service_sid",label:"Messaging service SID",rules:[{validator:W}],style:{marginBottom:24},children:(0,t.jsx)(a.uFc.Password,{placeholder:C?"Enter new messaging service SID":"Enter messaging service SID",onChange:()=>O()})}),(0,t.jsx)(a.PPS.Item,{name:"phone",label:"Phone number",rules:[{validator:W}],children:(0,t.jsx)(a.uFc.Password,{placeholder:C?"Enter new phone number":"Enter phone number",onChange:()=>O()})}),(0,t.jsxs)(a.xuv,{mt:6,className:"flex justify-between",children:[(0,t.jsx)(a.xuv,{children:C&&F.isVerified&&(0,t.jsx)(a.wpx,{type:"default",onClick:()=>y(!0),"data-testid":"send-test-message-btn",children:"Send test SMS"})}),(0,t.jsxs)(a.xuv,{className:"flex",children:[C?(0,t.jsx)(a.wpx,{onClick:R,className:"mr-2","data-testid":"test-btn",loading:d,icon:F.isVerified&&!d?(0,t.jsx)(a.StI,{}):void 0,children:d?"Verifying":F.isVerified?"Verified":F.status}):(0,t.jsx)(a.wpx,{onClick:()=>s.push(w.AD),className:"mr-2",children:"Cancel"}),(0,t.jsx)(a.wpx,{htmlType:"submit",type:"primary","data-testid":"save-btn",disabled:!x,children:"Save"})]})]})]})]})}),(0,t.jsx)(b,{serviceType:n.q.twilio_text,isOpen:f,onClose:()=>y(!1)})]})},E=e=>{let{configKey:i,initialProviderType:s}=e,[o,d]=(0,r.useState)(s||""),c=!!i,{handleError:u}=(0,l.HK)(),{data:m,isLoading:f,error:_}=(0,j.FU)({key:i},{skip:!i}),{data:y}=(0,j.qt)();(0,r.useEffect)(()=>{c&&(null==m?void 0:m.service_type)&&d(m.service_type)},[c,null==m?void 0:m.service_type]),(0,r.useEffect)(()=>{_&&u(_)},[_,u]);let p=(0,r.useMemo)(()=>{var e;let i=new Set((null==y?void 0:null===(e=y.items)||void 0===e?void 0:e.map(e=>e.service_type))||[]),s=!c&&i.has(n.q.mailgun),t=!c&&i.has(n.q.twilio_email),a=!c&&i.has(n.q.twilio_text),r=!c&&i.has(n.q.aws_ses);return[{value:n.q.mailgun,label:n.k.mailgun,disabled:s,title:s?"Only one messaging provider of each type can be created":void 0},{value:n.q.twilio_email,label:n.k.twilio_email,disabled:t,title:t?"Only one messaging provider of each type can be created":void 0},{value:n.q.twilio_text,label:n.k.twilio_text,disabled:a,title:a?"Only one messaging provider of each type can be created":void 0},{value:n.q.aws_ses,label:n.k.aws_ses,disabled:r,title:r?"Only one messaging provider of each type can be created":void 0}]},[y,c]);return c&&f?(0,t.jsx)(a.xuv,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:(0,t.jsx)(a.$jN,{})}):!c||m||f?(0,t.jsxs)(a.xuv,{children:[!c&&(0,t.jsxs)(a.xuv,{maxWidth:"720px",border:"1px",borderColor:"gray.200",borderRadius:6,overflow:"visible",mt:6,mb:4,children:[(0,t.jsx)(a.xuv,{backgroundColor:"gray.50",px:6,py:4,display:"flex",flexDirection:"row",alignItems:"center",borderBottom:"1px",borderColor:"gray.200",borderTopRadius:6,children:(0,t.jsx)(a.X6q,{as:"h3",size:"xs",children:"Select messaging provider"})}),(0,t.jsx)(a.xuv,{px:6,py:6,children:(0,t.jsx)(a.PPS,{layout:"vertical",children:(0,t.jsx)(a.PPS.Item,{label:"Provider type",name:"provider_type",rules:[{required:!0,message:"Please select a provider type"}],children:(0,t.jsx)(a.WPr,{placeholder:"Choose a messaging provider...",value:o||void 0,onChange:e=>d(e),options:p})})})})]}),o&&(()=>{switch(o){case n.q.mailgun:return(0,t.jsx)(q,{configKey:i});case n.q.twilio_email:return(0,t.jsx)(C,{configKey:i});case n.q.twilio_text:return(0,t.jsx)(I,{configKey:i});case n.q.aws_ses:return(0,t.jsx)(P,{configKey:i});default:return null}})()]}):(0,t.jsx)(a.xuv,{children:(0,t.jsxs)(a.xvT,{color:"red.500",children:["Messaging configuration not found for key: ",i]})})}},90710:function(e,i,s){s.d(i,{k:function(){return a},q:function(){return t}});let t={mailgun:"mailgun",twilio_email:"twilio_email",twilio_text:"twilio_text",aws_ses:"aws_ses"},a={mailgun:"Mailgun email",twilio_email:"Twilio email",twilio_text:"Twilio SMS",aws_ses:"AWS SES email"}}}]);