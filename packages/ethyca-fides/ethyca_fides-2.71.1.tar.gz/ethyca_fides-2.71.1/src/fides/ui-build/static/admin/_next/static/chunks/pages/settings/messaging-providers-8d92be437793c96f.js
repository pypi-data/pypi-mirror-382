(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5935],{9255:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/messaging-providers",function(){return i(60612)}])},19904:function(e,t,i){"use strict";i.d(t,{Tg:function(){return r}});var n=i(24246),s=i(16134),a=i(31793);let r=e=>(0,s.C)(a.uu).filter(t=>e.includes(t)).length>0;t.ZP=e=>{let{scopes:t,children:i}=e;return r(t)?(0,n.jsx)(n.Fragment,{children:i}):null}},8125:function(e,t,i){"use strict";i.d(t,{V:function(){return a},o:function(){return d}});var n=i(27378),s=i(32735);let a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{enableSelection:i=!1,getRowKey:a,bulkActions:r,isLoading:l=!1,isFetching:o=!1,dataSource:d=[],totalRows:c=0,currentPage:u,pageSize:g,customTableProps:p={}}=t,f=(0,n.useCallback)(e=>{if(e&&"object"==typeof e){if(e.id)return String(e.id);if(e.key)return String(e.key)}return String(e)},[]),m=a||f,[h,v]=(0,n.useState)([]),[x,y]=(0,n.useState)([]),S=(0,n.useCallback)(()=>{v([]),y([])},[]),b=(0,n.useMemo)(()=>({selectedRowKeys:h,selectedRows:x,resetSelections:S}),[h,x,S]),j=(0,n.useMemo)(()=>{if(i)return{selectedRowKeys:h,onChange:(e,t)=>{v(e),y(t)}}},[i,h]),_=(0,n.useCallback)((t,i,n)=>{var s,a;let r=null!==(s=t.current)&&void 0!==s?s:e.pageIndex,l=null!==(a=t.pageSize)&&void 0!==a?a:e.pageSize,o=r!==e.pageIndex||l!==e.pageSize;o?(t.current&&t.current!==e.pageIndex&&e.updatePageIndex(t.current),t.pageSize&&t.pageSize!==e.pageSize&&e.updatePageSize(t.pageSize)):e.updateFilters(i||{});let d=n&&!Array.isArray(n)?n.field:void 0,c=n&&!Array.isArray(n)&&null!==n.order?n.order:void 0;o||e.updateSorting(d,c)},[e]),C=(0,n.useMemo)(()=>{var t,i,n,a,r;return{current:null!=u?u:e.pageIndex,pageSize:null!=g?g:e.pageSize,total:c,showSizeChanger:null===(a=null===(t=e.paginationConfig)||void 0===t?void 0:t.showSizeChanger)||void 0===a||a,pageSizeOptions:null!==(r=null===(n=e.paginationConfig)||void 0===n?void 0:null===(i=n.pageSizeOptions)||void 0===i?void 0:i.map(String))&&void 0!==r?r:s.VZ}},[u,e.pageIndex,g,e.pageSize,c,e.paginationConfig]),k=(0,n.useMemo)(()=>({dataSource:d,loading:l||o,pagination:C,onChange:_,rowKey:m,scroll:{x:"max-content",scrollToFirstRowOnChange:!0},size:"small",bordered:!0,...p}),[d,l,o,C,_,m,p]),w=h.map(String),z=x.length>0,P=(0,n.useCallback)(e=>{let t=null==r?void 0:r.actions.find(t=>t.key===e);return t?{disabled:!z||!!t.disabled&&t.disabled(x),loading:t.loading||!1,onClick:()=>t.onClick(x)}:{disabled:!0,loading:!1}},[r,z,x]);return(0,n.useMemo)(()=>({tableProps:k,selectionProps:j,selectionState:b,selectedRows:x,selectedKeys:w,hasSelectedRows:z,resetSelections:S,getBulkActionProps:P,isLoadingOrFetching:l||o,hasData:d.length>0}),[k,j,b,x,w,z,S,P,l,o,d.length])};var r=i(40431),l=i(17245);let o=()=>({filters:(0,r.WJ)(e=>e).withDefault({})}),d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{pagination:t={},sorting:i={},search:s={},onStateChange:a}=e,{pageIndex:d,pageSize:c,resetPagination:u,updatePageIndex:g,updatePageSize:p,pageSizeOptions:f,showSizeChanger:m}=(0,l.h0)(t),{sortKey:h,sortOrder:v,updateSorting:x,resetSorting:y}=(0,l.rK)(i),{searchQuery:S,updateSearch:b,resetSearch:j}=(0,l.Rx)(s),_=(0,n.useMemo)(()=>o(),[]),[C,k]=(0,r.XI)(_,{history:"push"}),w=(0,n.useMemo)(()=>{var e;return{pageIndex:d,pageSize:c,sortKey:h,sortOrder:v,columnFilters:null!==(e=C.filters)&&void 0!==e?e:{},searchQuery:S}},[C,d,c,h,v,S]),z=(0,n.useCallback)((e,t)=>{x(e,t),u()},[x,u]),P=(0,n.useCallback)(e=>{let t=Object.fromEntries(Object.entries(e).filter(e=>{let[,t]=e;return null!=t}));k({filters:Object.keys(t).length>0?t:null}),u()},[k,u]),E=(0,n.useCallback)(e=>{b(e),u()},[b,u]),T=(0,n.useCallback)(()=>{k({filters:null}),u(),y(),j()},[k,u,y,j]);return(0,n.useEffect)(()=>{a&&a(w)},[w,a]),{state:w,pageIndex:w.pageIndex,pageSize:w.pageSize,updatePageIndex:g,updatePageSize:p,sortKey:w.sortKey,sortOrder:w.sortOrder,updateSorting:z,columnFilters:w.columnFilters,updateFilters:P,searchQuery:w.searchQuery,updateSearch:E,resetState:T,paginationConfig:{pageSizeOptions:f,showSizeChanger:m}}}},60612:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return P}});var n,s,a=i(24246),r=i(96306),l=i(77213),o=i(77830),d=i(47935),c=i(812),u=i(17245),g=i(86677),p=i(27378),f=i(8125),m=i(7426),h=i(21910),v=i(19904),x=i(17828),y=i(44907),S=i(5144),b=i(42478),j=i(51980),_=i(16394),C=e=>{let{messagingConfig:t}=e,{last_test_succeeded:i,last_test_timestamp:n}=t;if(!n)return(0,a.jsx)(r.j8w,{children:"Verify configuration"});let s=new Date(n),l=(0,_.p6)(s),o=(0,j.B)(s,new Date,{addSuffix:!0});return(0,a.jsx)(r.esZ,{title:"Last verified: ".concat(l),children:(0,a.jsxs)(r.j8w,{color:i?"success":"error","data-testid":i?"test-success":"test-error",children:[i?"Succeeded":"Failed"," ",o]})})};(n=s||(s={})).NAME="name",n.VERIFICATION_STATUS="verification_status",n.ENABLED="enabled",n.ACTIONS="actions";let k=()=>{let e=(0,g.useRouter)(),{handleError:t}=(0,u.HK)(),[i,n]=(0,p.useState)(null),[l]=(0,m.L)(),[d]=(0,b.W)(),j=(0,v.Tg)([h.Sh.MESSAGING_CREATE_OR_UPDATE]),[_,k]=(0,p.useState)(!1),[w,z]=(0,p.useState)(null),P=(0,f.o)({pagination:{defaultPageSize:25,pageSizeOptions:[25,50,100]},sorting:{validColumns:Object.values(s),defaultSortKey:"name",defaultSortOrder:"ascend"}}),{data:E,isLoading:T}=(0,b.JE)(),{data:I,isLoading:O}=(0,b.qt)();(0,p.useEffect)(()=>{E?n(E.service_type):n(null)},[E]);let A=(0,p.useCallback)(async e=>{try{let i=await l({notifications:{notification_service_type:e}});(0,c.D4)(i)?t(i.error):(n(e),r.Pg3.success(e?"Updated active messaging config":"Disabled active messaging config"))}catch(e){t(e)}},[l,t,n]),M=(0,p.useCallback)(t=>{var i,n;let s=o.GE.replace("[key]",t.key);e.push({pathname:s,query:{last_test_succeeded:null!==(i=t.last_test_succeeded)&&void 0!==i?i:"",last_test_timestamp:null!==(n=t.last_test_timestamp)&&void 0!==n?n:""}})},[e]),D=(0,p.useCallback)((e,t)=>{z({key:e,name:t}),k(!0)},[]),F=(0,p.useCallback)(async()=>{if(w)try{let e=await d({key:w.key});(0,c.D4)(e)?t(e.error):r.Pg3.success("Messaging configuration successfully deleted")}catch(e){t(e)}finally{k(!1),z(null)}},[w,d,t]),N=(0,p.useCallback)(()=>{k(!1),z(null)},[]),R=(0,p.useMemo)(()=>({enableSelection:!1,getRowKey:e=>e.key,isLoading:O||T,dataSource:(null==I?void 0:I.items)||[],totalRows:(null==I?void 0:I.total)||0,customTableProps:{size:"small",pagination:{hideOnSinglePage:!0,showSizeChanger:!0,pageSizeOptions:["25","50","100"]}}}),[O,T,null==I?void 0:I.items,null==I?void 0:I.total]),Z=(0,f.V)(P,R),L=(0,p.useMemo)(()=>[{title:"Provider type",dataIndex:"name",key:"name",render:(e,t)=>(0,a.jsxs)(r.Ugi,{children:[(()=>{switch(t.service_type){case"mailgun":return(0,a.jsx)(y.Z,{});case"twilio_text":case"twilio_email":default:return(0,a.jsx)(S.Z,{});case"aws_ses":return(0,a.jsx)(x.Z,{})}})(),(0,a.jsx)(r.xvT,{children:e})]})},{title:"Verification status",key:"verification_status",render:(e,t)=>(0,a.jsx)(C,{messagingConfig:t})},{title:"Enabled",key:"enabled",width:100,render:(e,t)=>{let n=t.service_type===i,s=!!t.last_test_timestamp&&""!==t.last_test_timestamp&&!1===t.last_test_succeeded&&!n,l=(0,a.jsx)(r.rAg,{checked:n,disabled:s,onChange:e=>{e?A(t.service_type):A(null)}});return s?(0,a.jsx)(r.esZ,{title:"This provider cannot be enabled because its last test failed. Please fix the configuration and test again.",children:l}):l}},{title:"Actions",key:"actions",render:(e,t)=>(0,a.jsxs)(r.Ugi,{children:[j&&(0,a.jsx)(r.wpx,{onClick:e=>{e.stopPropagation(),M(t)},size:"small",icon:(0,a.jsx)(r.PJP.I8b,{}),title:"Edit","aria-label":"Edit messaging configuration","data-testid":"edit-messaging-config-btn"}),j&&(0,a.jsx)(r.wpx,{onClick:e=>{e.stopPropagation(),D(t.key,t.name)},size:"small",icon:(0,a.jsx)(r.PJP.ZNm,{}),title:"Delete","aria-label":"Delete messaging configuration","data-testid":"delete-messaging-config-btn"})]})}],[j,i,M,D,A]),V=(0,p.useMemo)(()=>(0,a.jsx)(r.$zI,{title:"Delete messaging configuration",open:_,onCancel:N,footer:[(0,a.jsx)(r.wpx,{onClick:N,children:"Cancel"},"cancel"),(0,a.jsx)(r.wpx,{type:"primary",danger:!0,onClick:F,children:"Delete"},"delete")],children:(0,a.jsxs)(r.vyj,{direction:"vertical",children:[(0,a.jsxs)(r.xvT,{children:['Are you sure you want to delete "',(0,a.jsx)("strong",{children:null==w?void 0:w.name}),'" messaging configuration?']}),(0,a.jsx)(r.xvT,{children:"This action cannot be undone."})]})}),[_,null==w?void 0:w.name,N,F]);return{columns:L,tableProps:Z.tableProps,selectionProps:Z.selectionProps,userCanUpdate:j,isLoading:O||T,deleteModal:V,handleEditConfiguration:M,handleDeleteConfiguration:D,setActiveServiceType:A}},w=()=>(0,a.jsx)(r.gCW,{mt:6,p:10,spacing:4,borderRadius:"base",maxW:"70%","data-testid":"no-results-notice",alignSelf:"center",margin:"auto",children:(0,a.jsxs)(r.gCW,{children:[(0,a.jsx)(r.xvT,{fontSize:"md",fontWeight:"600",children:"No messaging providers found."}),(0,a.jsx)(r.xvT,{fontSize:"sm",children:'Click "Add a messaging provider" to add your first messaging provider to Fides.'})]})}),z=()=>{let{columns:e,tableProps:t,userCanUpdate:i,isLoading:n,deleteModal:s}=k();return(0,a.jsxs)(l.Z,{title:"Messaging providers",children:[(0,a.jsx)(r.X6q,{mb:5,fontSize:"2xl",fontWeight:"semibold",children:"Manage messaging providers"}),(0,a.jsxs)(r.xvT,{fontSize:"sm",mb:8,width:{base:"100%",lg:"70%"},children:["Fides requires a messaging provider for sending processing notices to privacy request subjects, and allows for Subject Identity Verification in privacy requests. Please follow the"," ",(0,a.jsx)(r.xvT,{as:"span",color:"complimentary.500",children:"documentation"})," ","to setup a messaging service that Fides supports. Ensure you have completed the setup for the preferred messaging provider and have the details handy prior to the following steps."]}),(0,a.jsxs)(r.kCb,{flex:1,direction:"column",overflow:"auto",children:[i&&(0,a.jsx)(r.vyj,{direction:"horizontal",style:{width:"100%",justifyContent:"flex-end",marginBottom:16},children:(0,a.jsx)(r.wpx,{href:"".concat(o.AD,"/new"),role:"link",type:"primary",icon:(0,a.jsx)(r.PJP.mm_,{}),iconPosition:"end","data-testid":"add-messaging-provider-btn",children:"Add a messaging provider"})}),n?(0,a.jsx)(d.I4,{rowHeight:36,numRows:5}):(0,a.jsx)(r.V5H,{...t,columns:e,locale:{emptyText:(0,a.jsx)(w,{})}})]}),s]})};var P=()=>(0,a.jsx)(z,{})}},function(e){e.O(0,[431,502,2888,9774,179],function(){return e(e.s=9255)}),_N_E=e.O()}]);