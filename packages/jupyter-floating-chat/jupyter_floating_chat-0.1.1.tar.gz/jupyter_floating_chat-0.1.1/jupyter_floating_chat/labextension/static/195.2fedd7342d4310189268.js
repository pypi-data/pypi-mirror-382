"use strict";(self.webpackChunkjupyter_floating_chat=self.webpackChunkjupyter_floating_chat||[]).push([[195],{195:(t,e,o)=>{o.r(e),o.d(e,{IFloatingChatOptions:()=>y,default:()=>b});var n=o(722),i=o(316),a=o(419),s=o(794),l=o(256),c=o(345),d=o.n(c),r=o(180),h=o(222);const p=({model:t,toolbarRegistry:e,onClose:o,onCancel:n})=>{const i=d().useRef(null);return d().useEffect(()=>{var t,e;null===(e=null===(t=i.current)||void 0===t?void 0:t.getElementsByTagName("textarea").item(0))||void 0===e||e.focus()},[]),d().createElement("div",{className:"floating-input-container"},d().createElement("div",{className:"floating-input-header"},d().createElement("div",{className:"floating-input-title"},"ðŸ’¬ Chat"),d().createElement(r.Button,{className:"floating-input-close",onClick:o},d().createElement(h.LabIcon.resolveReact,{display:"flex",icon:h.closeIcon,iconClass:(0,h.classes)("jp-Icon")}))),d().createElement("div",{ref:i,className:"floating-input-body"},d().createElement(a.ChatInput,{model:t,toolbarRegistry:e,onCancel:n})))};class u extends s.ReactWidget{constructor(t){var e,o,n;if(super(),this._chatModel=t.chatModel,this._toolbarRegistry=null!==(e=t.toolbarRegistry)&&void 0!==e?e:a.InputToolbarRegistry.defaultToolbarRegistry(),this._toolbarRegistry.hide("attach"),this._position=t.position,this._originalSend=this._chatModel.input.send,this._chatModel.input.send=t=>{this._originalSend.call(this,t),this.dispose()},t.targetType&&t.target){const e=t.notebookTracker.currentWidget;if(!e)return;const i={type:"notebook",value:e.context.path};let a;if("Cell"===t.targetType){const o=t.target.closest(".jp-Cell");if(o&&void 0!==o.dataset.windowedListIndex){a=e.content.widgets[+o.dataset.windowedListIndex];const t=a.model.type;i.cells=[{input_type:t,id:a.id}]}}null===(n=(o=this._chatModel.input).addAttachment)||void 0===n||n.call(o,i)}this.addClass("floating-input-widget"),this.id="floating-input-widget"}render(){return d().createElement(p,{model:this._chatModel.input,toolbarRegistry:this._toolbarRegistry,onClose:()=>this.dispose()})}attach(){l.Widget.attach(this,document.body)}detach(){l.Widget.detach(this)}onAfterAttach(t){if(super.onAfterAttach(t),this.node.style.position="fixed",this.node.style.zIndex="1000",this._position){let{x:t,y:e}=this._position;const o=this.node.getBoundingClientRect(),n=window.innerWidth-o.width,i=window.innerHeight-o.height;t=Math.max(0,Math.min(t,n)),e=Math.max(0,Math.min(e,i)),this.node.style.left=`${t}px`,this.node.style.top=`${e}px`}else this.node.style.right="20px",this.node.style.bottom="20px";document.addEventListener("click",this._onDocumentClick.bind(this))}_onDocumentClick(t){this.node.contains(t.target)||this.dispose()}dispose(){this.isDisposed||(document.removeEventListener("click",this._onDocumentClick.bind(this)),this._chatModel.input.value="",this._chatModel.input.clearAttachments(),this._chatModel.input.send=this._originalSend,super.dispose())}}var g,m=o(262);!function(t){t.openInput="jupyter-floating-chat:open-input"}(g||(g={}));const y=new m.Token("jupyter-floating-chat:options","The default options for the floating chat."),f={id:"jupyter-floating-chat:plugin",description:"A JupyterLab extension to add a floating chat.",autoStart:!0,optional:[i.ISettingRegistry,n.INotebookTracker],provides:y,activate:(t,e,o)=>{console.log("JupyterLab extension jupyter-floating-chat is activated!");const n={};let i=null,a={x:0,y:0},s=null;return document.addEventListener("contextmenu",t=>{a={x:t.clientX,y:t.clientY},s=t.target}),t.commands.addCommand(g.openInput,{label:t=>`Chat (${t.targetType})`,isVisible:()=>!!n.chatModel,execute:t=>{if(i&&!i.isDisposed)i.dispose(),i=null;else{if(void 0===n.chatModel)return;i=new u({...n,chatModel:n.chatModel,notebookTracker:o,position:a,target:s,targetType:t.targetType}),i.attach()}}}),t.contextMenu.addItem({command:g.openInput,selector:".jp-Notebook",rank:0,args:{targetType:"Notebook"}}),t.contextMenu.addItem({command:g.openInput,selector:".jp-Cell",rank:0,args:{targetType:"Cell"}}),e&&e.load(f.id).then(t=>{console.log("jupyter-floating-chat settings loaded:",t.composite)}).catch(t=>{console.error("Failed to load settings for jupyter-floating-chat.",t)}),n}},b=f}}]);