<!-- Archive Directory Contents Template -->
<div class="archive-browser">
    <div class="archive-header mb-4">
        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Archive: {{ archive_name }}</h3>
        
        <!-- Breadcrumb Navigation -->
        <div class="breadcrumb-nav mt-2">
            <button 
                hx-post="/api/repositories/{{ repository.id }}/archives/{{ archive_name }}/contents/load-with-spinner"
                hx-target="closest .archive-browser"
                hx-swap="outerHTML"
                class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 underline">
                Root
            </button>
            {% if path %}
                {% for part in breadcrumb_parts %}
                    {% if part %}
                        {% set current_path = breadcrumb_parts[:loop.index] | join('/') %}
                        {% if loop.last %}
                            / <span class="text-sm font-medium text-gray-900 dark:text-gray-100">{{ part }}</span>
                        {% else %}
                            / <button 
                                hx-post="/api/repositories/{{ repository.id }}/archives/{{ archive_name }}/contents/load-with-spinner"
                                hx-vals='{"path": "{{ current_path }}"}'
                                hx-target="closest .archive-browser"
                                hx-swap="outerHTML"
                                class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 underline">
                                {{ part }}
                            </button>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% else %}
                / <span class="text-sm font-medium text-gray-900 dark:text-gray-100">Root Directory</span>
            {% endif %}
        </div>
    </div>


    <!-- Directory Tree -->
    <div class="archive-tree border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700">
        {% if items %}
            <div class="directory-contents">
                {% for item in items %}
                    <div class="tree-node flex items-center py-2 px-4 hover:bg-gray-50 dark:hover:bg-gray-600 border-b last:border-b-0 dark:border-gray-600">
                        <!-- File/Directory Icon -->
                        {% if item.isdir %}
                            <svg class="w-5 h-5 text-blue-500 dark:text-blue-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path>
                            </svg>
                        {% else %}
                            <svg class="w-5 h-5 text-gray-400 dark:text-gray-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z" clip-rule="evenodd"></path>
                            </svg>
                        {% endif %}

                        <!-- File/Directory Name -->
                        <div class="flex-1">
                            {% if item.isdir %}
                                <button 
                                    hx-post="/api/repositories/{{ repository.id }}/archives/{{ archive_name }}/contents/load-with-spinner"
                                    hx-vals='{"path": "{{ item.path }}"}'
                                    hx-target="closest .archive-browser"
                                    hx-swap="outerHTML"
                                    class="text-left text-sm text-gray-900 dark:text-gray-100 hover:text-blue-600 dark:hover:text-blue-400 cursor-pointer">
                                    {{ item.name }}
                                </button>
                            {% else %}
                                <span class="text-sm text-gray-900 dark:text-gray-100">{{ item.name }}</span>
                            {% endif %}
                        </div>

                        <!-- File Size -->
                        {% if not item.isdir and item.size is not none %}
                            <span class="text-xs text-gray-500 dark:text-gray-400 mr-4">
                                {% if item.size < 1024 %}
                                    {{ item.size }} B
                                {% elif item.size < 1048576 %}
                                    {{ "%.1f"|format(item.size / 1024) }} KB
                                {% elif item.size < 1073741824 %}
                                    {{ "%.1f"|format(item.size / 1048576) }} MB
                                {% else %}
                                    {{ "%.1f"|format(item.size / 1073741824) }} GB
                                {% endif %}
                            </span>
                        {% endif %}

                        <!-- Modified Date -->
                        {% if item.modified %}
                            <span class="text-xs text-gray-500 dark:text-gray-400 mr-4">
                                {{ item.modified }}
                            </span>
                        {% endif %}

                        <!-- Download Button for Files -->
                        {% if not item.isdir %}
                            <a href="/api/repositories/{{ repository.id }}/archives/{{ archive_name }}/extract?file={{ item.path | urlencode }}"
                               download="{{ item.name }}"
                               class="p-1 text-gray-400 dark:text-gray-500 hover:text-blue-600 dark:hover:text-blue-400 rounded"
                               title="Download file">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </a>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="p-8 text-center text-gray-500 dark:text-gray-400">
                <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                </svg>
                <p class="text-sm">This directory is empty</p>
            </div>
        {% endif %}
    </div>
</div>