[tox]
envlist = lint,py{310,311,312,313}-{motor,pymongo3,pymongo4,txmongo}

[testenv]
setenv =
    PYTHONPATH = {toxinidir}:{toxinidir}/umongo
deps =
    pytest>=4.0.0
    pytest-cov>=7.0.0
    coverage>=5.3.0
    motor: motor>=3.0,<4.0
    pymongo3: pymongo>3,<4
    pymongo3: mongomock>=3.5.0
    pymongo4: pymongo>4,<5
    pymongo4: mongomock>=3.5.0
    txmongo: pymongo<3.11
    txmongo: txmongo>=19.2.0
    txmongo: pytest-twisted>=1.12

commands =
    pytest --cov --cov-branch --cov-report=xml

[testenv:lint]
deps = pre-commit>=3.5,<5.0
skip_install = true
commands = pre-commit run --all-files

[testenv:docs]
extras =
    docs
    motor
    txmongo
    mongomock
commands = sphinx-build --fresh-env docs/ docs/_build {posargs}
