<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Analysis Report - {{ executive_summary.overview.total_pages_analyzed|default(url) }} Pages</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --color-pass: #0cce6b;
            --color-average: #ffa400;
            --color-fail: #ff4e42;
            --color-primary: #4285f4;
            --color-dark: #202124;
            --color-gray: #5f6368;
            --color-light-gray: #f8f9fa;
            --color-border: #dadce0;
            --shadow-sm: 0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15);
            --shadow-md: 0 1px 3px 0 rgba(60,64,67,.3), 0 4px 8px 3px rgba(60,64,67,.15);
        }
        
        body {
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--color-dark);
            background: var(--color-light-gray);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Executive Summary */
        .executive-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }
        
        .executive-summary h2 {
            font-size: 32px;
            margin-bottom: 20px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .summary-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        
        .summary-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Navigation */
        .nav-container {
            background: white;
            padding: 0;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 20px;
            z-index: 100;
        }
        
        .nav-tabs {
            display: flex;
            overflow-x: auto;
            border-bottom: 1px solid var(--color-border);
        }
        
        .nav-tab {
            padding: 16px 24px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 500;
            color: var(--color-gray);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
            position: relative;
        }
        
        .nav-tab:hover {
            color: var(--color-dark);
            background: var(--color-light-gray);
        }
        
        .nav-tab.active {
            color: var(--color-primary);
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--color-primary);
        }
        
        /* Tab Panels */
        .tab-panel {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Score Section */
        .score-section {
            background: white;
            padding: 40px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
        }
        
        .score-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
        }
        
        .score-card {
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            background: var(--color-light-gray);
        }
        
        .main-score-card {
            grid-column: span 2;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        /* Issues Section */
        .issues-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
        }
        
        .issue-stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: var(--color-light-gray);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .aggregated-issue {
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid;
            background: var(--color-light-gray);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .aggregated-issue:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-sm);
        }
        
        .aggregated-issue.critical {
            border-color: var(--color-fail);
            background: #ffebee;
        }
        
        .aggregated-issue.warning {
            border-color: var(--color-average);
            background: #fff8e1;
        }
        
        .aggregated-issue.notice {
            border-color: var(--color-primary);
            background: #e3f2fd;
        }
        
        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .issue-count-badge {
            background: rgba(0,0,0,0.1);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .issue-details {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0,0,0,0.1);
        }
        
        .aggregated-issue.expanded .issue-details {
            display: block;
        }
        
        /* Recommendations */
        .recommendations-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
        }
        
        .recommendation-card {
            padding: 24px;
            margin-bottom: 20px;
            border-radius: 8px;
            background: var(--color-light-gray);
            border-left: 4px solid;
            position: relative;
        }
        
        .recommendation-card.HIGH {
            border-color: var(--color-fail);
        }
        
        .recommendation-card.MEDIUM {
            border-color: var(--color-average);
        }
        
        .recommendation-card.LOW {
            border-color: var(--color-primary);
        }
        
        .rec-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .rec-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-dark);
        }
        
        .rec-badges {
            display: flex;
            gap: 8px;
        }
        
        .rec-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .priority-badge {
            background: #ffebee;
            color: var(--color-fail);
        }
        
        .effort-badge {
            background: #e3f2fd;
            color: var(--color-primary);
        }
        
        .rec-implementation {
            margin-top: 12px;
            padding: 12px;
            background: white;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        
        /* Performance Section */
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
        }
        
        .chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        /* Pages Table */
        .pages-table-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
            overflow-x: auto;
        }
        
        .pages-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .pages-table th {
            text-align: left;
            padding: 12px;
            font-weight: 600;
            border-bottom: 2px solid var(--color-border);
            background: var(--color-light-gray);
        }
        
        .pages-table td {
            padding: 12px;
            border-bottom: 1px solid var(--color-border);
        }
        
        .pages-table tr:hover {
            background: var(--color-light-gray);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }
        
        .page-btn {
            padding: 8px 12px;
            border: 1px solid var(--color-border);
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .page-btn:hover {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        
        .page-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        
        /* Quick Wins */
        .quick-wins {
            background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            color: white;
        }
        
        .quick-win-item {
            padding: 12px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            margin-bottom: 12px;
            backdrop-filter: blur(10px);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .summary-grid,
            .score-grid,
            .performance-grid {
                grid-template-columns: 1fr;
            }
            
            .main-score-card {
                grid-column: span 1;
            }
            
            .nav-tabs {
                overflow-x: scroll;
            }
        }
        
        /* Print Styles */
        @media print {
            .nav-container {
                position: static;
            }
            
            .tab-panel {
                display: block !important;
            }
            
            .aggregated-issue,
            .recommendation-card {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Executive Summary -->
        <section class="executive-summary">
            <h2>SEO Analysis Executive Summary</h2>
            <p>
                {% if executive_summary %}
                Analyzed <strong>{{ executive_summary.overview.total_pages_analyzed }}</strong> pages
                with an overall health status of <strong>{{ executive_summary.overview.overall_health }}</strong>.
                {% else %}
                Comprehensive SEO analysis report for {{ url }}.
                {% endif %}
            </p>
            
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-value">{{ overall_score|round|int }}/100</div>
                    <div class="summary-label">Overall Score</div>
                </div>
                {% if executive_summary %}
                <div class="summary-card">
                    <div class="summary-value">{{ executive_summary.overview.successful_pages }}</div>
                    <div class="summary-label">Pages Analyzed</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value">{{ executive_summary.key_metrics.critical_issues }}</div>
                    <div class="summary-label">Critical Issues</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value">{{ issue_counts.unique|default(issue_counts.total) }}</div>
                    <div class="summary-label">Unique Issues</div>
                </div>
                {% endif %}
            </div>
        </section>
        
        <!-- Navigation -->
        <nav class="nav-container">
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="overview">📊 Overview</button>
                <button class="nav-tab" data-tab="issues">⚠️ Issues ({{ issue_counts.unique|default(issue_counts.total) }})</button>
                <button class="nav-tab" data-tab="recommendations">💡 Recommendations</button>
                <button class="nav-tab" data-tab="performance">⚡ Performance</button>
                <button class="nav-tab" data-tab="pages">📄 Pages</button>
            </div>
        </nav>
        
        <!-- Overview Tab -->
        <div class="tab-panel active" id="overview">
            {% if executive_summary.quick_wins %}
            <section class="quick-wins">
                <h3>🎯 Quick Wins (High Impact, Low Effort)</h3>
                {% for win in executive_summary.quick_wins %}
                <div class="quick-win-item">
                    <strong>{{ win.title }}</strong> - {{ win.description }}
                </div>
                {% endfor %}
            </section>
            {% endif %}
            
            <section class="score-section">
                <h3>Category Scores</h3>
                <div class="score-grid">
                    <div class="score-card main-score-card">
                        <h4>Overall Performance</h4>
                        <div style="font-size: 48px; font-weight: bold; color: {% if overall_score >= 80 %}var(--color-pass){% elif overall_score >= 50 %}var(--color-average){% else %}var(--color-fail){% endif %}">
                            {{ overall_score|round|int }}/100
                        </div>
                        <canvas id="overallChart" width="200" height="200"></canvas>
                    </div>
                    {% for category, score in category_scores.items() %}
                    <div class="score-card">
                        <h4>{{ category|title }}</h4>
                        <div style="font-size: 36px; font-weight: bold; color: {% if score >= 80 %}var(--color-pass){% elif score >= 50 %}var(--color-average){% else %}var(--color-fail){% endif %}">
                            {{ score|round|int }}
                        </div>
                        <progress value="{{ score }}" max="100" style="width: 100%; height: 8px;"></progress>
                    </div>
                    {% endfor %}
                </div>
            </section>
            
            <div class="performance-grid">
                <div class="chart-container">
                    <h3 class="chart-title">Issue Distribution</h3>
                    <canvas id="issueDistChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">Category Performance</h3>
                    <canvas id="categoryRadarChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Issues Tab -->
        <div class="tab-panel" id="issues">
            <section class="issues-container">
                <div class="issue-stats-bar">
                    <h3>Issues Analysis</h3>
                    <div style="display: flex; gap: 20px;">
                        <span>🔴 Critical: {{ issue_counts.critical }}</span>
                        <span>🟡 Warnings: {{ issue_counts.warning }}</span>
                        <span>🔵 Notices: {{ issue_counts.notice }}</span>
                        {% if aggregation_stats %}
                        <span>📊 Aggregated: {{ (aggregation_stats.reduction_ratio * 100)|round|int }}% reduction</span>
                        {% endif %}
                    </div>
                </div>
                
                {% if aggregated_issues %}
                    <h4>Top Issues (Aggregated)</h4>
                    {% for issue in aggregated_issues[:20] %}
                    <div class="aggregated-issue {{ issue.severity }}" onclick="this.classList.toggle('expanded')">
                        <div class="issue-header">
                            <div>
                                <strong>[{{ issue.category }}]</strong> {{ issue.message }}
                            </div>
                            <div class="issue-count-badge">
                                {{ issue.count }} occurrence{% if issue.count > 1 %}s{% endif %}
                                on {{ issue.pages_affected }} page{% if issue.pages_affected > 1 %}s{% endif %}
                            </div>
                        </div>
                        {% if issue.example_pages %}
                        <div class="issue-details">
                            <strong>Example pages:</strong>
                            <ul>
                                {% for page in issue.example_pages[:5] %}
                                <li>{{ page }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    {% for issue in issues[:20] %}
                    <div class="aggregated-issue {{ issue.severity }}">
                        <div class="issue-header">
                            <div>
                                <strong>[{{ issue.category }}]</strong> {{ issue.message }}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
            </section>
        </div>
        
        <!-- Recommendations Tab -->
        <div class="tab-panel" id="recommendations">
            <section class="recommendations-container">
                <h3>Actionable Recommendations</h3>
                
                {% if enhanced_recommendations %}
                    {% for rec in enhanced_recommendations %}
                    <div class="recommendation-card {{ rec.priority }}">
                        <div class="rec-header">
                            <h4 class="rec-title">{{ loop.index }}. {{ rec.title }}</h4>
                            <div class="rec-badges">
                                <span class="rec-badge priority-badge">{{ rec.priority }}</span>
                                <span class="rec-badge effort-badge">{{ rec.effort }} effort</span>
                            </div>
                        </div>
                        <p>{{ rec.description }}</p>
                        <p><strong>Impact:</strong> {{ rec.impact }}</p>
                        <p><strong>Affected Pages:</strong> {{ rec.affected_pages }}</p>
                        {% if rec.implementation %}
                        <details>
                            <summary style="cursor: pointer; margin-top: 12px;"><strong>Implementation Guide</strong></summary>
                            <div class="rec-implementation">{{ rec.implementation }}</div>
                        </details>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    {% for rec in recommendations %}
                    <div class="recommendation-card MEDIUM">
                        <p>{{ loop.index }}. {{ rec }}</p>
                    </div>
                    {% endfor %}
                {% endif %}
            </section>
        </div>
        
        <!-- Performance Tab -->
        <div class="tab-panel" id="performance">
            <section class="issues-container">
                <h3>Performance Metrics</h3>
                
                {% if performance_metrics %}
                <div class="performance-grid">
                    <div class="chart-container">
                        <h4 class="chart-title">Load Time Distribution</h4>
                        <canvas id="loadTimeChart"></canvas>
                        {% if performance_metrics.load_time_stats %}
                        <div style="margin-top: 12px;">
                            <small>
                                Avg: {{ performance_metrics.load_time_stats.average|round(2) }}s |
                                Min: {{ performance_metrics.load_time_stats.min|round(2) }}s |
                                Max: {{ performance_metrics.load_time_stats.max|round(2) }}s
                            </small>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="chart-container">
                        <h4 class="chart-title">Status Code Distribution</h4>
                        <canvas id="statusCodeChart"></canvas>
                    </div>
                </div>
                
                {% if performance_metrics.slowest_pages %}
                <div style="margin-top: 30px;">
                    <h4>Slowest Pages</h4>
                    <table class="pages-table">
                        <thead>
                            <tr>
                                <th>URL</th>
                                <th>Load Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for page in performance_metrics.slowest_pages[:5] %}
                            <tr>
                                <td>{{ page.url|truncate(80) }}</td>
                                <td>{{ page.time|round(2) }}s</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
                {% endif %}
            </section>
        </div>
        
        <!-- Pages Tab -->
        <div class="tab-panel" id="pages">
            <section class="pages-table-container">
                <h3>Page Analysis Summary</h3>
                {% if pages_summary %}
                <table class="pages-table" id="pagesTable">
                    <thead>
                        <tr>
                            <th>URL</th>
                            <th>Score</th>
                            <th>Status</th>
                            <th>Load Time</th>
                            <th>Issues</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for page in pages_summary[:20] %}
                        <tr>
                            <td>{{ page.url|truncate(60) }}</td>
                            <td style="color: {% if page.score >= 80 %}var(--color-pass){% elif page.score >= 50 %}var(--color-average){% else %}var(--color-fail){% endif %}">
                                {{ page.score|round|int }}
                            </td>
                            <td>{{ page.status_code }}</td>
                            <td>{{ page.load_time|round(2) }}s</td>
                            <td>{{ page.issue_count }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                {% if pages_summary|length > 20 %}
                <div class="pagination">
                    <button class="page-btn" onclick="changePage(-1)">Previous</button>
                    <span id="pageInfo">Page 1 of {{ (pages_summary|length / 20)|round(0, 'ceil')|int }}</span>
                    <button class="page-btn" onclick="changePage(1)">Next</button>
                </div>
                {% endif %}
                
                {% if pages_truncated %}
                <p style="margin-top: 20px; color: var(--color-gray);">
                    Note: Showing top {{ pages_summary|length }} pages. {{ pages_truncated_count }} additional pages analyzed but not shown.
                </p>
                {% endif %}
                {% endif %}
            </section>
        </div>
    </div>
    
    <script>
        // Tab switching
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Update active tab
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding panel
                const tabName = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(tabName).classList.add('active');
            });
        });
        
        // Chart.js configuration
        Chart.defaults.font.family = "'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif";
        
        // Overall Score Gauge
        const overallCtx = document.getElementById('overallChart');
        if (overallCtx) {
            new Chart(overallCtx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [{{ overall_score|round|int }}, {{ 100 - overall_score|round|int }}],
                        backgroundColor: [
                            '{% if overall_score >= 80 %}#0cce6b{% elif overall_score >= 50 %}#ffa400{% else %}#ff4e42{% endif %}',
                            '#e8eaed'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });
        }
        
        // Issue Distribution Chart
        const issueCtx = document.getElementById('issueDistChart');
        if (issueCtx) {
            new Chart(issueCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Critical', 'Warnings', 'Notices'],
                    datasets: [{
                        data: [
                            {{ issue_counts.critical|default(0) }},
                            {{ issue_counts.warning|default(0) }},
                            {{ issue_counts.notice|default(0) }}
                        ],
                        backgroundColor: ['#ff4e42', '#ffa400', '#4285f4']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }
        
        // Category Radar Chart
        const radarCtx = document.getElementById('categoryRadarChart');
        if (radarCtx) {
            new Chart(radarCtx, {
                type: 'radar',
                data: {
                    labels: {{ category_scores.keys()|list|tojson }},
                    datasets: [{
                        label: 'Scores',
                        data: {{ category_scores.values()|list|tojson }},
                        backgroundColor: 'rgba(66, 133, 244, 0.2)',
                        borderColor: '#4285f4',
                        pointBackgroundColor: '#4285f4',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#4285f4'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { stepSize: 20 }
                        }
                    }
                }
            });
        }
        
        {% if performance_metrics and performance_metrics.load_times %}
        // Load Time Chart
        const loadTimeCtx = document.getElementById('loadTimeChart');
        if (loadTimeCtx) {
            const loadTimes = {{ performance_metrics.load_times|tojson }};
            const timeRanges = {'0-1s': 0, '1-2s': 0, '2-3s': 0, '3-5s': 0, '5s+': 0};
            
            loadTimes.forEach(item => {
                const time = item.time;
                if (time <= 1) timeRanges['0-1s']++;
                else if (time <= 2) timeRanges['1-2s']++;
                else if (time <= 3) timeRanges['2-3s']++;
                else if (time <= 5) timeRanges['3-5s']++;
                else timeRanges['5s+']++;
            });
            
            new Chart(loadTimeCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(timeRanges),
                    datasets: [{
                        label: 'Number of Pages',
                        data: Object.values(timeRanges),
                        backgroundColor: '#4285f4'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
        
        // Status Code Chart
        const statusCtx = document.getElementById('statusCodeChart');
        if (statusCtx) {
            const statusCodes = {{ performance_metrics.status_codes|tojson }};
            new Chart(statusCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(statusCodes),
                    datasets: [{
                        data: Object.values(statusCodes),
                        backgroundColor: [
                            '#0cce6b', '#4285f4', '#ffa400', '#ff4e42', '#9c27b0'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }
        {% endif %}
        
        // Pagination for pages table
        let currentPage = 1;
        const rowsPerPage = 20;
        const pagesData = {{ pages_summary|tojson if pages_summary else '[]' }};
        
        function changePage(direction) {
            const totalPages = Math.ceil(pagesData.length / rowsPerPage);
            currentPage += direction;
            
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            
            displayPage();
        }
        
        function displayPage() {
            const table = document.querySelector('#pagesTable tbody');
            if (!table) return;
            
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const pageData = pagesData.slice(start, end);
            
            table.innerHTML = pageData.map(page => `
                <tr>
                    <td>${page.url.substring(0, 60)}${page.url.length > 60 ? '...' : ''}</td>
                    <td style="color: ${page.score >= 80 ? 'var(--color-pass)' : page.score >= 50 ? 'var(--color-average)' : 'var(--color-fail)'}">
                        ${Math.round(page.score)}
                    </td>
                    <td>${page.status_code}</td>
                    <td>${page.load_time.toFixed(2)}s</td>
                    <td>${page.issue_count}</td>
                </tr>
            `).join('');
            
            const pageInfo = document.getElementById('pageInfo');
            if (pageInfo) {
                pageInfo.textContent = `Page ${currentPage} of ${Math.ceil(pagesData.length / rowsPerPage)}`;
            }
        }
    </script>
</body>
</html>
