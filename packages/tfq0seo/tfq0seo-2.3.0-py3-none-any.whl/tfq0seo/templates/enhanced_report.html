<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Analysis Report - {{ url }}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --color-pass: #0cce6b;
            --color-average: #ffa400;
            --color-fail: #ff4e42;
            --color-primary: #4285f4;
            --color-dark: #202124;
            --color-gray: #5f6368;
            --color-light-gray: #f8f9fa;
            --color-border: #dadce0;
            --shadow-sm: 0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15);
            --shadow-md: 0 1px 3px 0 rgba(60,64,67,.3), 0 4px 8px 3px rgba(60,64,67,.15);
        }
        
        /* Dark mode variables */
        [data-theme="dark"] {
            --color-dark: #ffffff;
            --color-gray: #9aa0a6;
            --color-light-gray: #202124;
            --color-border: #3c4043;
            --bg-primary: #202124;
            --bg-secondary: #292a2d;
        }
        
        body {
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--color-dark);
            background: var(--color-light-gray);
            transition: background 0.3s, color 0.3s;
        }
        
        [data-theme="dark"] body {
            background: var(--bg-primary);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header with dark mode toggle */
        header {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
        }
        
        [data-theme="dark"] header {
            background: var(--bg-secondary);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .dark-mode-toggle {
            padding: 8px 16px;
            border: 1px solid var(--color-border);
            border-radius: 20px;
            background: transparent;
            color: var(--color-dark);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .dark-mode-toggle:hover {
            background: var(--color-light-gray);
        }
        
        /* Navigation tabs */
        .nav-tabs {
            display: flex;
            gap: 24px;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 0;
            margin-top: 24px;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 12px 0;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 500;
            color: var(--color-gray);
            cursor: pointer;
            position: relative;
            white-space: nowrap;
            transition: color 0.3s;
        }
        
        .nav-tab:hover {
            color: var(--color-dark);
        }
        
        .nav-tab.active {
            color: var(--color-primary);
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--color-primary);
        }
        
        .tab-panel {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Score cards grid */
        .score-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .score-card {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        [data-theme="dark"] .score-card {
            background: var(--bg-secondary);
        }
        
        .score-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .score-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .score-card-title {
            font-size: 16px;
            font-weight: 600;
        }
        
        .score-card-value {
            font-size: 32px;
            font-weight: bold;
        }
        
        .score-card-chart {
            height: 120px;
            margin-top: 16px;
        }
        
        /* Charts section */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .chart-card {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
        }
        
        [data-theme="dark"] .chart-card {
            background: var(--bg-secondary);
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        /* Performance metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }
        
        [data-theme="dark"] .metric-card {
            background: var(--bg-secondary);
        }
        
        .metric-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .metric-label {
            font-size: 12px;
            color: var(--color-gray);
            text-transform: uppercase;
        }
        
        /* Timeline view */
        .timeline {
            position: relative;
            padding: 20px 0;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--color-border);
        }
        
        .timeline-item {
            position: relative;
            padding-left: 50px;
            margin-bottom: 24px;
        }
        
        .timeline-marker {
            position: absolute;
            left: 12px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--color-primary);
        }
        
        .timeline-content {
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
        }
        
        [data-theme="dark"] .timeline-content {
            background: var(--bg-secondary);
        }
        
        /* Export buttons */
        .export-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .export-button {
            padding: 8px 16px;
            border: 1px solid var(--color-primary);
            background: white;
            color: var(--color-primary);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .export-button:hover {
            background: var(--color-primary);
            color: white;
        }
        
        /* Comparison mode */
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .comparison-column {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
        }
        
        [data-theme="dark"] .comparison-column {
            background: var(--bg-secondary);
        }
        
        .improvement {
            color: var(--color-pass);
        }
        
        .regression {
            color: var(--color-fail);
        }
        
        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--color-dark);
            color: white;
            text-align: center;
            padding: 8px;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Progressive disclosure */
        .expandable {
            max-height: 200px;
            overflow: hidden;
            position: relative;
            transition: max-height 0.3s;
        }
        
        .expandable.expanded {
            max-height: none;
        }
        
        .expand-button {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(to top, white, transparent);
            text-align: center;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .score-grid,
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .comparison-container {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                overflow-x: scroll;
            }
        }
        
        /* Print optimization */
        @media print {
            body {
                background: white;
            }
            
            .dark-mode-toggle,
            .export-buttons {
                display: none;
            }
            
            .expandable {
                max-height: none;
            }
            
            .expand-button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div>
                    <h1>🚀 TFQ0SEO Enhanced Analysis Report</h1>
                    <div class="url-info">
                        <a href="{{ url }}" target="_blank">{{ url }}</a>
                    </div>
                </div>
                <button class="dark-mode-toggle" onclick="toggleDarkMode()">🌙 Dark Mode</button>
            </div>
            
            <nav class="nav-tabs">
                <button class="nav-tab active" data-tab="overview">📊 Overview</button>
                <button class="nav-tab" data-tab="seo">🔍 SEO</button>
                <button class="nav-tab" data-tab="content">📝 Content</button>
                <button class="nav-tab" data-tab="technical">⚙️ Technical</button>
                <button class="nav-tab" data-tab="performance">⚡ Performance</button>
                <button class="nav-tab" data-tab="links">🔗 Links</button>
                <button class="nav-tab" data-tab="issues">⚠️ Issues</button>
                <button class="nav-tab" data-tab="recommendations">💡 Recommendations</button>
            </nav>
        </header>
        
        <!-- Overview Tab -->
        <div class="tab-panel active" id="overview">
            <div class="score-grid">
                <div class="score-card">
                    <div class="score-card-header">
                        <h3 class="score-card-title">Overall Score</h3>
                        <span class="tooltip">ℹ️
                            <span class="tooltiptext">Weighted average of all category scores</span>
                        </span>
                    </div>
                    <div class="score-card-value" style="color: {% if overall_score >= 80 %}var(--color-pass){% elif overall_score >= 50 %}var(--color-average){% else %}var(--color-fail){% endif %}">
                        {{ overall_score|round|int }}/100
                    </div>
                    <div class="score-card-chart">
                        <canvas id="overallChart"></canvas>
                    </div>
                </div>
                
                {% for category, score in category_scores.items() %}
                <div class="score-card">
                    <div class="score-card-header">
                        <h3 class="score-card-title">{{ category|title }}</h3>
                    </div>
                    <div class="score-card-value" style="color: {% if score >= 80 %}var(--color-pass){% elif score >= 50 %}var(--color-average){% else %}var(--color-fail){% endif %}">
                        {{ score|round|int }}/100
                    </div>
                    <progress value="{{ score }}" max="100" style="width: 100%; height: 8px;"></progress>
                </div>
                {% endfor %}
            </div>
            
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">Issue Distribution</h3>
                    <canvas id="issueChart"></canvas>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">Category Scores</h3>
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
            
            <div class="export-buttons">
                <button class="export-button" onclick="window.print()">📄 Print Report</button>
                <button class="export-button" onclick="exportJSON()">💾 Export JSON</button>
                <button class="export-button" onclick="shareReport()">📤 Share Report</button>
            </div>
        </div>
        
        <!-- SEO Tab -->
        <div class="tab-panel" id="seo">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">📋</div>
                    <div class="metric-value">{% if seo_data %}{{ seo_data.title|length }}{% else %}N/A{% endif %}</div>
                    <div class="metric-label">Title Length</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">📝</div>
                    <div class="metric-value">{% if seo_data %}{{ seo_data.description|length }}{% else %}N/A{% endif %}</div>
                    <div class="metric-label">Description Length</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">🏷️</div>
                    <div class="metric-value">{% if seo_data %}{{ seo_data.open_graph|length }}{% else %}0{% endif %}</div>
                    <div class="metric-label">OG Tags</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">📊</div>
                    <div class="metric-value">{% if seo_data %}{{ seo_data.structured_data|length }}{% else %}0{% endif %}</div>
                    <div class="metric-label">Structured Data</div>
                </div>
            </div>
        </div>
        
        <!-- Content Tab -->
        <div class="tab-panel" id="content">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">📖</div>
                    <div class="metric-value">{% if content_data %}{{ content_data.word_count }}{% else %}0{% endif %}</div>
                    <div class="metric-label">Word Count</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">📚</div>
                    <div class="metric-value">{% if content_data %}{{ content_data.flesch_reading_ease|round|int }}{% else %}N/A{% endif %}</div>
                    <div class="metric-label">Readability</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">🎯</div>
                    <div class="metric-value">{% if content_data %}{{ content_data.average_grade_level|round|int }}{% else %}N/A{% endif %}</div>
                    <div class="metric-label">Grade Level</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">🖼️</div>
                    <div class="metric-value">{% if content_data %}{{ content_data.image_count }}{% else %}0{% endif %}</div>
                    <div class="metric-label">Images</div>
                </div>
            </div>
        </div>
        
        <!-- Technical Tab -->
        <div class="tab-panel" id="technical">
            <div class="timeline">
                {% if technical_data %}
                <div class="timeline-item">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h4>HTTPS Status</h4>
                        <p>{% if technical_data.https %}✅ Secure{% else %}❌ Not Secure{% endif %}</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h4>Mobile Friendly</h4>
                        <p>{% if technical_data.has_viewport %}✅ Yes{% else %}❌ No{% endif %}</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h4>Compression</h4>
                        <p>{{ technical_data.compression|default('Not detected') }}</p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Performance Tab -->
        <div class="tab-panel" id="performance">
            <div class="metrics-grid">
                {% if performance_data %}
                <div class="metric-card">
                    <div class="metric-icon">⏱️</div>
                    <div class="metric-value">{{ performance_data.load_time|round(2) }}s</div>
                    <div class="metric-label">Load Time</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">📦</div>
                    <div class="metric-value">{{ performance_data.content_size_mb|round(2) }}MB</div>
                    <div class="metric-label">Page Size</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">🎨</div>
                    <div class="metric-value">{{ performance_data.lcp_estimate|round(2) }}s</div>
                    <div class="metric-label">LCP Estimate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">👆</div>
                    <div class="metric-value">{{ performance_data.fid_estimate }}ms</div>
                    <div class="metric-label">FID Estimate</div>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Links Tab -->
        <div class="tab-panel" id="links">
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">Link Distribution</h3>
                    <canvas id="linkChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Issues Tab -->
        <div class="tab-panel" id="issues">
            <div class="issues-list">
                {% for severity, issues_list in issues_by_severity.items() %}
                    <h3>{{ severity|title }} Issues ({{ issues_list|length }})</h3>
                    <div class="expandable">
                        {% for issue in issues_list %}
                        <div class="issue-card {{ severity }}">
                            <strong>{{ issue.category }}</strong>: {{ issue.message }}
                        </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Recommendations Tab -->
        <div class="tab-panel" id="recommendations">
            <ol class="recommendation-list">
                {% for rec in recommendations %}
                <li class="recommendation-item">
                    <div class="recommendation-number">{{ loop.index }}</div>
                    <div class="recommendation-text">{{ rec }}</div>
                </li>
                {% endfor %}
            </ol>
        </div>
    </div>
    
    <script>
        // Dark mode toggle
        function toggleDarkMode() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update button text
            const button = document.querySelector('.dark-mode-toggle');
            button.textContent = newTheme === 'dark' ? '☀️ Light Mode' : '🌙 Dark Mode';
        }
        
        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
            const button = document.querySelector('.dark-mode-toggle');
            button.textContent = savedTheme === 'dark' ? '☀️ Light Mode' : '🌙 Dark Mode';
        }
        
        // Tab switching
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Update active tab
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding panel
                const tabName = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(tabName).classList.add('active');
            });
        });
        
        // Charts
        const chartColors = {
            pass: 'rgb(12, 206, 107)',
            average: 'rgb(255, 164, 0)',
            fail: 'rgb(255, 78, 66)',
            primary: 'rgb(66, 133, 244)'
        };
        
        // Issue distribution chart
        const issueCtx = document.getElementById('issueChart');
        if (issueCtx) {
            new Chart(issueCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Critical', 'Warnings', 'Notices'],
                    datasets: [{
                        data: [
                            {{ issue_counts.critical|default(0) }},
                            {{ issue_counts.warning|default(0) }},
                            {{ issue_counts.notice|default(0) }}
                        ],
                        backgroundColor: [
                            chartColors.fail,
                            chartColors.average,
                            chartColors.primary
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // Category scores chart
        const categoryCtx = document.getElementById('categoryChart');
        if (categoryCtx) {
            new Chart(categoryCtx, {
                type: 'radar',
                data: {
                    labels: {{ category_scores.keys()|list|tojson }},
                    datasets: [{
                        label: 'Scores',
                        data: {{ category_scores.values()|list|tojson }},
                        borderColor: chartColors.primary,
                        backgroundColor: 'rgba(66, 133, 244, 0.2)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }
        
        // Overall score gauge
        const overallCtx = document.getElementById('overallChart');
        if (overallCtx) {
            const score = {{ overall_score|round|int }};
            const color = score >= 80 ? chartColors.pass : score >= 50 ? chartColors.average : chartColors.fail;
            
            new Chart(overallCtx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [score, 100 - score],
                        backgroundColor: [color, '#e8eaed'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    }
                }
            });
        }
        
        // Export functions
        function exportJSON() {
            const data = {{ data|tojson }};
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'seo-report.json';
            a.click();
        }
        
        function shareReport() {
            if (navigator.share) {
                navigator.share({
                    title: 'SEO Analysis Report',
                    text: 'Check out this SEO analysis report',
                    url: window.location.href
                });
            } else {
                // Fallback to copying URL
                navigator.clipboard.writeText(window.location.href);
                alert('Report URL copied to clipboard!');
            }
        }
    </script>
</body>
</html>
