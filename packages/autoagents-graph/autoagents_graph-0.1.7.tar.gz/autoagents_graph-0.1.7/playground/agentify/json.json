{
    "nodes": [
        {
            "id": "simpleInputId",
            "type": "custom",
            "initialized": false,
            "position": {
                "x": 0,
                "y": 300
            },
            "data": {
                "outputs": [
                    {
                        "valueType": "string",
                        "description": "引用变量：{{userChatInput}}",
                        "label": "文本信息",
                        "type": "source",
                        "targets": [
                            {
                                "targetHandle": "text",
                                "target": "kb_search"
                            }
                        ],
                        "key": "userChatInput"
                    },
                    {
                        "valueType": "file",
                        "description": "以JSON数组格式输出用户上传文档列表，若为文档比对，包含分组信息",
                        "label": "文档信息",
                        "type": "source",
                        "targets": [
                            {
                                "targetHandle": "files",
                                "target": "doc_parser"
                            }
                        ],
                        "key": "files"
                    },
                    {
                        "valueType": "image",
                        "description": "以JSON数组格式输出用户上传的图片列表",
                        "label": "图片信息",
                        "type": "source",
                        "targets": [],
                        "key": "images"
                    },
                    {
                        "valueType": "boolean",
                        "description": "当未点击任何按钮时值为true",
                        "label": "未点击按钮",
                        "type": "source",
                        "targets": [],
                        "key": "unclickedButton"
                    },
                    {
                        "valueType": "boolean",
                        "description": "运行完成后开关打开，下游链接组件开始运行。",
                        "label": "模块运行结束",
                        "type": "source",
                        "targets": [
                            {
                                "targetHandle": "switchAny",
                                "target": "doc_parser"
                            }
                        ],
                        "key": "finish"
                    }
                ],
                "moduleType": "questionInput",
                "inputs": [
                    {
                        "connected": true,
                        "valueType": "boolean",
                        "description": "同时满足上游所有条件方可激活当前组件执行逻辑",
                        "label": "联动激活",
                        "type": "target",
                        "keyType": "trigger",
                        "value": false,
                        "key": "switch"
                    },
                    {
                        "connected": true,
                        "valueType": "boolean",
                        "description": "同时满足上游任一条件即可激活当前组件执行逻辑",
                        "label": "任一激活",
                        "type": "target",
                        "keyType": "triggerAny",
                        "value": false,
                        "key": "switchAny"
                    },
                    {
                        "valueType": "boolean",
                        "description": "输入文本开关",
                        "label": "输入文本",
                        "type": "switch",
                        "value": true,
                        "key": "inputText"
                    },
                    {
                        "valueType": "boolean",
                        "description": "上传文档开关",
                        "label": "上传文档",
                        "type": "switch",
                        "value": true,
                        "key": "uploadFile"
                    },
                    {
                        "valueType": "boolean",
                        "description": "上传图片开关",
                        "label": "上传图片",
                        "type": "switch",
                        "value": false,
                        "key": "uploadPicture"
                    },
                    {
                        "valueType": "boolean",
                        "description": "文档审查开关",
                        "label": "文档审查",
                        "type": "switch",
                        "value": false,
                        "key": "fileUpload"
                    },
                    {
                        "valueType": "boolean",
                        "description": "是否开启文档比对功能",
                        "label": "是否文档对比",
                        "type": "checkBox",
                        "value": false,
                        "key": "fileContrast"
                    },
                    {
                        "valueType": "any",
                        "description": "上传的文件列表,如果开启了文档对比,每个分组只能上传一个文件",
                        "label": "文档分组",
                        "type": "table",
                        "value": [],
                        "key": "fileInfo"
                    },
                    {
                        "valueType": "boolean",
                        "description": "是否作为初始全局input",
                        "label": "是否作为初始全局input",
                        "type": "hidden",
                        "value": true,
                        "key": "initialInput"
                    }
                ],
                "intro": "用户输入入口,对话中用户的输入信息,与其他模块连接,一般作为起始模块",
                "name": "用户提问",
                "disabled": false,
                "category": "用户提问"
            }
        },
        {
            "id": "doc_parser",
            "type": "custom",
            "initialized": false,
            "position": {
                "x": 497.2741652021091,
                "y": 340.8875219683656
            },
            "data": {
                "outputs": [
                    {
                        "valueType": "string",
                        "description": "识别结果",
                        "label": "识别结果",
                        "type": "source",
                        "targets": [
                            {
                                "targetHandle": "text",
                                "target": "ai_chat"
                            }
                        ],
                        "key": "pdf2mdResult"
                    },
                    {
                        "valueType": "boolean",
                        "label": "执行成功",
                        "type": "source",
                        "targets": [],
                        "key": "success"
                    },
                    {
                        "valueType": "boolean",
                        "label": "执行异常",
                        "type": "source",
                        "targets": [],
                        "key": "failed"
                    },
                    {
                        "valueType": "boolean",
                        "description": "运行完成后开关打开，下游链接组件开始运行。",
                        "label": "模块运行结束",
                        "type": "source",
                        "targets": [],
                        "key": "finish"
                    }
                ],
                "moduleType": "pdf2md",
                "inputs": [
                    {
                        "connected": true,
                        "valueType": "boolean",
                        "description": "同时满足上游所有条件方可激活当前组件执行逻辑",
                        "label": "联动激活",
                        "type": "target",
                        "keyType": "trigger",
                        "value": false,
                        "key": "switch"
                    },
                    {
                        "connected": true,
                        "valueType": "boolean",
                        "description": "同时满足上游任一条件即可激活当前组件执行逻辑",
                        "label": "任一激活",
                        "type": "target",
                        "keyType": "triggerAny",
                        "value": false,
                        "key": "switchAny"
                    },
                    {
                        "connected": true,
                        "valueType": "file",
                        "description": "",
                        "label": "文档信息",
                        "type": "target",
                        "value": [],
                        "key": "files"
                    },
                    {
                        "valueType": "selectPdf2mdModel",
                        "description": "",
                        "label": "选择模型",
                        "type": "selectPdf2mdModel",
                        "value": "general",
                        "key": "pdf2mdType",
                        "required": true
                    }
                ],
                "intro": "通用文档解析，将pdf/doc等转成markdown格式",
                "name": "通用文档解析",
                "disabled": false
            }
        },
        {
            "id": "kb_search",
            "type": "custom",
            "initialized": false,
            "position": {
                "x": 1000,
                "y": 300
            },
            "data": {
                "outputs": [
                    {
                        "valueType": "boolean",
                        "description": "当没有符合要求的文本切片时，该开关打开，可通过连接确定回复或智能对话模块的触发条件，启动下游模块。",
                        "label": "未搜索到相关知识",
                        "type": "source",
                        "targets": [],
                        "key": "isEmpty"
                    },
                    {
                        "valueType": "boolean",
                        "description": "当搜索到符合要求的文本切片时，该开关打开，可通过连接确定回复或智能对话模块的触发条件，启动下游模块。",
                        "label": "搜索到相关知识",
                        "type": "source",
                        "targets": [],
                        "key": "unEmpty"
                    },
                    {
                        "valueType": "boolean",
                        "description": "运行完成后开关打开，下游链接组件开始运行。",
                        "label": "模块运行结束",
                        "type": "source",
                        "targets": [],
                        "key": "finish"
                    },
                    {
                        "valueType": "search",
                        "description": "始终返回数组，内容包含相似度达和切片数量约定的内容，可通过【未搜索到相关知识】和【搜索到相关知识】控制后续回复内容。引用变量：{{quoteQA}}",
                        "label": "知识库搜索结果",
                        "type": "source",
                        "targets": [
                            {
                                "targetHandle": "knSearch",
                                "target": "ai_chat"
                            }
                        ],
                        "key": "quoteQA"
                    }
                ],
                "moduleType": "knowledgesSearch",
                "inputs": [
                    {
                        "connected": true,
                        "valueType": "boolean",
                        "description": "同时满足上游所有条件方可激活当前组件执行逻辑",
                        "label": "联动激活",
                        "type": "target",
                        "keyType": "trigger",
                        "value": false,
                        "key": "switch"
                    },
                    {
                        "connected": true,
                        "valueType": "boolean",
                        "description": "同时满足上游任一条件即可激活当前组件执行逻辑",
                        "label": "任一激活",
                        "type": "target",
                        "keyType": "triggerAny",
                        "value": false,
                        "key": "switchAny"
                    },
                    {
                        "connected": true,
                        "valueType": "string",
                        "description": "引用变量：{{text}}",
                        "label": "信息输入",
                        "type": "target",
                        "value": "",
                        "key": "text"
                    },
                    {
                        "valueType": "selectDataset",
                        "description": "",
                        "label": "关联的知识库",
                        "type": "selectDataset",
                        "value": [],
                        "key": "datasets",
                        "required": true
                    },
                    {
                        "min": 0,
                        "max": 1,
                        "markList": {
                            "0": 0,
                            "1": 1
                        },
                        "valueType": "number",
                        "description": "我们使用混合相似度得分来评估用户问题与知识库切片的相似度。它由关键词相似度和向量余弦相似度加权计算得到。如果问题和切片之间的相似度小于此阈值，则该切片将被过滤掉。",
                        "step": 0.01,
                        "label": "相似度阈值",
                        "type": "slider",
                        "value": 0.3,
                        "key": "similarity"
                    },
                    {
                        "min": 0,
                        "max": 1,
                        "markList": {
                            "0": 0,
                            "1": 1
                        },
                        "valueType": "number",
                        "description": "我们使用混合相似度得分来评估用户问题与知识库切片的相似度。它由关键词相似度和向量余弦相似度加权计算得到。两个相似度权重之和为1。例如，向量相似度权重为0.9，则关键词相似度为0.1。默认向量相似度为1，即只使用向量检索。建议当您的问题中存在明确的名称，地址，号码等关键词时，降低向量相似度权重，.00000.使用向量检索与关键词检索混合相似度得分。",
                        "step": 0.01,
                        "label": "向量相似度权重",
                        "type": "slider",
                        "value": 1,
                        "key": "vectorSimilarWeight"
                    },
                    {
                        "min": 0,
                        "max": 100,
                        "markList": {
                            "0": 0,
                            "100": 100
                        },
                        "valueType": "number",
                        "description": "在满足相似度阈值的前提下，按照相似度从大到小排序，召回的相关切片的数量。",
                        "step": 1,
                        "label": "召回数",
                        "type": "slider",
                        "value": 5,
                        "key": "topK"
                    },
                    {
                        "valueType": "boolean",
                        "description": "开启后将命中分段上下各1个分段内容同时召回，提高内容完整度。",
                        "label": "扩展上下文",
                        "type": "switch",
                        "value": false,
                        "key": "expandChunks"
                    },
                    {
                        "valueType": "boolean",
                        "description": "开启时，仅检索当前用户有权限的知识库；关闭后，跳过权限校验查询所有关联知识库内容。",
                        "label": "权限访问控制",
                        "type": "switch",
                        "value": false,
                        "key": "enablePermission"
                    },
                    {
                        "valueType": "boolean",
                        "description": "重排序模型是用于根据用户问题的相关性对已召回的切片进行重新排序的模型。其主要目的是提高搜索结果的精确度和相关性，确保用户查询能够获得最有价值和最相关的信息。注意：重排序模型资源消耗较大，开启后会降低检索速度。",
                        "label": "是否开启重排序",
                        "type": "switch",
                        "value": false,
                        "key": "enableRerank"
                    },
                    {
                        "valueType": "selectChatModel",
                        "description": "",
                        "label": "重排序模型",
                        "type": "selectRerankModel",
                        "value": "oneapi-xinference:bce-rerank",
                        "key": "rerankModelType",
                        "required": true
                    },
                    {
                        "min": 0,
                        "max": 20,
                        "markList": {
                            "0": 0,
                            "20": 20
                        },
                        "valueType": "number",
                        "description": "根据重排序模型的打分，按照相关性从大到小排序，召回的相关切片数量。",
                        "step": 1,
                        "label": "重排序召回数",
                        "type": "slider",
                        "value": 10,
                        "key": "rerankTopK"
                    }
                ],
                "intro": "在知识库中搜索结果，智能对话模块根据搜索结果进行回答，让回答更精准。",
                "name": "知识库搜索",
                "disabled": false,
                "category": "知识库"
            }
        },
        {
            "id": "ai_chat",
            "type": "custom",
            "initialized": false,
            "position": {
                "x": 1505.4516695957818,
                "y": 294.54833040421795
            },
            "data": {
                "outputs": [
                    {
                        "valueType": "boolean",
                        "description": "当模型运行结束，生成所有内容后，则回复结束下游组件开启。",
                        "label": "回复结束",
                        "type": "source",
                        "targets": [],
                        "key": "isResponseAnswerText"
                    },
                    {
                        "valueType": "string",
                        "description": "大模型处理完的信息，将作为回复内容进行输出。引用变量：",
                        "label": "回复内容",
                        "type": "source",
                        "targets": [
                            {
                                "targetHandle": "text",
                                "target": "confirm_reply"
                            },
                            {
                                "targetHandle": "feedback",
                                "target": "save_memory"
                            }
                        ],
                        "key": "answerText"
                    },
                    {
                        "valueType": "boolean",
                        "description": "运行完成后开关打开，下游链接组件开始运行。",
                        "label": "模块运行结束",
                        "type": "source",
                        "targets": [
                            {
                                "targetHandle": "switchAny",
                                "target": "confirm_reply"
                            }
                        ],
                        "key": "finish"
                    }
                ],
                "moduleType": "aiChat",
                "inputs": [
                    {
                        "connected": true,
                        "valueType": "boolean",
                        "description": "同时满足上游所有条件方可激活当前组件执行逻辑",
                        "label": "联动激活",
                        "type": "target",
                        "keyType": "trigger",
                        "value": false,
                        "key": "switch"
                    },
                    {
                        "connected": true,
                        "valueType": "boolean",
                        "description": "同时满足上游任一条件即可激活当前组件执行逻辑",
                        "label": "任一激活",
                        "type": "target",
                        "keyType": "triggerAny",
                        "value": false,
                        "key": "switchAny"
                    },
                    {
                        "connected": true,
                        "valueType": "string",
                        "description": "引用变量：{{text}}",
                        "label": "信息输入",
                        "type": "target",
                        "value": "",
                        "key": "text"
                    },
                    {
                        "connected": true,
                        "valueType": "image",
                        "description": "引用变量：{{images}}",
                        "label": "图片输入",
                        "type": "target",
                        "value": [],
                        "key": "images"
                    },
                    {
                        "connected": true,
                        "valueType": "search",
                        "description": "引用变量：{{knSearch}}",
                        "label": "知识库搜索结果",
                        "type": "target",
                        "value": "",
                        "key": "knSearch"
                    },
                    {
                        "connected": false,
                        "valueType": "text",
                        "description": "知识库高级配置",
                        "label": "知识库高级配置",
                        "type": "target",
                        "value": "",
                        "key": "knConfig"
                    },
                    {
                        "connected": false,
                        "min": 0,
                        "max": 6,
                        "valueType": "chatHistory",
                        "description": "",
                        "step": 1,
                        "label": "聊天上下文",
                        "type": "inputNumber",
                        "value": 3,
                        "key": "historyText"
                    },
                    {
                        "valueType": "string",
                        "description": "",
                        "label": "选择模型",
                        "type": "selectChatModel",
                        "value": "doubao-deepseek-v3",
                        "key": "model",
                        "required": true
                    },
                    {
                        "valueType": "string",
                        "description": "设定模型的角色和行为模式，如设定人设和回复逻辑。",
                        "label": "系统提示词",
                        "type": "textarea",
                        "value": "",
                        "key": "systemPrompt"
                    },
                    {
                        "valueType": "string",
                        "description": "用户输入的具体问题或请求，向模型提供用户指令。",
                        "label": "用户提示词",
                        "type": "textarea",
                        "value": "你是一个专业的问答助手，请根据知识库内容回答用户问题",
                        "key": "quotePrompt"
                    },
                    {
                        "connected": false,
                        "valueType": "boolean",
                        "description": "控制回复内容是否输出给用户",
                        "label": "回复对用户可见",
                        "type": "switch",
                        "value": true,
                        "key": "stream"
                    },
                    {
                        "min": 0,
                        "max": 1,
                        "markList": {
                            "0": "严谨",
                            "1": "创意"
                        },
                        "valueType": "number",
                        "description": "控制回复创意性，如果想要和输入信息一致的答案，数值越小越好；如果想要模型发挥创意性，数值越大越好。",
                        "step": 0.1,
                        "label": "回复创意性",
                        "type": "slider",
                        "value": 0.2,
                        "key": "temperature"
                    },
                    {
                        "min": 0,
                        "max": 1,
                        "markList": {
                            "0": "0",
                            "1": "1"
                        },
                        "valueType": "number",
                        "description": "控制输出的多样性,值越大输出包括更多单词选项；值越小，输出内容更集中在高概率单词上，即输出更确定但缺少多样性。一般【回复创意性】和【核采样TOP_P】只设置一个。",
                        "step": 0.1,
                        "label": "核采样TOP_P",
                        "type": "slider",
                        "value": 1,
                        "key": "topP"
                    },
                    {
                        "min": 100,
                        "max": 16000,
                        "markList": {
                            "5000": "5000",
                            "16000": 16000
                        },
                        "valueType": "number",
                        "step": 50,
                        "label": "回复字数上限",
                        "type": "slider",
                        "value": 5000,
                        "key": "maxToken"
                    }
                ],
                "intro": "AI 对话模型，根据信息输入和提示词（Prompt）加工生成所需信息，展示给用户，完成与用户互动。",
                "name": "智能对话",
                "disabled": false,
                "category": "大模型"
            }
        },
        {
            "id": "confirm_reply",
            "type": "custom",
            "initialized": false,
            "position": {
                "x": 2002.7258347978911,
                "y": 291.8224956063269
            },
            "data": {
                "outputs": [
                    {
                        "valueType": "string",
                        "description": "回复内容原样输出。",
                        "label": "回复内容",
                        "type": "source",
                        "value": "",
                        "targets": [],
                        "key": "text"
                    },
                    {
                        "valueType": "boolean",
                        "description": "运行完成后开关打开，下游链接组件开始运行。",
                        "label": "模块运行结束",
                        "type": "source",
                        "targets": [
                            {
                                "targetHandle": "",
                                "target": "save_memory"
                            }
                        ],
                        "key": "finish"
                    }
                ],
                "moduleType": "confirmreply",
                "inputs": [
                    {
                        "connected": true,
                        "valueType": "boolean",
                        "description": "同时满足上游所有条件方可激活当前组件执行逻辑",
                        "label": "联动激活",
                        "type": "target",
                        "keyType": "trigger",
                        "value": false,
                        "key": "switch"
                    },
                    {
                        "connected": true,
                        "valueType": "boolean",
                        "description": "同时满足上游任一条件即可激活当前组件执行逻辑",
                        "label": "任一激活",
                        "type": "target",
                        "keyType": "triggerAny",
                        "value": false,
                        "key": "switchAny"
                    },
                    {
                        "connected": false,
                        "valueType": "boolean",
                        "description": "控制回复内容是否输出给用户",
                        "label": "回复对用户可见",
                        "type": "switch",
                        "value": true,
                        "key": "stream"
                    },
                    {
                        "connected": true,
                        "valueType": "string",
                        "description": "可以使用 \\n 来实现连续换行。\n\n可以通过外部模块输入实现回复，外部模块输入时会覆盖当前填写的内容。引用变量：{{text}}",
                        "label": "回复内容",
                        "type": "textarea",
                        "value": "",
                        "key": "text"
                    }
                ],
                "intro": "结合触发条件使用，输出预设内容或输出上游模块接入内容。",
                "name": "确定回复",
                "disabled": false,
                "category": "大模型"
            }
        },
        {
            "id": "save_memory",
            "type": "custom",
            "initialized": false,
            "position": {
                "x": 2500,
                "y": 300
            },
            "data": {
                "outputs": [],
                "moduleType": "addMemoryVariable",
                "inputs": [
                    {
                        "connected": true,
                        "valueType": "string",
                        "description": "",
                        "label": "用户反馈内容",
                        "type": "agentMemoryVar",
                        "value": "",
                        "targets": [],
                        "key": "feedback"
                    }
                ],
                "intro": "使用该组件将变量存为记忆变量后，可以在智能体的其他组件中引用",
                "name": "添加记忆变量",
                "disabled": false,
                "category": "高阶能力"
            }
        }
    ],
    "edges": [
        {
            "id": "879e369b-0b2a-48ee-86e0-9afbf94c15de",
            "type": "custom",
            "source": "simpleInputId",
            "target": "doc_parser",
            "sourceHandle": "finish",
            "targetHandle": "switchAny",
            "data": {},
            "label": "",
            "sourceX": 324.00005800386214,
            "sourceY": 1061.0002103871154,
            "targetY": 478.387557438832,
            "targetX": 493.27408816531374,
            "animated": false
        },
        {
            "id": "3b987728-3caf-4710-9362-55ebffd2af03",
            "type": "custom",
            "source": "simpleInputId",
            "target": "doc_parser",
            "sourceHandle": "files",
            "targetHandle": "files",
            "data": {},
            "label": "",
            "sourceX": 324.00005800386214,
            "sourceY": 923.000131380478,
            "targetY": 535.3875737965068,
            "targetX": 493.27408816531374,
            "animated": false
        },
        {
            "id": "086732de-4e40-4eb8-8aa6-84f99da4f7a8",
            "type": "custom",
            "source": "simpleInputId",
            "target": "kb_search",
            "sourceHandle": "userChatInput",
            "targetHandle": "text",
            "data": {},
            "label": "",
            "sourceX": 324.00005800386214,
            "sourceY": 877.0001605021969,
            "targetY": 494.5000518281412,
            "targetX": 995.9999229632047,
            "animated": false
        },
        {
            "id": "bfa4a38f-8163-4438-9884-b1d774de4d63",
            "type": "custom",
            "source": "doc_parser",
            "target": "ai_chat",
            "sourceHandle": "pdf2mdResult",
            "targetHandle": "text",
            "data": {},
            "label": "",
            "sourceX": 861.2740785290594,
            "sourceY": 702.8876594447062,
            "targetY": 489.04838223235913,
            "targetX": 1501.4517589307802,
            "animated": false
        },
        {
            "id": "7a5f3457-e7a5-4947-a729-907ea6f78a42",
            "type": "custom",
            "source": "kb_search",
            "target": "ai_chat",
            "sourceHandle": "quoteQA",
            "targetHandle": "knSearch",
            "data": {},
            "label": "",
            "sourceX": 1363.9999133269503,
            "sourceY": 1798.0003875930404,
            "targetY": 603.0484565406571,
            "targetX": 1501.4517589307802,
            "animated": false
        },
        {
            "id": "cbffc581-cfb7-4cf0-b2d5-caba2d81021d",
            "type": "custom",
            "source": "ai_chat",
            "target": "confirm_reply",
            "sourceHandle": "finish",
            "targetHandle": "switchAny",
            "data": {},
            "label": "",
            "sourceX": 1829.451644413747,
            "sourceY": 1843.5486603926884,
            "targetY": 429.32248948384495,
            "targetX": 1998.725591389302,
            "animated": false
        },
        {
            "id": "cabfcbc3-c580-4f59-a53a-5312ae392600",
            "type": "custom",
            "source": "ai_chat",
            "target": "confirm_reply",
            "sourceHandle": "answerText",
            "targetHandle": "text",
            "data": {},
            "label": "",
            "sourceX": 1829.451644413747,
            "sourceY": 1797.5486895144072,
            "targetY": 597.3225639651696,
            "targetX": 1998.725591389302,
            "animated": false
        },
        {
            "id": "4a80e240-da63-4879-8dde-46d12cdfe18f",
            "type": "custom",
            "source": "confirm_reply",
            "target": "save_memory",
            "sourceHandle": "finish",
            "targetHandle": "",
            "data": {},
            "label": "",
            "sourceX": 2326.72597598765,
            "sourceY": 817.8225889342483,
            "targetY": 384.50001296369015,
            "targetX": 2496.0000893349984,
            "animated": false
        },
        {
            "id": "c76bc05b-73bc-41f7-801f-10e2493e9e22",
            "type": "custom",
            "source": "ai_chat",
            "target": "save_memory",
            "sourceHandle": "answerText",
            "targetHandle": "feedback",
            "data": {},
            "label": "",
            "sourceX": 1829.451644413747,
            "sourceY": 1797.5486895144072,
            "targetY": 384.50001296369015,
            "targetX": 2496.0000893349984,
            "animated": false
        }
    ],
    "position": [
        140.21098504963655,
        62.30370636336961
    ],
    "zoom": 0.2712727487969096,
    "viewport": {
        "x": 140.21098504963655,
        "y": 62.30370636336961,
        "zoom": 0.2712727487969096
    }
}