{#- Derive template style from template file name -#}
{%- set md_style=self._TemplateReference__context.name | re_match('md(.*)\.jinja2') -%}
{%- set md_style=md_style if md_style else 'standard' -%}

{# -------------------------------------------------------------------------- #}
# {{ cfdoc.title | e }}

>Generated by [{{ common.prog | e }}]({{ common.project_url }} "Open CFdoc project site") on {{ common.now_ctime | e }}.

{# -------------------------------------------------------------------------- #}
## Contents

{%- if cfdoc.overview.Description %}
1.  {{ 'Description' | xref(md_style) }}
{%- endif %}
1.  {{ 'Details' | xref(md_style) }}
{%- if cfdoc.parameters %}
1.  {{ 'Parameters' | xref(md_style) }}
{%- endif %}
1.  {{ 'Resource Summary' | xref(md_style) }}
{% for resgrp in cfdoc.resource_groups if cfdoc.resource_groups[resgrp].Members -%}
{{ '    * ' }}{{  cfdoc.resource_groups[resgrp].Name | e | xref(md_style) }}
{% endfor -%}
1.  {{ 'Outputs' | xref(md_style) }}
1.  {{ 'Resource Details' | xref(md_style) }}
1. [AWS CloudFormation documentation]({{ cfdoc.plugins.awsdoc.index }} "AWS CloudFormation documentation")

{# -------------------------------------------------------------------------- #}
{% if cfdoc.overview.Description %}
## {{ 'Description' | xref(md_style, target=cfdoc.title) }}
{% for para in cfdoc.overview.Description %}
{{ para }}
{% endfor %}
{% endif %}

{# -------------------------------------------------------------------------- #}
## {{ 'Details' | xref(md_style, target=cfdoc.title) }}
{# Put remaining overview items in a table #}
|Item|Value|
|-|-|
{% for key in cfdoc.overview if not key == "Description"  -%}
{%- if cfdoc.overview[key] -%}
|{{ key | e}}|{{ cfdoc.overview[key] | join(" ") }}|
{%- endif %}
{% endfor %}

{# -------------------------------------------------------------------------- #}
{% if cfdoc.parameters %}
## {{ 'Parameters' | xref(md_style, target=cfdoc.title) }}
{# Put parameters in a table #}
|Parameter|Type|Description|
|-|-|-|
{% for param in cfdoc.parameters -%}
|{{ param | e}}|{{ cfdoc.parameters[param].Type }}|{{ cfdoc.parameters[param].Description | join(" ") }}|
{% endfor %}
    {%- if not cfdoc.parameters -%}
| | | |
    {% endif %}
{% endif %}

{# -------------------------------------------------------------------------- #}
## {{ 'Resource Summary' | xref(md_style, target=cfdoc.title) }}
{#
Put parameters in each resource group in a table. This only uses some
of the available attributes.
 #}

{% for resgrp in cfdoc.resource_groups if cfdoc.resource_groups[resgrp].Members %}
### {{ cfdoc.resource_groups[resgrp].Name | xref(md_style, target=cfdoc.title) }}
|Id|Type|Description|
|-|-|-|
{% for rsrc_id in cfdoc.resource_groups[resgrp].Members -%}
|{{ rsrc_id | xref(md_style, target=rsrc_id) }}|{{ cfdoc.resources[rsrc_id].Type | re_match(".*::.*::(.*)") }}|{{ cfdoc.resources[rsrc_id].Description[0] }}|
{% endfor %}
{% endfor %}

{# -------------------------------------------------------------------------- #}
{% if cfdoc.outputs %}
## {{ 'Outputs' | xref(md_style, target=cfdoc.title) }}
{# Put outputs in a table #}
|Id|Export as|Description|
|-|-|-|
{% for op_id in cfdoc.outputs -%}
|{{ op_id }}|{{ cfdoc.outputs[op_id]["Export"] | string | e_md if cfdoc.outputs[op_id]["Export"] else " " }}|{{ cfdoc.outputs[op_id]["Description"] }}|
{% endfor %}
{% endif %}

{# -------------------------------------------------------------------------- #}
## {{ 'Resource Details' | xref(md_style, target=cfdoc.title) }}
{% for rsrc_id in cfdoc.resources | sort %}
### {{ rsrc_id | xref(md_style, target=cfdoc.resource_groups[cfdoc.resources[rsrc_id].Group].Name) }}
|Property|Value|
|-|-|
{% if "Type" in cfdoc.resources[rsrc_id] -%}
|Type|
    {%- if cfdoc.resources[rsrc_id]['Type'] in cfdoc.plugins.awsdoc.resources -%}
        [{{ cfdoc.resources[rsrc_id]['Type'] }}]({{ cfdoc.plugins.awsdoc.resources[cfdoc.resources[rsrc_id]['Type']] }} "AWS documentation for this resource type")
    {%- else -%}
        {{ cfdoc.resources[rsrc_id]['Type'] }}
    {%- endif -%}
|
{%- endif %}
{% if "Group" in cfdoc.resources[rsrc_id] -%}
|Group|{{ cfdoc.resource_groups[cfdoc.resources[rsrc_id].Group].Name |xref(md_style, target=cfdoc.resource_groups[cfdoc.resources[rsrc_id].Group].Name) }} ({{ cfdoc.resources[rsrc_id]["Group"] |xref(md_style, target=cfdoc.resource_groups[cfdoc.resources[rsrc_id].Group].Name)}})|
{% for key in cfdoc.resources[rsrc_id] if key not in ("JSON", "Group", "Type") and cfdoc.resources[rsrc_id][key] -%}
|{{ key }}|
    {%- if cfdoc.resources[rsrc_id][key] is string -%}
        {{ cfdoc.resources[rsrc_id][key] | e }}
    {%- else -%}
        {{ cfdoc.resources[rsrc_id][key] | join(" ") }}
    {%- endif -%}

{% endfor %}


{% if cfdoc.resources[rsrc_id].JSON %}
```json
{{ cfdoc.resources[rsrc_id].JSON | safe }}
```
{% endif %}

{% endif %}
{% endfor %}
