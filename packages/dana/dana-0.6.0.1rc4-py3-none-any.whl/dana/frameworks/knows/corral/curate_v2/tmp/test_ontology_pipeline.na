"""
Test the 2-Phase Ontology Pipeline System
"""

from ontology_system import execute_ontology_pipeline

def test_ontology_pipeline():
    """Test complete 2-phase ontology-driven knowledge organization"""
    
    print("🧪 Testing 2-Phase Ontology Pipeline System")
    print("=" * 60)
    
    # Test with Financial Risk Management domain
    topic = "Financial Risk Management"
    role = "Risk Analyst"
    
    print(f"📋 Domain: {topic}")
    print(f"👤 Role: {role}")
    print("-" * 40)
    
    try:
        # Execute complete pipeline
        pipeline_result = execute_ontology_pipeline(topic, role)
        
        # Validate results
        if "initial_ontology" not in pipeline_result:
            print("❌ ERROR: Missing initial_ontology")
            return
            
        if "interview_results" not in pipeline_result:
            print("❌ ERROR: Missing interview_results")
            return
            
        if "refined_ontology" not in pipeline_result:
            print("❌ ERROR: Missing refined_ontology")
            return
        
        # Show pipeline summary
        summary = pipeline_result["pipeline_summary"]
        print(f"📊 Pipeline Results Summary:")
        print(f"   ✅ Topic: {summary['topic']}")
        print(f"   ✅ Role: {summary['role']}")
        print(f"   ✅ Concepts Added: {summary['concepts_added']}")
        print(f"   ✅ Concepts Removed: {summary['concepts_removed']}")
        print(f"   ✅ Workflows Captured: {summary['workflows_captured']}")
        
        # Show initial ontology structure
        initial_ontology = pipeline_result["initial_ontology"]
        print(f"📋 Initial Ontology Structure:")
        ontology_keys = []
        for key in initial_ontology:
            ontology_keys = ontology_keys + [key]
        print(f"   Main branches: {ontology_keys}")
        
        # Show interview insights
        interview = pipeline_result["interview_results"]
        if "ontology_validation" in interview:
            validation = interview["ontology_validation"]
            if "missing_concepts" in validation:
                missing_count = len(validation["missing_concepts"])
                print(f"   📝 Missing concepts identified: {missing_count}")
        
        # Show refinement impact
        refined_ontology = pipeline_result["refined_ontology"]
        refined_keys = []
        for key in refined_ontology:
            refined_keys = refined_keys + [key]
        print(f"🔧 Refined Ontology Structure:")
        print(f"   Updated branches: {refined_keys}")
        
        print(f"🎉 2-Phase Ontology Pipeline Test Completed Successfully!")
        print(f"✅ System ready for ontology-driven knowledge organization")
        
    except Exception as e:
        print(f"❌ Pipeline test failed: {str(e)}")
        return
    
    print(f"🏦 Financial Risk Management ontology system validated!")

# Run the test
test_ontology_pipeline()