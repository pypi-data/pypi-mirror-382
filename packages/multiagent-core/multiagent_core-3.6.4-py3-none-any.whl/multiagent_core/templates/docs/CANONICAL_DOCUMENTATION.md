# Canonical Documentation - What Must Stay Current

**Date**: 2025-10-07
**Purpose**: Define which docs are "living" and must be kept synchronized during development

## ðŸŽ¯ The Problem

We have scattered documentation everywhere:
- `docs/` - Architecture, reports, reference
- `.multiagent/` - User-facing guides
- Root level - README, DEVELOPMENT, etc.
- Subsystem READMEs - Individual system docs

**During development, which ones MUST stay current?**

---

## âœ… CANONICAL DOCS (Must Stay Synchronized)

### Tier 1: Primary User & Contributor Docs

These are the "source of truth" that users and contributors rely on:

| Document | Audience | Auto-Update Trigger | Sync Method |
|----------|----------|-------------------|-------------|
| **`.multiagent/README.md`** | Users (deployed) | Subsystem changes, new commands | `/docs:update --system` |
| **`README.md`** (root) | PyPI users, GitHub visitors | Version bump, major features | Manual or `/docs:update --readme` |
| **`DEVELOPMENT.md`** | Contributors | Build system changes, workflow updates | Manual review |
| **`CHANGELOG.md`** | Everyone | Every release | Auto-generated by semantic-release |

### Tier 2: Subsystem Documentation

These docs are deployed with the framework and users reference them:

| Document | Owner | Must Reflect |
|----------|-------|--------------|
| `.multiagent/agents/README.md` | Agents subsystem | Agent templates, workflow docs |
| `.multiagent/core/README.md` | Core subsystem | Setup orchestration |
| `.multiagent/deployment/README.md` | Deployment | Deploy commands, configs |
| `.multiagent/documentation/README.md` | Documentation | Doc generation templates |
| `.multiagent/iterate/README.md` | Iterate | Task layering logic |
| `.multiagent/github/pr-review/README.md` | PR Review | Judge workflow |
| `.multiagent/security/README.md` | Security | Security scanning, hooks |
| `.multiagent/supervisor/README.md` | Supervisor | Compliance rules |
| `.multiagent/testing/README.md` | Testing | Test generation, templates |

### Tier 3: Agent Definitions

Agent behavior definitions must match slash commands:

| Agent File | Must Match |
|------------|------------|
| `.claude/agents/backend-tester.md` | `/testing:test` behavior |
| `.claude/agents/deployment-prep.md` | `/deployment:deploy-prepare` behavior |
| `.claude/agents/docs-init.md` | `/docs:init` behavior |
| `.claude/agents/judge-architect.md` | `/github:pr-review` behavior |
| `.claude/agents/production-specialist.md` | `/deployment:prod-ready` behavior |
| `.claude/agents/test-generator.md` | `/testing:test-generate` behavior |

---

## ðŸ“š REFERENCE DOCS (Historical, Don't Auto-Update)

These provide context but don't need to stay synchronized:

### Architecture Deep Dives
- `docs/architecture/core/SYSTEM_ARCHITECTURE.md` - Core principles (stable)
- `docs/architecture/core/SYSTEM_WORKFLOW_PATTERN.md` - Pattern explanation (stable)
- `docs/architecture/core/SYSTEM_VISUAL_MAP.md` - Visual map (update when structure changes)

### Audit Reports (Historical Records)
- `docs/reports/SCRIPT_AUDIT_2025-10-06.md` - Historical audit
- `docs/reports/SCRIPT_REDUCTION_FINAL_SUMMARY.md` - What was cleaned up
- `docs/reports/SYSTEM_AUDIT_REPORT.md` - System audit snapshot
- `docs/reports/MULTIAGENT_VS_SPECKIT_PATTERNS.md` - Pattern comparison

### Reference Material
- `docs/INDEX.md` - Documentation index (update when new docs added)
- `docs/claude-code/` - Claude Code SDK reference (external reference)
- `docs/DOCUMENTATION_STATUS.md` - Status report (update as needed)

---

## ðŸ”„ Synchronization Strategy

### When Documentation Goes Out of Sync

**Symptoms:**
- Subsystem README mentions commands that don't exist
- Main README lists old slash commands
- Agent definitions don't match command behavior
- Phase descriptions contradict workflow

### Solution: Documentation Sync Command

**Proposed**: `/docs:sync` command (or enhance `/docs:update`)

```bash
/docs:sync [--full] [--subsystem=<name>]

# What it does:
1. Scans all slash commands in .claude/commands/
2. Scans all agent definitions in .claude/agents/
3. Compares against .multiagent/README.md
4. Identifies mismatches
5. Proposes updates or auto-fixes
```

### Sync Triggers

**When to run `/docs:sync`:**
- âœ… After adding new slash command
- âœ… After modifying agent behavior
- âœ… After restructuring subsystems
- âœ… Before creating release PR
- âŒ NOT for every commit (too frequent)

---

## ðŸ§¹ Cleanup Recommendations

### Scattered Docs to Consolidate

**Problem**: Documentation fragmentation

**Current State:**
```
docs/
â”œâ”€â”€ architecture/core/          # Architecture deep dives
â”œâ”€â”€ reports/                    # Audit reports
â”œâ”€â”€ claude-code/                # External reference
â”œâ”€â”€ INDEX.md                    # Index
â”œâ”€â”€ DOCUMENTATION_STATUS.md     # Status report
â””â”€â”€ CANONICAL_DOCUMENTATION.md  # This file
```

**Recommendation**: This structure is actually GOOD!

- `architecture/` - Deep technical docs for contributors
- `reports/` - Historical records, audit trails
- `claude-code/` - External reference material

**Don't consolidate these** - they serve different purposes.

### What Actually Needs Cleanup

**1. Old Pattern Documentation (If Found)**
Look for docs still mentioning:
- Scripts doing generation work (old pattern)
- Direct script execution from commands (old pattern)
- Template fill-in-the-blank (old pattern)

**2. Duplicate Information**
Check for:
- Same slash command documented in multiple places
- Subsystem README duplicating main README
- Agent definitions duplicating command files

### Cleanup Subagent or Manual?

**Recommendation**: Hybrid approach

**Manual Cleanup (One-time):**
- Remove obviously outdated docs
- Consolidate duplicates
- Archive old patterns to `.archive/docs/`

**Subagent for Ongoing Sync (`docs-sync` subagent):**
```markdown
---
name: docs-sync
description: Keep canonical documentation synchronized with code
---

You are the documentation synchronization expert.

When invoked:
1. Scan slash commands in .claude/commands/
2. Scan agent definitions in .claude/agents/
3. Read canonical docs (.multiagent/README.md, subsystem READMEs)
4. Identify mismatches
5. Propose specific updates
6. Auto-fix simple inconsistencies (with approval)

Focus on:
- Command names and descriptions
- Agent responsibilities
- Phase organization
- Subsystem ownership
```

---

## ðŸŽ¯ Action Plan

### Phase 1: One-Time Cleanup (Now)

```bash
# 1. Identify outdated docs
grep -r "generate-deployment.sh" docs/  # Old script references
grep -r "fill.*template" docs/          # Old template pattern

# 2. Move outdated docs to archive
mkdir -p .archive/docs/old-patterns/
# Move anything mentioning deprecated patterns

# 3. Verify canonical docs are current
# (Already done - see DOCUMENTATION_STATUS.md)
```

### Phase 2: Create Sync Subagent (Next)

```bash
# Create docs-sync subagent
cat > .claude/agents/docs-sync.md << 'EOF'
---
name: docs-sync
description: Synchronize canonical documentation with slash commands and agent definitions
---
[Agent definition from above]
EOF

# Create slash command
cat > .claude/commands/docs/sync.md << 'EOF'
---
description: Synchronize all canonical documentation
---
[Command that invokes docs-sync subagent]
EOF
```

### Phase 3: Regular Maintenance (Ongoing)

**Before each release:**
```bash
/docs:sync --full          # Check all canonical docs
/docs:validate --strict    # Ensure consistency
```

**After adding features:**
```bash
/docs:sync --subsystem=deployment  # Just that subsystem
```

---

## ðŸ“Š Current Status

### âœ… Already Clean
- `.multiagent/README.md` - Updated 2025-10-07, comprehensive
- `DEVELOPMENT.md` - Updated 2025-10-07, current
- `docs/architecture/` - Still accurate
- `docs/reports/` - Historical, intentionally static

### ðŸ” Needs Review
- Individual subsystem READMEs - Check if they match current slash commands
- Agent definitions - Verify they align with command behavior
- Root README.md - Could add "How It Works" section

### ðŸš§ Needs Creation
- `/docs:sync` command
- `docs-sync` subagent
- Sync automation in pre-release checks

---

## ðŸ’¡ Key Insights

1. **Not all docs need to stay current** - Historical reports are valuable as-is
2. **Canonical docs are identifiable** - User-facing guides and agent definitions
3. **Sync can be automated** - Subagent can detect mismatches
4. **Manual review still needed** - For architectural decisions and major changes
5. **Documentation fragmentation is OK** - As long as we know which docs are canonical

---

## ðŸŽ“ Best Practices

### For Contributors
- Update `.multiagent/README.md` when adding slash commands
- Update subsystem README when changing templates
- Update agent definitions when changing behavior
- Run `/docs:sync` before creating PR

### For Maintainers
- Review canonical docs monthly
- Archive outdated patterns, don't delete
- Keep audit reports for historical context
- Use semantic-release for CHANGELOG

### For Users
- Trust `.multiagent/README.md` as primary guide
- Subsystem READMEs explain specific features
- Root README.md is the entry point
- DEVELOPMENT.md is for contributors only

---

**Summary**: We have good documentation hygiene. Create a sync subagent for ongoing maintenance, but don't over-automate - some docs should be intentionally static.
