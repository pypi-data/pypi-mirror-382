{"openapi":"3.1.0","info":{"title":"Buscador de CNPJ API","description":"API para consulta de dados de CNPJ da Receita Federal","version":"1.0.0"},"paths":{"/cnpj/public/{cnpj}":{"get":{"tags":["CNPJ"],"summary":"Consulta Pública de CNPJ (Dados Básicos)","description":"Obtém dados básicos e públicos de uma empresa sem necessidade de autenticação. Dados sensíveis como telefone, email e faturamento são ocultados.","operationId":"get_cnpj_public_cnpj_public__cnpj__get","parameters":[{"name":"cnpj","in":"path","required":true,"schema":{"type":"string","title":"Cnpj"}}],"responses":{"200":{"description":"Sucesso - Dados básicos do CNPJ encontrados.","content":{"application/json":{"schema":{}}}},"404":{"description":"CNPJ não encontrado."},"429":{"description":"Muitas requisições - limite de taxa excedido."},"500":{"description":"Erro interno do servidor."},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cnpj/{cnpj}":{"get":{"tags":["CNPJ"],"summary":"Consulta de Dados de CNPJ","description":"Obtém os dados cadastrais completos de uma empresa a partir do seu número de CNPJ. Esta consulta consome **1 crédito por CNPJ solicitado com sucesso** (dados não encontrados ou erros não consomem crédito), exceto se os dados estiverem disponíveis em cache (onde o consumo é zero).","operationId":"get_cnpj_cnpj__cnpj__get","parameters":[{"name":"cnpj","in":"path","required":true,"schema":{"type":"string","title":"Cnpj"}},{"name":"x-api-key","in":"header","required":true,"schema":{"type":"string","description":"Sua chave de API para autenticação e contagem de créditos.","title":"X-Api-Key"},"description":"Sua chave de API para autenticação e contagem de créditos."}],"responses":{"200":{"description":"Sucesso - Dados do CNPJ encontrados.","content":{"application/json":{"schema":{}}}},"401":{"description":"Não Autorizado - Cabeçalho x-api-key ausente ou inválido.","content":{"application/json":{"example":{"detail":"x-api-key header missing"}}}},"404":{"description":"Não Encontrado - CNPJ não localizado na base de dados.","content":{"application/json":{"example":{"detail":"CNPJ not found"}}}},"500":{"description":"Erro Interno do Servidor.","content":{"application/json":{"example":{"detail":"Internal server error details..."}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cnpj/list":{"post":{"tags":["CNPJ"],"summary":"Consulta Múltipla de CNPJs","description":"Obtém dados cadastrais para uma lista de CNPJs.\n\n**Regras de Negócio:**\n- Permite consultar múltiplos CNPJs em uma única requisição.\n- Ideal para enriquecimento de bases de dados ou validação em lote.\n\n**Consumo de Créditos:**\n- Cobra **1 crédito a cada 20 CNPJs** na lista fornecida.\n- O cálculo é feito sobre o número total de CNPJs na requisição, independentemente de quantos são encontrados.\n- Exemplo: Uma lista com 1 a 20 CNPJs consome 1 crédito. Uma lista com 21 a 40 CNPJs consome 2 créditos.\n\n**Parâmetros no Corpo da Requisição (JSON):**\n- `cnpjs` (Lista de strings, obrigatório): Lista dos números de CNPJ (14 dígitos, sem formatação).\n- `uf` (string, opcional): Sigla da Unidade Federativa (ex: \"SP\", \"RJ\"). Se fornecido, a consulta será direcionada para os bancos de dados específicos da UF. **Importante:** Para garantir consistência com resultados de uma busca anterior (endpoint `/search`), utilize o mesmo valor de `uf` que foi usado na busca.\n- `situacao_cadastral` (inteiro, opcional): Código da situação cadastral. Assim como o `uf`, é crucial para consistência com buscas anteriores. **Importante:** Utilize o mesmo valor de `situacao_cadastral` que foi usado na busca. Códigos comuns:\n    - `1`: NULA\n    - `2`: ATIVA\n    - `3`: SUSPENSA\n    - `4`: INAPTA\n    - `8`: BAIXADA\n\n**Retorno:**\n- `data`: Lista de objetos, cada um contendo os dados do CNPJ encontrado.\n- `not_found`: Lista de strings com os CNPJs que não foram localizados nos bancos de dados consultados (considerando os filtros `uf` e `situacao_cadastral`, se aplicados).\n- `credit_consumed`: Booleano indicando se créditos foram consumidos (neste endpoint, sempre será `true` se a requisição for válida e houver CNPJs na lista).\n\n**Consistência com o Endpoint de Busca (`/search`):**\nSe a lista de CNPJs foi obtida através do endpoint `/search` (especialmente se filtros de `uf` e/ou `situacao_cadastral` foram aplicados na busca), é **altamente recomendável** fornecer os mesmos valores para `uf` e `situacao_cadastral` neste endpoint (`/cnpj/list`). Isso assegura que a consulta dos detalhes dos CNPJs seja feita nos mesmos arquivos de dados segmentados, prevenindo que CNPJs (previamente encontrados na busca) sejam incorretamente reportados como \"não encontrados\" aqui.","operationId":"list_cnpjs_cnpj_list_post","parameters":[{"name":"x-api-key","in":"header","required":true,"schema":{"type":"string","description":"Sua chave de API para autenticação e contagem de créditos.","title":"X-Api-Key"},"description":"Sua chave de API para autenticação e contagem de créditos."}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Body_list_cnpjs_cnpj_list_post"}}}},"responses":{"200":{"description":"Sucesso. Retorna os dados dos CNPJs encontrados e uma lista dos CNPJs não localizados.","content":{"application/json":{"schema":{},"example":{"data":[{"cnpj_completo":"12345678000199","razao_social":"EMPRESA EXEMPLO LTDA","...":"..."}],"not_found":["98765432000100"],"credit_consumed":true}}}},"400":{"description":"Requisição Inválida. A lista de CNPJs não pode ser vazia ou os parâmetros são inválidos.","content":{"application/json":{"examples":{"empty_list":{"value":{"detail":"Lista de CNPJs vazia"}},"invalid_param":{"value":{"detail":"Formato de CNPJ inválido na lista."}}}}}},"401":{"description":"Não Autorizado. Chave de API (`x-api-key`) ausente ou inválida.","content":{"application/json":{"example":{"detail":"x-api-key header missing"}}}},"402":{"description":"Pagamento Necessário. Créditos insuficientes para processar a quantidade de CNPJs solicitada.","content":{"application/json":{"example":{"detail":"Insufficient credits"}}}},"404":{"description":"Não Encontrado. Nenhum arquivo de banco de dados encontrado para os filtros `uf` e/ou `situacao_cadastral` fornecidos. Isso pode ocorrer se os filtros não corresponderem a nenhum segmento de dados existente.","content":{"application/json":{"example":{"detail":"No database files found for uf=XX, situacao_cadastral=Y"}}}},"500":{"description":"Erro Interno do Servidor. Ocorreu um problema inesperado durante o processamento.","content":{"application/json":{"example":{"detail":"Internal server error details..."}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/search/estimate":{"get":{"tags":["Search"],"summary":"Estima o custo de uma busca avançada usando Manticore Search","description":"**Esta consulta não consome créditos.**\n\nCalcula e retorna o custo estimado para uma consulta na rota `/search` baseado nas configurações personalizadas do usuário.\n\n**Regra de Custo:**\n- O custo é baseado na configuração personalizada do usuário ou padrão do sistema (2 créditos)\n- Usuários com configurações especiais podem ter custos diferentes\n- Configurações de zero resultados não se aplicam às estimativas\n\n**Parâmetros:**\n- Esta rota aceita os mesmos parâmetros de filtro que a rota `/search` para fins de consistência, mas eles não afetam o custo.\n\n**Retorno:**\n- Um objeto JSON com a chave `estimated_cost`.\n  - Exemplo: `{\"estimated_cost\": 2}` (custo padrão)\n  - Exemplo: `{\"estimated_cost\": 0}` (configuração personalizada)\n\n**Headers de Resposta:**\n- `X-Credits-Charged`: Sempre retorna `0` pois esta rota não consome créditos.","operationId":"search_estimate_search_estimate_get","parameters":[{"name":"x-api-key","in":"header","required":true,"schema":{"type":"string","description":"Sua chave de API para autenticação e contagem de créditos.","title":"X-Api-Key"},"description":"Sua chave de API para autenticação e contagem de créditos."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/search/":{"get":{"tags":["Search"],"summary":"Advanced Dynamic Search for CNPJ Data using Manticore Search","description":"**Esta consulta consome 2 créditos por requisição.**\n\n**Headers de Resposta:**\n- `X-Credits-Charged`: Retorna `2` indicando o custo em créditos desta consulta.\n\nRealiza uma busca avançada e parametrizada na base de dados de CNPJs usando Manticore Search para resultados mais rápidos e relevantes.\nTodos os filtros fornecidos são combinados com lógica AND.\n\n**Termo de Busca Geral (Filtro `term`):**\n- `term` (string): Realiza uma busca textual nos seguintes campos principais:\n  `razao_social`, `nome_fantasia`, `logradouro`, `bairro`, `nome_municipio`,\n  `descricao_cnae_fiscal_principal`, `descricao_cnae_fiscal_secundaria`,\n  `complemento`, `correio_eletronico`.\n  \n  **Dicas de busca:**\n  - Use `*` como curinga para busca por partes de palavras\n  - A busca é insensível a maiúsculas/minúsculas e ignora acentos\n  - Exemplos:\n    - `term=*padaria*` - Busca em todos os campos por \"padaria\" em qualquer posição\n    - `term=padaria*` - Busca termos que começam com \"padaria\"\n    - `term=*centro` - Busca termos que terminam com \"centro\"\n    - `term=padaria centro` - Busca por \"padaria\" E \"centro\" em qualquer ordem\n\n**Campos de Filtragem Disponíveis:**\n\n**1. Campos de Correspondência Exata:**\n   - `cnpj_completo` (string, ex: `cnpj_completo=00000000000191`)\n   - `natureza_juridica` (string, código da natureza jurídica, ex: `natureza_juridica=2062`)\n   - `qualificacao_responsavel` (string, código da qualificação do responsável, ex: `qualificacao_responsavel=10`)\n   - `porte_empresa` (string, código do porte da empresa, ex: `porte_empresa=05` para MEI, `01` para Microempresa, `03` para Empresa de Pequeno Porte)\n   - `identificador_matriz_filial` (string, `1` para Matriz, `2` para Filial)\n   - `situacao_cadastral` (numérico). Códigos comuns:\n     - `1`: NULA\n     - `2`: ATIVA\n     - `3`: SUSPENSA\n     - `4`: INAPTA\n     - `8`: BAIXADA\n     Exemplo: `situacao_cadastral=2`\n   - `motivo_situacao_cadastral` (string, código do motivo da situação cadastral, ex: `motivo_situacao_cadastral=0`)\n   - `cnae_fiscal_principal` (string, código CNAE principal, ex: `cnae_fiscal_principal=4711302`)\n   - `numero` (string, número do endereço, ex: `numero=123`)\n   - `cep` (string, CEP com 8 dígitos, sem formatação, ex: `cep=12345678`)\n   - `uf` (string, sigla da UF, ex: `uf=SP`)\n   - `codigo_municipio` (string, código IBGE do município, ex: `codigo_municipio=3550308` para São Paulo)\n   - `ddd_1`, `telefone_1`, `ddd_2`, `telefone_2`, `ddd_fax`, `fax` (strings)\n\n**2. Campos de Busca Textual:**\n   Use `*` como curinga para busca por partes de palavras. A busca é insensível a maiúsculas/minúsculas e ignora acentos automaticamente.\n   \n   - `razao_social` (string, ex: `razao_social=*padaria*` para buscar qualquer ocorrência de \"padaria\" na razão social)\n   - `nome_fantasia` (string, ex: `nome_fantasia=*pão*` para buscar \"Pão de Açúcar\", \"PADARIA PÃO DOCE\")\n   - `descricao_cnae_fiscal_principal` (string, ex: `descricao_cnae_fiscal_principal=*varejista*`)\n   - `cnae_fiscal_secundaria` (string, busca o termo dentro da lista de CNAEs secundários, ex: `cnae_fiscal_secundaria=*1091*`)\n   - `descricao_cnae_fiscal_secundaria` (string, busca o termo nas descrições dos CNAEs secundários, ex: `descricao_cnae_fiscal_secundaria=*padaria*`)\n   - `tipo_logradouro` (string, ex: `tipo_logradouro=*rua*` para buscar \"RUA\", \"RUA 25 DE MARÇO\", etc.)\n   - `logradouro` (string, ex: `logradouro=*paulista*` para buscar \"Avenida Paulista\", \"Rua Paulista\", etc.)\n   - `complemento` (string, ex: `complemento=*sala*` para buscar \"SALA 10\", \"fundos\", etc.)\n   - `bairro` (string, ex: `bairro=*centro*` para buscar \"Centro\", \"Centro Histórico\", etc.)\n   - `nome_municipio` (string, ex: `nome_municipio=*são*` para buscar qualquer município com \"são\" ou \"sao\" no nome)\n   - `correio_eletronico` (string, ex: `correio_eletronico=*gmail*` para buscar emails do Gmail)\n   - `situacao_especial` (string, ex: `situacao_especial=*recupera*` para buscar \"EM RECUPERACAO JUDICIAL\")\n\n**3. Campos Numéricos (Intervalo ou Exato):**\n   Utilize sufixos: `_min`, `_max`, `_gt` (maior que), `_gte` (maior ou igual), `_lt` (menor que), `_lte` (menor ou igual), `_eq` (igual), `_neq` (diferente).\n   - `capital_social` (numérico, ex: `capital_social_min=10000&capital_social_max=50000` ou `capital_social_eq=25000`)\n\n**4. Campos de Data (Intervalo ou Exato):**\n   Utilize sufixos como nos campos numéricos. Formato da data: `YYYY-MM-DD`.\n   - `data_situacao_cadastral` (data, ex: `data_situacao_cadastral_gte=2023-01-01`)\n   - `data_inicio_atividade` (data, ex: `data_inicio_atividade_lt=2000-01-01`)\n   - `data_situacao_especial`, `data_opcao_simples`, `data_exclusao_simples`, `data_opcao_mei`, `data_exclusao_mei` (datas)\n\n**5. Campos Booleanos:**\n   Aceita `true`/`false`, `S`/`N`, `1`/`0` (case-insensitive).\n   - `opcao_pelo_simples` (booleano, ex: `opcao_pelo_simples=true` ou `opcao_pelo_simples=S`)\n   - `opcao_mei` (booleano, ex: `opcao_mei=false` ou `opcao_mei=N`)\n\n**6. Faixa de Faturamento Estimado:**\n   - `faixa_faturamento_estimado` (string): Filtra por faixa estimada de faturamento anual. Valores aceitos:\n     - `0_360k`: Até R$ 360 mil\n     - `360k_1kk`: R$ 360 mil - R$ 1 milhão  \n     - `1kk_4.8kk`: R$ 1 - R$ 4,8 milhões\n     - `4.8kk_20kk`: R$ 4,8 - R$ 20 milhões\n     - `20kk_mais`: Acima de R$ 20 milhões\n   Exemplo: `faixa_faturamento_estimado=1kk_4.8kk`\n\n**Ordenação:**\n- `ordenarPor` (string): Nome do campo para ordenação.\n- `ordenacaoDesc` (booleano, default `false`): `true` para ordem descendente.\n\n**Paginação:**\n- `pagina` (inteiro, default `1`): Número da página.\n- `limite` (inteiro, default `10000`, máximo `10000`): Número de resultados por página.","operationId":"search_search__get","parameters":[{"name":"pagina","in":"query","required":false,"schema":{"type":"integer","minimum":1,"default":1,"title":"Pagina"}},{"name":"limite","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","minimum":1},{"type":"null"}],"title":"Limite"}},{"name":"ordenarPor","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Ordenarpor"}},{"name":"ordenacaoDesc","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Ordenacaodesc"}},{"name":"x-api-key","in":"header","required":true,"schema":{"type":"string","description":"Sua chave de API para autenticação e contagem de créditos.","title":"X-Api-Key"},"description":"Sua chave de API para autenticação e contagem de créditos."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Search Search  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/search/csv/estimate":{"get":{"tags":["Search"],"summary":"Estima o custo de exportação CSV","description":"**Esta consulta não consome créditos.**\n\n**Headers de Resposta:**\n- `X-Credits-Charged`: Sempre retorna `0` pois esta rota não consome créditos.\n\nCalcula e retorna o custo estimado em créditos para uma futura exportação de CSV, sem executar a exportação.\nO custo é baseado no número de páginas a serem exportadas.\n\n**Regra de Custo:**\n- A primeira página é **gratuita**.\n- Cada página adicional custa **2 créditos**.\n\n**Parâmetros:**\n- `pagina_inicio` (inteiro): A primeira página do intervalo de exportação.\n- `pagina_fim` (inteiro): A última página do intervalo de exportação.\n\n**Retorno:**\n- Um objeto JSON com a chave `estimated_cost`.\n  - Exemplo: `{\"estimated_cost\": 4}`\n\n**Exemplo de Uso:**\nPara estimar o custo de exportar das páginas 1 a 3 (3 páginas no total):\n`/search/csv/estimate?pagina_inicio=1&pagina_fim=3`\n\nNeste caso, a primeira página é gratuita e as duas páginas seguintes (2 e 3) custam 2 créditos cada, totalizando 4 créditos.","operationId":"search_csv_estimate_search_csv_estimate_get","parameters":[{"name":"pagina_inicio","in":"query","required":false,"schema":{"type":"integer","minimum":1,"default":1,"title":"Pagina Inicio"}},{"name":"pagina_fim","in":"query","required":false,"schema":{"type":"integer","minimum":1,"default":1,"title":"Pagina Fim"}},{"name":"x-api-key","in":"header","required":true,"schema":{"type":"string","description":"Sua chave de API para autenticação e contagem de créditos.","title":"X-Api-Key"},"description":"Sua chave de API para autenticação e contagem de créditos."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/search/csv":{"get":{"tags":["Search"],"summary":"Exporta resultados de busca avançada para CSV usando Manticore Search","description":"**Custo: 2 créditos por página exportada (a primeira página é gratuita).**\n\n**Headers de Resposta:**\n- `X-Credits-Charged`: Retorna o número de créditos consumidos, calculado com base no número de páginas exportadas.\n\nExporta os resultados de uma busca avançada para um arquivo CSV usando Manticore Search.\nUtiliza os mesmos parâmetros de filtro da rota `/search`.\n\n**Principais Parâmetros:**\n- **Filtros:** Todos os filtros da rota `/search` são aplicáveis aqui (ex: `term`, `uf`, `situacao_cadastral`, `razao_social`, `capital_social_min`, etc.).\n- **`pagina_inicio`**: A página inicial do intervalo a ser exportado (default: 1).\n- **`pagina_fim`**: A página final do intervalo a ser exportado (default: 1).\n- **`limite`**: Registros por página (default/max: 10000).\n- **`ordenarPor`**: Campo para ordenação.\n- **`ordenacaoDesc`**: `true` para ordenação descendente.\n\nO CSV conterá **todas as colunas** para os CNPJs encontrados.\n\n**Exemplo:**\nExportar as páginas 1 a 3 de empresas ativas em RJ com o termo \"restaurante\":\n`/search/csv?term=restaurante&uf=RJ&situacao_cadastral=2&pagina_inicio=1&pagina_fim=3&limite=100`","operationId":"search_csv_search_csv_get","parameters":[{"name":"pagina_inicio","in":"query","required":false,"schema":{"type":"integer","minimum":1,"default":1,"title":"Pagina Inicio"}},{"name":"pagina_fim","in":"query","required":false,"schema":{"type":"integer","minimum":1,"default":1,"title":"Pagina Fim"}},{"name":"limite","in":"query","required":false,"schema":{"type":"integer","minimum":1,"default":100,"title":"Limite"}},{"name":"ordenarPor","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Ordenarpor"}},{"name":"ordenacaoDesc","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Ordenacaodesc"}},{"name":"x-api-key","in":"header","required":true,"schema":{"type":"string","description":"Sua chave de API para autenticação e contagem de créditos.","title":"X-Api-Key"},"description":"Sua chave de API para autenticação e contagem de créditos."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/logs/summary":{"get":{"tags":["Logs","Logs"],"summary":"Logs Summary","description":"Retrieve a summary of credit usage for the authenticated user, grouped by API route, with optional filters.\n\nThis endpoint provides an overview of how many calls were made to each route\nand the total credits consumed for each, allowing users to understand their main\nareas of credit expenditure within a specified period or for a specific route.\n\n**Authentication:** Requires a valid JWT Bearer token.\n\n**Query Parameters:**\n- `start_date` (str, optional, format: YYYY-MM-DD): Filters logs on or after this date.\n- `end_date` (str, optional, format: YYYY-MM-DD): Filters logs on or before this date.\n- `route` (str, optional): Filters logs for a specific API route (e.g., \"/cnpj\", \"search\").\n  The leading slash is optional.\n\n**Returns:**\n- A list of objects, where each object contains:\n    - `route` (str): The API route (e.g., \"/cnpj\", \"/search\").\n    - `calls` (int): The total number of calls made to this route by the user within the filtered range.\n    - `credits` (int): The total credits consumed by calls to this route within the filtered range.\n\n**Example Usage:**\n\n    GET /logs/summary?start_date=2023-01-01&end_date=2023-01-31&route=/cnpj\n    Headers: {\"Authorization\": \"Bearer <your_jwt_token>\"}\n\n**Example Response (filtered):**\n\n.. code-block:: json\n\n    [\n        {\n            \"route\": \"/cnpj\",\n            \"calls\": 75,\n            \"credits\": 75\n        }\n    ]","operationId":"logs_summary_logs_summary_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"start_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"description":"Filter logs on or after this date. Format YYYY-MM-DD","title":"Start Date"},"description":"Filter logs on or after this date. Format YYYY-MM-DD"},{"name":"end_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"description":"Filter logs on or before this date. Format YYYY-MM-DD","title":"End Date"},"description":"Filter logs on or before this date. Format YYYY-MM-DD"},{"name":"route","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by specific route, e.g., /cnpj or cnpj","title":"Route"},"description":"Filter by specific route, e.g., /cnpj or cnpj"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/logs/history":{"get":{"tags":["Logs","Logs"],"summary":"Logs History","description":"Fetch a paginated history of individual credit consumption events for the authenticated user.\n\nThis endpoint allows users to see a detailed breakdown of each credit-consuming API call,\nincluding the route called, the cost of the call, and the timestamp.\nIt supports pagination and filtering by date range and specific API route.\n\n**Authentication:** Requires a valid JWT Bearer token.\n\n**Query Parameters:**\n- `page` (int, optional, default: 1): The page number for pagination (must be >= 1).\n- `limit` (int, optional, default: 10): The number of items per page (must be >= 1 and <= 100).\n- `start_date` (str, optional, format: YYYY-MM-DD): Filters logs on or after this date.\n- `end_date` (str, optional, format: YYYY-MM-DD): Filters logs on or before this date.\n- `route` (str, optional): Filters logs for a specific API route (e.g., \"/cnpj\", \"search\").\n  The leading slash is optional.\n\n**Returns:**\n- An object containing:\n    - `history` (list): A list of credit log items. Each item contains:\n        - `route` (str): The API route called.\n        - `cost` (int): The credits consumed by this call.\n        - `timestamp` (str): The ISO 8601 formatted timestamp of the call.\n    - `total_count` (int): The total number of log entries matching the filters.\n    - `page` (int): The current page number.\n    - `limit` (int): The number of items per page.\n\n**Example Usage:**\n\n    GET /logs/history?page=1&limit=5&start_date=2023-01-01&route=/cnpj\n    Headers: {\"Authorization\": \"Bearer <your_jwt_token>\"}\n\n**Example Response:**\n\n.. code-block:: json\n\n    {\n        \"history\": [\n            {\n                \"route\": \"/cnpj\",\n                \"cost\": 1,\n                \"timestamp\": \"2023-01-15T10:30:00Z\"\n            },\n            {\n                \"route\": \"/cnpj\",\n                \"cost\": 1,\n                \"timestamp\": \"2023-01-14T14:20:10Z\"\n            }\n        ],\n        \"total_count\": 25,\n        \"page\": 1,\n        \"limit\": 5\n    }","operationId":"logs_history_logs_history_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"default":1,"title":"Page"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"default":10,"title":"Limit"}},{"name":"start_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"description":"Format YYYY-MM-DD","title":"Start Date"},"description":"Format YYYY-MM-DD"},{"name":"end_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"description":"Format YYYY-MM-DD","title":"End Date"},"description":"Format YYYY-MM-DD"},{"name":"route","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by specific route, e.g., /cnpj or cnpj","title":"Route"},"description":"Filter by specific route, e.g., /cnpj or cnpj"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/logs/distinct_routes":{"get":{"tags":["Logs","Logs"],"summary":"Distinct Routes","description":"Retrieve a list of unique API routes for which the authenticated user has credit log entries.\n\nThis endpoint is useful for populating filter dropdowns in a UI, allowing users to\nselect from routes they have actually used.\n\n**Authentication:** Requires a valid JWT Bearer token.\n\n**Returns:**\n- A list of strings, where each string is a unique route name (e.g., \"/cnpj\", \"/search\").\n  The list is sorted alphabetically.\n\n**Example Usage:**\n\n    GET /logs/distinct_routes\n    Headers: {\"Authorization\": \"Bearer <your_jwt_token>\"}\n\n**Example Response:**\n\n.. code-block:: json\n\n    [\n        \"/cnpj\",\n        \"/search\",\n        \"/validate_key\"\n    ]","operationId":"distinct_routes_logs_distinct_routes_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/logs/export_csv":{"get":{"tags":["Logs","Logs"],"summary":"Export Logs Csv","description":"Export the credit consumption history for the authenticated user to a CSV file.\n\nThis endpoint provides a downloadable CSV file containing all credit log entries that match\nthe applied filters (date range and/or specific route). If no filters are provided,\nit exports the entire credit history for the user.\nThe CSV file includes columns for Route, Cost (Credits), and Data/Hora (Timestamp).\n\n**Authentication:** Requires a valid JWT Bearer token.\n\n**Query Parameters:**\n- `start_date` (str, optional, format: YYYY-MM-DD): Filters logs on or after this date.\n- `end_date` (str, optional, format: YYYY-MM-DD): Filters logs on or before this date.\n- `route` (str, optional): Filters logs for a specific API route (e.g., \"/cnpj\", \"search\").\n  The leading slash is optional.\n\n**Returns:**\n- A `StreamingResponse` that delivers a CSV file.\n- The response will have `Content-Type: text/csv`.\n- The `Content-Disposition` header will be set to `attachment; filename=historico_creditos.csv`,\n  prompting the browser to download the file.\n\n**CSV Columns:**\n1.  `Rota`: The API route called.\n2.  `Custo (Créditos)`: The credits consumed by this call.\n3.  `Data/Hora`: The ISO 8601 formatted timestamp of the call.\n\n**Example Usage:**\n\n    GET /logs/export_csv?start_date=2023-01-01&route=/cnpj\n    Headers: {\"Authorization\": \"Bearer <your_jwt_token>\"}\n\nThis will trigger a download of `historico_creditos.csv` containing logs for the \"/cnpj\" route\nfrom January 1st, 2023, onwards.","operationId":"export_logs_csv_logs_export_csv_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"start_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"description":"Format YYYY-MM-DD","title":"Start Date"},"description":"Format YYYY-MM-DD"},{"name":"end_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"description":"Format YYYY-MM-DD","title":"End Date"},"description":"Format YYYY-MM-DD"},{"name":"route","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by specific route, e.g., /cnpj or cnpj","title":"Route"},"description":"Filter by specific route, e.g., /cnpj or cnpj"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/logs/daily_summary":{"get":{"tags":["Logs","Logs"],"summary":"Daily Summary","description":"Retrieve a daily summary of credit usage for the authenticated user, grouped by date and route, with optional filters.\n\nThis endpoint provides a timeseries of total credits consumed per day for each route,\nallowing users to visualize credit usage trends over a specified period, for a specific route, or across all routes.\n\n**Authentication:** Requires a valid JWT Bearer token.\n\n**Query Parameters:**\n- `start_date` (str, optional, format: YYYY-MM-DD): Filters logs on or after this date.\n- `end_date` (str, optional, format: YYYY-MM-DD): Filters logs on or before this date.\n- `route` (str, optional): Filters logs for a specific API route (e.g., \"/cnpj\", \"search\").\n  The leading slash is optional. If omitted, data for all routes (respecting other filters) is returned.\n\n**Returns:**\n- A list of objects, where each object contains:\n    - `date` (str): The date (YYYY-MM-DD).\n    - `route` (str): The API route (e.g., \"/cnpj\").\n    - `total_credits` (int): The total credits consumed on this date for this route by the user for the filtered criteria.\n\n**Example Usage (all routes in range):**\n\n    GET /logs/daily_summary?start_date=2023-01-01&end_date=2023-01-02\n    Headers: {\"Authorization\": \"Bearer <your_jwt_token>\"}\n\n**Example Response (all routes in range):**\n\n.. code-block:: json\n\n    [\n        {\n            \"date\": \"2023-01-01\",\n            \"route\": \"/cnpj\",\n            \"total_credits\": 30\n        },\n        {\n            \"date\": \"2023-01-01\",\n            \"route\": \"/search\",\n            \"total_credits\": 20\n        },\n        {\n            \"date\": \"2023-01-02\",\n            \"route\": \"/cnpj\",\n            \"total_credits\": 45\n        },\n        {\n            \"date\": \"2023-01-02\",\n            \"route\": \"/search\",\n            \"total_credits\": 30\n        }\n        // ... and so on for each day and route in the range with activity\n    ]","operationId":"daily_summary_logs_daily_summary_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"start_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"description":"Filter logs on or after this date. Format YYYY-MM-DD","title":"Start Date"},"description":"Filter logs on or after this date. Format YYYY-MM-DD"},{"name":"end_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"description":"Filter logs on or before this date. Format YYYY-MM-DD","title":"End Date"},"description":"Filter logs on or before this date. Format YYYY-MM-DD"},{"name":"route","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by specific route, e.g., /cnpj or cnpj","title":"Route"},"description":"Filter by specific route, e.g., /cnpj or cnpj"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"Body_list_cnpjs_cnpj_list_post":{"properties":{"cnpjs":{"items":{"type":"string"},"type":"array","title":"Cnpjs","description":"Lista de CNPJs (14 dígitos, sem formatação) a serem consultados."},"uf":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Uf","description":"Opcional. Sigla da UF (ex: SP, RJ). Usar este filtro é crucial para consistência se os CNPJs vieram de uma busca filtrada por UF."},"situacao_cadastral":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Situacao Cadastral","description":"Opcional. Código da situação cadastral (ex: 2 para ATIVA). Usar este filtro é crucial para consistência se os CNPJs vieram de uma busca filtrada por situação."}},"type":"object","required":["cnpjs"],"title":"Body_list_cnpjs_cnpj_list_post"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"OAuth2PasswordBearer":{"type":"oauth2","flows":{"password":{"scopes":{},"tokenUrl":"/auth/login"}}}}}}