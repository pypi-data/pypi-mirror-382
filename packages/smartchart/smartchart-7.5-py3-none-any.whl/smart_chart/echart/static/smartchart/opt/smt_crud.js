let part = document.getElementById("printTable");
if(part) {
part.innerHTML = `<el-table :data="tableData" size="mini" :header-cell-style="{background: tableHeaderColor}" :header-cell-class-name="tableHearderClassName" :row-class-name="tableRowClassName"
:stripe="stripe" :show-summary="showSummary" :summary-method="getSummaries" border ref="multipleTable" :span-method="spanMethod" :max-height="maxheight" highlight-current-row @current-change="handleRowClickChange" @selection-change="handleSelectionChange" lazy :row-key="tree_id?'treeid':''" :load="loadTree" :style="'min-height:'+minheight">
<el-table-column type="expand" v-if="shortTableFields" id="partShort"></el-table-column>
<el-table-column type="index" v-if="showIndex" width="50"></el-table-column>
<el-table-column type="selection" width="55" v-if="actionDict" key="1"></el-table-column>
<el-table-column  v-for="item in (shortTableFields||tableFields||tableHead)" :label="nameDict[item]||item" :width="widthDict[item]" :align="alignDict[item]||'center'" :prop="item" :key="item" :sortable="!mergeFields" show-overflow-tooltip :fixed="fixedFields.includes(item)">
<template slot="header" v-if="tooltipDict[item]"><el-tooltip effect="light" :content="tooltipDict[item]" placement="top"><span>{[nameDict[item]||item]}<i class="el-icon-info"></i></span></el-tooltip></template>
<template slot-scope="scope"><template v-if="scope.row[item]">
<span v-if="tagFields.includes(item)">
<el-tag  v-for="v in scope.row[item].split(',')" :color="statusColor[v]" style="color:black" disable-transitions>{[v]}</el-tag>
</span>
<el-image v-else-if="typeDict[item]==='img'" :src="construct_img(scope.row[item])" :preview-src-list="[construct_img(scope.row[item])]" lazy></el-image>
<el-link v-else-if="typeDict[item]==='file'" type="success" :href="construct_img(scope.row[item])" target="_blank">{[scope.row[item]]}</el-link>
<el-switch v-else-if="typeDict[item]==='switch'" v-model="scope.row[item]" disabled :active-value=1 :inactive-value=0></el-switch>
<el-progress v-else-if="typeDict[item]==='progress'" :percentage="scope.row[item]"></el-progress>
<span v-else-if="typeDict[item]==='color'" class="el-icon-info" :style="'color:'+scope.row[item]"></span>
<el-rate v-else-if="typeDict[item]==='rate'" :value="scope.row[item]" disabled></el-rate>${tcStr}
<span  v-else v-text="scope.row[item]"></span>
</template><span  v-else v-text="scope.row[item]"></span>
</template>
</el-table-column>${tcsStr}
<el-table-column  :fixed="actionFixed?'right':null" :label="nameDict.操作||'操作'"  :width="widthDict.操作||80" v-if="btnEdit||btnRequest||btnView||delete_id||viewDsDict" key="2">
<template slot="header" v-if="tooltipDict.操作"><el-tooltip effect="light" :content="tooltipDict.操作" placement="top"><span>{[ nameDict.操作||'操作']} <i class="el-icon-info"></i></span></el-tooltip></template>
<template slot-scope="scope">
<el-button type="text" size="mini" icon="el-icon-edit-outline" @click.stop="handleRequestClick(scope.row)" v-if="btnRequest"></el-button>
<el-button type="text" size="mini" icon="el-icon-edit" @click.stop="handleEditClick(scope.row)" v-if="btnEdit"></el-button>
<el-button type="text" size="mini"  icon="el-icon-view" @click.stop="handleViewClick(scope.row)" v-if="btnView"></el-button>
<el-button type="text" size="mini"  :icon="isChinese(k)?'':k" @click.stop="handleViewClick(scope.row,v)" v-for="(v, k) in viewDsDict"><span v-if="isChinese(k)" v-html="k"></span></el-button>
<el-popconfirm title="确认删除?"  @confirm='handleDeleteClick(scope.row)' v-if="delete_id"><el-button type="text" size="mini"  icon="el-icon-delete" slot="reference"></el-button></el-popconfirm>
</template>
</el-table-column>
</el-table>
   <el-pagination  :page-sizes="pageSizes"  v-if="pageSize<9999" @size-change="handlerSizeChange" @current-change="handlerCurrentChange" :current-page="currentPage" :page-size="pageSize" layout="total,sizes,prev,pager,next,jumper" :total="total"></el-pagination>`;
}

var mobile = (document.documentElement.clientWidth || document.body.clientWidth)< 800;
if(mobile) {
part = document.getElementById("printCard");
if (part) {
    part.innerHTML = ` <div  v-for="scope in tableData" class="body_div" >
<el-descriptions  :column="shortCol" size="mini"  :direction="shortDire?'vertical':''" :border="shortBord">
<el-descriptions-item v-for="item in (tableFields||tableHead)" :key="item" :label="nameDict[item]||item">
<el-tag v-if="tagFields.includes(item)" :color="statusColor[scope[item]]" style="color:black" disable-transitions size="mini">{[scope[item]]}</el-tag>
<el-image v-else-if="scope[item]&&typeDict[item]==='img'" :src="construct_img(scope[item])" style="width: 100px" :preview-src-list="[construct_img(scope[item])]" lazy></el-image>
<span v-else :style="'color:'+tableHeaderColor">{[scope[item]]}</span>
</el-descriptions-item>
</el-descriptions>
<div v-if="btnEdit||btnRequest||btnView||delete_id||viewDsDict" class="filter_div"><span></span><div>
<el-button type="text" size="mini" icon="el-icon-edit-outline" @click.stop="handleRequestClick(scope)" v-if="btnRequest"></el-button>
<el-button type="text" size="mini" icon="el-icon-edit" @click.stop="handleEditClick(scope)" v-if="btnEdit"></el-button>
<el-button type="text" size="mini"  icon="el-icon-view" @click.stop="handleViewClick(scope)" v-if="btnView"></el-button>
<el-button type="text" size="mini"  :icon="isChinese(k)?'':k" @click.stop="handleViewClick(scope,v)" v-for="(v, k) in viewDsDict"><span v-if="isChinese(k)" v-html="k"></span></el-button>
<el-popconfirm title="确认删除?"  @confirm='handleDeleteClick(scope)' v-if="delete_id"><el-button type="text" size="mini"  icon="el-icon-delete" slot="reference"></el-button></el-popconfirm>
</div></div>
</div>
<el-pagination background small hide-on-single-page :page-sizes="pageSizes"  @current-change="handlerCurrentChange" :current-page="currentPage" :page-size="pageSize" layout="total,pager" :total="total"></el-pagination>
`;}}

let modifyForm=`<el-form-item v-for="(value, key) in form" :prop="key" :label="nameDict[key]||key">
<el-input v-if="typeDict[key]=='text'" v-model="form[key]" type="textarea" autosize :disabled="constF.includes(key)"></el-input>
<el-date-picker v-else-if="typeDict[key]=='date'" v-model="form[key]" type="date" value-format="yyyy-MM-dd" :disabled="constF.includes(key)" :editable="!mobile"></el-date-picker>
<el-date-picker v-else-if="typeDict[key]=='month'" v-model="form[key]" type="month" value-format="yyyy-MM" :disabled="constF.includes(key)" :editable="!mobile"></el-date-picker>
<el-date-picker v-else-if="typeDict[key]=='datetime'" v-model="form[key]" type="datetime" value-format="yyyy-MM-dd HH:mm:ss" :disabled="constF.includes(key)" :editable="!mobile"></el-date-picker>
<el-upload v-else-if="typeDict[key]=='file'||typeDict[key]=='img'" :accept="typeDict[key]=='img'?'image/*':''" :data="{'typename':dashid,'path':uploadpath, 'key':key}" action="/echart/upload_file/"  :on-success="handleUpload" :before-upload="beforeUpload" :inline="true" :show-file-list="false" style="display: inline-block;" :disabled="constF.includes(key)">
<el-button size="mini" style="background-color:#6e8665;border:none;color:#fff" icon="el-icon-upload2"></el-button><span>{[form[key]]}</span></el-upload>
<el-radio-group v-else-if="typeDict[key]=='radio'" v-model="form[key]" :disabled="constF.includes(key)" @input="selectChange(key)"><el-radio v-for="item in optionDict2[key]" :label="item[0]">{[item.join('-')]}</el-radio></el-radio-group>
<el-select v-else-if="['select','selects'].includes(typeDict[key])" :remote="remoteDsDict[key]" :remote-method="(q)=>{remoteMethod(q,key)}" :loading="loadingDict[key]" v-model="form[key]" :multiple="typeDict[key]=='selects'" :filterable="!mobile||remoteDsDict[key]" clearable @change="selectChange(key)" :disabled="constF.includes(key)">
<el-option v-for="item in optionDict2[key]" :key="item[0]" :label="item.join('-')" :value="item[0]"></el-option></el-select>
<el-autocomplete v-else-if="remoteDsDict[key]" size="mini"  clearable v-model="form[key]" :fetch-suggestions="(q,c)=>{querySearch(q,c,key)}"  @change="selectChange(key)" :disabled="constF.includes(key)">
<template slot-scope="{ item }"><span style="margin-right:3px" v-for="item1 of item">{[item1]}</span></template></el-autocomplete>
<el-input-number controls-position="right" v-else-if="['progress','number'].includes(typeDict[key])"  v-model="form[key]"  :disabled="constF.includes(key)" @change="calcChange(key)"></el-input-number>
<el-switch v-else-if="typeDict[key]=='switch'" v-model="form[key]"  :disabled="constF.includes(key)" :active-value=1 :inactive-value=0></el-switch>
<el-rate v-else-if="typeDict[key]==='rate'" v-model="form[key]"  show-score score-template="{value}"></el-rate>
<el-color-picker v-else-if="typeDict[key]=='color'" v-model="form[key]"  :disabled="constF.includes(key)"></el-color-picker>
<el-input v-else-if="typeDict[key]=='qr'" v-model="form[key]" placeholder="请输入内容或扫码" :disabled="constF.includes(key)"  @change="selectChange(key)"><template slot="append"><el-button icon="el-icon-camera" @click="handleQr('form',key)"></el-button></template></el-input>
<span v-else-if="typeDict[key]=='remark'">{[form[key]]}</span>
<el-input v-else v-model.trim="form[key]" autocomplete="off" :disabled="constF.includes(key)"  @change="calcChange(key)" clearable></el-input>
</el-form-item>
<div class="panel" v-if="form1"><div class="panel-header"><h2>{[title]}明细录入<el-button type="primary" size="small" icon="el-icon-plus" @click="addDetailRow">添加</el-button></h2></div>
<div class="panel-body"><el-table :data="detailData" border size="small" class="detail-table" :header-cell-style="{background: tableHeaderColor}"><el-table-column type="index" label="序号" width="60" align="center"></el-table-column>
<el-table-column v-for="key in form1" :key="key" :label="nameDict[key]||key" :width="widthDict[key]" :prop="key"><template slot-scope="scope">
<el-date-picker v-if="typeDict[key]=='date'" v-model="scope.row[key]" type="date" value-format="yyyy-MM-dd" :disabled="constF.includes(key)" size="mini"></el-date-picker>
<el-date-picker v-else-if="typeDict[key]=='month'" v-model="scope.row[key]" type="month" value-format="yyyy-MM" :disabled="constF.includes(key)" size="mini"></el-date-picker>
<el-date-picker v-else-if="typeDict[key]=='datetime'" v-model="scope.row[key]" type="datetime" value-format="yyyy-MM-dd HH:mm:ss" :disabled="constF.includes(key)"></el-date-picker>
<el-upload v-else-if="typeDict[key]=='file'||typeDict[key]=='img'" :accept="typeDict[key]=='img'?'image/*':''" :data="{'typename':dashid,'path':uploadpath, 'key':key}" action="/echart/upload_file/"  :on-success="handleUpload" :before-upload="beforeUpload" :inline="true" :show-file-list="false" style="display: inline-block;" :disabled="constF.includes(key)">
<el-button size="mini" style="background-color:#6e8665;border: none;color:#fff" icon="el-icon-upload2"></el-button><span>{[scope.row[key]]}</span></el-upload>
<el-select v-else-if="['select','selects'].includes(typeDict[key])" :remote="remoteDsDict[key]" :remote-method="(q)=>{remoteMethod(q,key)}" :loading="loadingDict[key]" v-model="scope.row[key]" :multiple="typeDict[key]=='selects'" filterable clearable @change="selectChange(key,scope.row)" :disabled="constF.includes(key)" size="mini">
<el-option v-for="item in optionDict2[key]" :key="item[0]" :label="item.join('-')" :value="item[0]"></el-option></el-select>
<el-autocomplete v-else-if="remoteDsDict[key]" size="mini"  clearable v-model="scope.row[key]" :fetch-suggestions="(q,c)=>{querySearch(q,c,key)}"  @change="selectChange(key,scope.row)" :disabled="constF.includes(key)" size="mini">
<template slot-scope="{ item }"><span style="margin-right:3px" v-for="item1 of item">{[item1]}</span></template></el-autocomplete>
<el-switch v-else-if="typeDict[key]=='switch'" v-model="scope.row[key]"  :disabled="constF.includes(key)" :active-value=1 :inactive-value=0 size="mini"></el-switch>
<el-input v-else v-model.trim="scope.row[key]" autocomplete="off" :disabled="constF.includes(key)"  @change="calcChange(key)" clearable size="mini"></el-input>
</template></el-table-column><el-table-column label="操作" width="80" align="center"><template slot-scope="scope"><el-button type="danger" icon="el-icon-delete" size="mini" circle @click="removeDetailRow(scope.$index)"></el-button>
</template></el-table-column></el-table></div></div>
`;
part=document.getElementById("modifyForm1");
if(part){
part.innerHTML=`<el-alert  :title="modifyFlag?minfo:ainfo" type="success" :closable="false" v-if="modifyFlag?minfo:ainfo"></el-alert><el-form ref="form" :model="form" :rules="rules" :label-position="labelPosition" :label-width="formLabelWidth" :inline="true" size="mini" :class="line_input?'line-input':''">${modifyForm}<el-button :disabled="isClicked" type="primary" @click.stop="update_data" icon="el-icon-success" size="mini">{[modifyFlag===0?'新增':'修改']}</el-button></el-form>`;
}
part=document.getElementById("modifyForm2");
if(part){part.innerHTML=`<el-alert  :title="modifyFlag?minfo:ainfo" type="success" :closable="false" v-if="modifyFlag?minfo:ainfo"></el-alert><el-form ref="form" :inline="!!formSize" :size="formSize" :model="form" :rules="rules" :label-position="labelPosition" :label-width="formLabelWidth" :class="line_input?'line-input':''">${modifyForm}</el-form><div slot="footer" class="dialog-footer"><el-button @click="dialogFormVisible = false" icon="el-icon-circle-close">关闭</el-button><el-button :disabled="isClicked" type="primary" @click.stop="update_data" icon="el-icon-success">提交</el-button><el-button @click="printTable('modifyForm2')" icon="el-icon-printer"  v-if="print">打印</el-button></div>`}
part=document.getElementById("partRequest");
if(part) {
part.innerHTML = `<el-form ref="rform" :model="rform" :rules="rules" :label-width="formLabelWidth">
<el-form-item  prop="code" label="主键" required><el-input  v-model="rform.code" autocomplete="off" disabled></el-input></el-form-item>
<el-form-item  prop="columnname" label="列名" required><el-select  v-model="rform.columnname" @change="rform_select_change"><el-option v-for="(value, key) in nameDict" :label="value" :value="key"></el-option></el-select></el-form-item>
<el-form-item  prop="oldvalue" label="旧值"><el-input  v-model="rform.oldvalue" autocomplete="off" disabled></el-input></el-form-item>
<el-form-item  prop="newvalue" label="新值" required><el-input v-model.trim="rform.newvalue" autocomplete="off"></el-input></el-form-item>
<el-form-item  prop="request_remark" label="备注"><el-input v-model="rform.request_remark" autocomplete="off"></el-input></el-form-item>
</el-form>
<div slot="footer" class="dialog-footer">
<el-button @click="dialogFormVisible_r = false" icon="el-icon-circle-close"></el-button>
<el-button  type="primary" :disabled="isClicked" @click.stop="update_data_r" icon="el-icon-success"></el-button>
</div>
`;
}
part = document.getElementById("partCard");
if(part) {
part.innerHTML = `<div style="min-height:400px;" class="smt" id="container_999" v-if="!detail"></div>
<el-descriptions :column="shortCol" :direction="shortDire?'vertical':''" :border="shortBord" v-else-if="detail.length==1">
<el-descriptions-item v-for="(value,item) in detail[0]" :key="item" :label="nameDict[item]||item">
 <el-tag v-if="tagFields.includes(item)" :color="statusColor[value]" style="color:black" disable-transitions size="mini">{[value]}</el-tag>
<el-image v-else-if="value&&typeDict[item]==='img'" :src="construct_img(value)" style="width: 100px" :preview-src-list="[construct_img(value)]" lazy></el-image>
<span v-else>{[value]}</span></el-descriptions-item></el-descriptions>
<el-table :data="detail" style="width: 100%" size="mini" :max-height="maxheight-50" border :stripe="stripe" :show-summary="showSummary" :summary-method="getSummaries" :header-cell-style="{background: tableHeaderColor}" v-else>
<el-table-column v-for="(value, key) in detail[0]" :label="nameDict[key]||key" :width="widthDict[key]" :align="alignDict[key]||'center'" :prop="key" :key="key" sortable show-overflow-tooltip :fixed="fixedFields.includes(key)"></el-table-column>
</el-table>
<el-button @click="printTable('partCard')" icon="el-icon-printer" size="mini" v-if="print"></el-button>
`
}
let searchForm=`<el-checkbox-group v-if="dmFields" v-model="checkedFields" @change="handleCheckedChange"  size="mini"><el-checkbox-button v-for="item in dmFields" :label="nameDict[item]||item" :key="item" ></el-checkbox-button></el-checkbox-group>
<template v-for="(value, key) in searchDict"><span v-if="showLabel" class="label" v-text="nameDict[key]||key"></span><el-date-picker v-if="['date','datetime'].includes(typeDict[key])" v-model="searchDict[key]" type="daterange" :start-placeholder="nameDict[key]||key" end-placeholder="Period" size="mini" style="width:200px" value-format="yyyy-MM-dd" @change="change"></el-date-picker>
    <el-date-picker v-else-if="typeDict[key]=='month'" v-model="searchDict[key]" type="monthrange" :start-placeholder="nameDict[key]||key" end-placeholder="Period" size="mini" style="width:200px" value-format="yyyy-MM" @change="change"></el-date-picker>
    <el-select  v-else-if="['select','selects','radio'].includes(typeDict[key])" :remote="remoteDsDict[key]" :remote-method="(q)=>{remoteMethod(q,key)}" :loading="loadingDict[key]" v-model="searchDict[key]" :multiple="typeDict[key]=='selects'" collapse-tags :style="{width:swidthDict[key]||inputWidth}" :placeholder="nameDict[key]||key" size="mini" clearable filterable @change="change">
<el-option v-for="item in optionDict2[key]" :key="item[0]" :label="item.join('-')" :value="item[0]"></el-option></el-select><el-autocomplete v-else-if="remoteDsDict[key]" size="mini" :style="{width:swidthDict[key]||inputWidth}" suffix-icon="el-icon-search" clearable v-model="searchDict[key]" :fetch-suggestions="(q,c)=>{querySearch(q,c,key)}" :placeholder="nameDict[key]||key" @change="change">
 <template slot-scope="{ item }"><span style="margin-right:3px" v-for="item1 of item">{[item1]}</span></template></el-autocomplete>
<el-switch v-else-if="typeDict[key]=='switch'" v-model="searchDict[key]" :inactive-text="nameDict[key]||key" :active-value=1 :inactive-value=0 size="mini" @change="change"></el-switch>
<el-input v-else-if="typeDict[key]=='qr'" v-model.trim="searchDict[key]" autocomplete="off" :placeholder="nameDict[key]||key"  :style="{width:swidthDict[key]||inputWidth}" size="mini" clearable @change="change"><template slot="append"><el-button icon="el-icon-camera" size="mini" @click="handleQr('searchDict',key)"></el-button></template></el-input>
<el-input v-else v-model.trim="searchDict[key]" prefix-icon="el-icon-search" autocomplete="off" :placeholder="nameDict[key]||key"  :style="{width:swidthDict[key]||inputWidth}" size="mini" clearable @change="change"></el-input>
</template><el-button size="mini" v-if="btnSearch" style="background-color:#66b1ff;border: none;color:#fff" @click="search" icon="el-icon-search"></el-button>
<el-button size="mini" v-if="btnAdd" style="background-color:#ff9900;border: none;color:#fff;" @click='handleAdd' icon="el-icon-circle-plus-outline"></el-button>
<el-popconfirm v-if="btnDownload" confirm-button-text='CSV' cancel-button-text='EXCEL' title="请选择导出类型？CSV导出快" @confirm='daochu(0)' @cancel='daochu(1)'>
<el-button size="mini" slot="reference"  style="background-color:darksalmon;border:none;color:#fff;margin-left:3px" icon="el-icon-download"></el-button>
</el-popconfirm>
<el-button size="mini" v-if="daochut_id" style="background-color:#6e8665;border:none;color:#fff;" @click="daochu('t')" icon="el-icon-download">模板</el-button>
<el-upload v-if="uploadds>0" :data="{'typename':dashid,'d':uploadds}" action="/echart/upload_file/" :on-success="handleUpload" :before-upload="beforeUpload" :inline="true" :show-file-list="false" style="display: inline-block;" accept=".xls,.xlsx,.csv"><el-button size="mini" style="background-color:#6e8665;border: none;color:#fff" icon="el-icon-upload2"></el-button></el-upload>
`;
part=document.getElementById("partSearch1");
if(part) {part.innerHTML = searchForm;}
part=document.getElementById("partSearch2");
if(part) {part.innerHTML = searchForm;}
part=document.getElementById("partFilter");
if(part) {
part.innerHTML = `<template v-for="(value, key) in filterDict">
<el-date-picker v-if="typeDict[key]=='date'" v-model="filterDict[key]" type="date"  size="mini" :style="{width:inputWidth}" :placeholder="nameDict[key]||key" value-format="yyyy-MM-dd" clearable @change="data_filter()"></el-date-picker>
<el-date-picker v-else-if="typeDict[key]=='month'" v-model="filterDict[key]" type="month"  size="mini" :style="{width:inputWidth}" :placeholder="nameDict[key]||key" value-format="yyyy-MM" clearable @change="data_filter()"></el-date-picker>
<el-input v-else v-model="filterDict[key]" autocomplete="off" :placeholder="nameDict[key]||key"  :style="{width:swidthDict[key]||inputWidth}" size="mini" clearable @input='data_filter()'></el-input>
</template>
<el-popconfirm v-for="(value, key) in actionDict" :title="'execute:'+value[0]+'?'"  @confirm='action_batch(key)'>
<el-button slot="reference" :disabled="isClicked"  size="mini" :style="{background:value[1],border:'none',color:'#fff'}" >{[value[0]]}</el-button>
</el-popconfirm>
<el-button size="mini" :icon="isChinese(k)?'':k" @click.stop="action_batch(k,v)" v-for="(v, k) in funDsDict"><span v-if="isChinese(k)" v-html="k"></span></el-button>
<el-button @click="printTable('printTable')" icon="el-icon-printer" size="mini" v-if="print"></el-button>
<el-button-group  v-if="toolbar">
<el-button @click="reload" icon="el-icon-refresh" style="padding:2px;border:none"></el-button>
<el-button @click="searchDisplay" icon="el-icon-crop" style="padding:2px;border:none"></el-button>
</el-button-group>
`;}
part=document.getElementById("partShort");
if(part) {
part.innerHTML =`<template slot-scope="scope">
<el-descriptions  :column="shortCol" size="mini"  :direction="shortDire?'vertical':''" :border="shortBord">
<el-descriptions-item v-for="item in (tableFields||tableHead)" :key="item" :label="nameDict[item]||item" >
<el-tag v-if="tagFields.includes(item)" :color="statusColor[scope.row[item]]" style="color:black" disable-transitions size="mini">{[scope.row[item]]}</el-tag>
<el-image v-else-if="scope.row[item]&&typeDict[item]==='img'" :src="construct_img(scope.row[item])" style="width: 100px" :preview-src-list="[construct_img(scope.row[item])]" lazy></el-image>
<span v-else>{[scope.row[item]]}</span>
</el-descriptions-item>
</el-descriptions>
</template>`}
part = document.getElementById("partSetup");
if(part) {
part.innerHTML=`<div style="padding: 10px"><el-form :model="setupform" ref="setupform"  size="mini" :inline="true"><el-tabs tab-position="left">
<el-tab-pane  v-for="(v1,k1) in setupPanel" :label=v1><el-form-item  v-for="(v, k) in setupform" v-if="v.p==k1" :label="v.label">
<el-switch v-if="v.type=='switch'" v-model="setupform[k].value" :disabled="diyKeys.includes(k)"></el-switch>
<el-color-picker v-else-if="v.type=='color'" v-model="setupform[k].value" :disabled="diyKeys.includes(k)"></el-color-picker>
<el-input v-else-if="v.type=='input'" v-model="setupform[k].value" autocomplete="off" :placeholder="v.placeholder" :disabled="diyKeys.includes(k)"></el-input>
<el-input v-else-if="['input_list','input_dict','text_dict','text_dict2'].includes((setupKeyDict[k]||v.type))"  v-model="setupform[k].value" autocomplete="off" :placeholder="v.placeholder" :disabled="diyKeys.includes(k)"><template slot="suffix"><i class="el-icon-edit el-input__icon" @click="openDevDialog(k)" ></i></template></el-input>
<el-input v-else-if="v.type=='number'" type="number" v-model="setupform[k].value" style="width:60px" autocomplete="off" :placeholder="v.placeholder" :disabled="diyKeys.includes(k)"></el-input>
</el-form-item><div><el-button type="info" size="small" @click="save_crud(false)">预览</el-button><el-button type="warning" size="small" @click="save_crud(1)">保存</el-button><el-button type="danger" size="small" @click="save_crud(2)">发布</el-button></div>
</el-tab-pane><el-tab-pane label="模型管理"><el-row><el-input v-model="tableName" size="mini" style="width:150px" prefix-icon="el-icon-search" placeholder="输入表名[可选]"></el-input><el-button @click.prevent="searchfieldList" size="mini">查询</el-button>
<el-button @click.prevent="viewfieldList" size="mini">预览</el-button><el-button @click.prevent="save_crud(1)" size="mini">保存</el-button><el-popconfirm v-if="tableName" con-color="red" title="确认执行数据库操作,这是不可恢复的" @confirm="savefieldList"><el-button slot="reference" size="mini">执行</el-button></el-popconfirm>
</el-row><el-row  style="font-size: 12px" :gutter="5"><el-col :span="3">字段名</el-col><el-col :span="3">备注</el-col><el-col :span="3" v-if="tableName">实际类型</el-col><el-col :span="2" v-if="tableName">默认</el-col><el-col :span="1" v-if="tableName">空</el-col>
<el-col :span="3">类型</el-col><el-col :span="2">对齐</el-col><el-col :span="2">宽度</el-col><el-col :span="9" v-if="!tableName"><el-col :span="2">只读</el-col><el-col :span="2">新增</el-col><el-col :span="2">修改</el-col><el-col :span="2">必填</el-col>
<el-col :span="2">查询</el-col><el-col :span="2">过滤</el-col><el-col :span="2">长显</el-col><el-col :span="2">短显</el-col><el-col :span="2">子增</el-col><el-col :span="2">子修</el-col><el-col :span="2">备1</el-col><el-col :span="2">备2</el-col></el-col></el-row>
<div style="height: 50%"><el-row v-for="item in fieldList" :gutter="5" style="margin-bottom: 2px;" v-if="item.flag!==2"><el-col :span="3"><el-input v-model="item.name" size="mini"></el-input></el-col>
<el-col :span="3"><el-input v-model="item.comment" size="mini"></el-input></el-col><el-col :span="3"><el-input v-model="item.actualtype" size="mini" v-if="tableName"></el-input></el-col><el-col :span="2" v-if="tableName"><el-input v-model="item.default" size="mini"></el-input></el-col><el-col :span="1" v-if="tableName"><el-checkbox v-model="item.isnull" size="mini"></el-checkbox></el-col>
<el-col :span="3"><el-select v-model="item.type" size="mini" clearable><el-option label="单选" value="radio"></el-option><el-option label="选择" value="select"></el-option><el-option label="多选" value="selects"></el-option>
<el-option  label="数字" value="number"></el-option><el-option  label="时间" value="datetime"></el-option><el-option  label="日期" value="date"></el-option><el-option  label="月份" value="month"></el-option><el-option label="长文本" value="text"></el-option><el-option  label="文件" value="file"></el-option>
<el-option  label="图片" value="img"></el-option><el-option label="开关" value="switch"></el-option><el-option label="颜色" value="color"></el-option><el-option label="进度条" value="progress"></el-option><el-option label="评分" value="rate"></el-option><el-option label="扫码" value="qr"></el-option><el-option label="说明" value="remark"></el-option></el-select></el-col>
<el-col :span="2"><el-select v-model="item.align" size="mini" clearable><el-option  key="left" label="左" value="left"></el-option><el-option  key="right" label="右" value="right"></el-option></el-select></el-col>
<el-col :span="2"><el-input v-model="item.width" size="mini"></el-input></el-col><el-col :span="9" v-show="!tableName"><el-col :span="2"><el-checkbox v-model="item.isconst" size="mini"></el-checkbox></el-col>
<el-col :span="2"><el-checkbox v-model="item.isadd" size="mini"></el-checkbox></el-col><el-col :span="2"><el-checkbox v-model="item.ismodify" size="mini"></el-checkbox></el-col>
<el-col :span="2"><el-checkbox v-model="item.isrequired" size="mini"></el-checkbox></el-col><el-col :span="2"><el-checkbox v-model="item.issearch" size="mini"></el-checkbox></el-col>
<el-col :span="2"><el-checkbox v-model="item.isfilter" size="mini"></el-checkbox></el-col><el-col :span="2"><el-checkbox v-model="item.isshows" size="mini"></el-checkbox></el-col><el-col :span="2"><el-checkbox v-model="item.isshow" size="mini"></el-checkbox></el-col><el-col :span="2"><el-checkbox v-model="item.isadd1" size="mini"></el-checkbox></el-col><el-col :span="2"><el-checkbox v-model="item.ismodify1" size="mini"></el-checkbox></el-col><el-col :span="2"><el-checkbox  size="mini"></el-checkbox></el-col><el-col :span="2"><el-checkbox  size="mini"></el-checkbox></el-col>
</el-col><el-col :span="1"><el-button type="text" @click.prevent="removefieldList(item)" size="mini" icon="el-icon-delete"></el-button></el-col>
</el-row><el-row><el-button type="text" @click.prevent="addfieldList" size="small" icon="el-icon-circle-plus-outline">添加一行</el-button></el-row>
</div></el-tab-pane></el-tabs></el-form></div><div>
<el-dialog  width="60%" :visible.sync="dialogDevFormVisible" :append-to-body="true" :modal="true" :close-on-click-modal="false" :close-on-press-escape="false" :show-close="false">
<el-alert type="info"  :title="devValue.key+devValue.msg" :description="devValue.desc" show-icon :closable="false"></el-alert><el-input  type="textarea" autosize v-model="devValue.value"></el-input>
<div slot="footer"><el-button @click="dialogDevFormVisible=false;dialogSetupVisible=true">取消</el-button><el-button type="primary" @click="saveDevValue">确定</el-button></div>
</el-dialog>
</div>`;}
var vapp=new Vue({el:"#vue_app",delimiters:["{[","]}"],data:{startRender:!1,multipleSelection:[],dialogTableVisible:!1,devValue:{key:"",value:"",msg:""},diyKeys:[],diyVars:{},detail:"",statistic:"",title:"\u6570\u636e\u6e05\u5355",dashid:dashid,tableData:[],tableHead:[],tableFields:"",shortTableFields:"",shortCol:2,shortDire:!1,shortBord:!0,isChart:!1,mobile:window.mobile,isMobileCard:!1,fullData:[],modifyFlag:0,dialogFormVisible:!1,total:0,isBackPage:!1,isClicked:!1,dialogFormVisible_r:!1,dialogSetupVisible:!1,setupform:"",clickRow:"",maxheight:600,minheight:"",uploadpath:"crud",searchHead:!0,addHead:!1,tableHeaderColor:"#475254",dialogWidth:"60%",dialogFull:!1,smtdrag:!1,toolbar:!0,print:!1,printOpt:{maxWidth:1800,type:"html",targetStyles:["*"]},showTable:!0,showLabel:!1,stripe:!1,fixedFields:"",actionFixed:!0,showIndex:!1,showSummary:!1,exSumFields:"",dmFields:"",checkedFields:[],mergeFields:"",spotFields:"",btnDownload:!0,btnAdd:!0,btnSearch:!0,btnEdit:!1,isEditRequest:!1,btnView:!1,btnRequest:!1,currentPage:1,pageSize:30,pageSizes:"30,50,100,500,1000",formLabelWidth:"auto",labelPosition:"",inputWidth:"100px",nameDict:"",typeDict:"",form:{},aform:"",mform:"",form1:"",mform1:"",aform1:"",formSize:"",line_input:!1,remainFields:"",iseditadd:!1,autoform:{},rform:{},constFields:["id"],constF:[],tagFields:"",widthDict:"",swidthDict:"",alignDict:"",optionDict:"",optionDict2:{},filterDict:"",actionDict:"",funDsDict:"",searchDict:"",selectDsDict:"",rules:"",requiredFields:"",statusColor:"",tooltipDict:"",defaultDict:"",adefaultDict:"",ainfo:"",minfo:"",table_id:0,add_id:1,update_id:1,audit_id:1,detail_id:"",action_id:3,option_id:"",tree_id:"",delete_id:"",uploadds:"",tree_ds:"",statistic_id:"",viewDsDict:"",daochu_id:"",daochut_id:"",chartids:"",chartids_t:"",addb_id:"",adda_id:"",fieldList:[],tableName:"",tree_data:null,tableWidth:"99%",treeWidth:"150px",loadingDict:{},remoteDsDict:"",selectDsHead:{},selectParamDict:"",optionParam:"",qrVisible:!1,scanSubmit:!1,qrCheckStr:"",qrFormats:"",setupKeyDict:{form:"input_dict",aform:"input_dict",mform:"input_dict",searchDict:"input_dict",filterDict:"input_dict",tableFields:"input_list",shortTableFields:"input_list",diyKeys:"input_list",optionParam:"input_list",pageSizes:"input_list2",chartids:"input_list",chartids_t:"input_list",qrFormats:"input_list",constFields:"input_list",tagFields:"input_list",requiredFields:"input_list",fixedFields:"input_list",dmFields:"input_list",mergeFields:"input_list",spotFields:"input_list",exSumFields:"input_list",nameDict:"text_dict",widthDict:"text_dict",alignDict:"text_dict",typeDict:"text_dict",statusColor:"text_dict",selectDsDict:"text_dict",remoteDsDict:"text_dict",swidthDict:"text_dict",viewDsDict:"text_dict",tooltipDict:"text_dict",aform1:"input_list",mform1:"input_list",remainFields:"input_list",funDsDict:"text_dict"},detailData:[],detailDatabk:[],ztable_id:""},methods:{isChinese(t){return/[\u4E00-\u9FFF]/.test(t)},handleNodeClick(t,i){if(i.isLeaf){let t=i.data.param||i.data.id;t==filter_param._label&&(t=""),ds_setParam("_label",t),this.refreshTable(),this.data_filter()}},spanMethod({row:e,column:s,rowIndex:a}){if(this.mergeFields.includes(s.property)){if((0===a?"":this.tableData[a-1])[s.property]===e[s.property])return{rowspan:0,colspan:0};{let t=1,i=a+1;for(;i<this.tableData.length&&this.tableData[i][s.property]===e[s.property];)i++,t++;return{rowspan:t,colspan:1}}}return{rowspan:1,colspan:1}},translate_keyValue(t,i){return i&&"string"==typeof i?(i=i.replace(/\uff0c/g,",").replace(/\uff1a/g,":"),"input_list"===t?i.split(",").map(t=>t.trim()):"input_list2"===t?JSON.parse("["+i+"]"):"input_dict"===t?i.split(",").reduce((t,i)=>(t[i.trim()]="",t),{}):"text_dict"===t?i.split(",").reduce((t,i)=>{var[i,e]=i.split(":");return t[i.trim()]=e.trim(),t},{}):"text_dict2"===t?(i=i.replace(/\u201c/g,'"').replace(/\u201d/g,'"'),JSON.parse(i)):i):i},refresh_option(){if(this.option_id){var i,e,s={};for(i of this.optionParam)this.form[i]&&(s[i]=this.form[i]);let t=ds_refresh(this.option_id,s,"list");for(e in t=t instanceof Array?{df0:t}:t)this.optionDict2[t[e][0][0]]=t[e].slice(1),this.form[t[e][0][0]]&&(this.form[t[e][0][0]]=null)}},transfer_config(){for(var t in this.setupKeyDict)this[t]=this.translate_keyValue(this.setupKeyDict[t],this[t]);for(var i in this.requiredFields&&0<this.requiredFields.length&&(this.rules=this.requiredFields.reduce((t,i)=>(t[i]=[{required:!0,message:"\u8bf7\u8f93\u5165"+(this.nameDict[i]||i),trigger:"blur"}],t),{})),this.optionDict)this.optionDict2[i]=this.optionDict[i];var e;if(this.refresh_option(),this.tree_ds&&(e=ds_refresh(this.tree_ds,null,"list"),this.tree_data=ds_tree(e)),this.addHead&&this.handleAdd(),this.defaultDict)for(var s in this.searchDict)this.defaultDict[s]&&(this.searchDict[s]=this.defaultDict[s])},construct_img(t){return"/static/custom/"+this.uploadpath+"/"+t},handlerSizeChange(t){this.currentPage=1,this.pageSize=t,this.isBackPage?(this.refreshTable(),this.data_filter()):this.tableData=this.fullData.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize)},handlerCurrentChange(t){this.currentPage=t,this.isBackPage?(this.refreshTable(),this.data_filter()):this.tableData=this.fullData.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize)},handleSelectionChange(t){this.multipleSelection=t},tableRowClassName({}){return""},tableHearderClassName({column:t}){return this.spotFields.includes(t.property)?"spot_field":""},handleRowClickChange(t){if(this.chartids_t)for(var i of this.chartids_t)ds_refresh(i,t)},change(){this.btnSearch||this.search()},handleCheckedChange(){for(var t of this.dmFields)this.checkedFields.includes(this.nameDict[t]||t)?ds_setParam("_"+t,t):ds_setParam("_"+t,"");this.refreshTable(),this.data_filter()},loadTree(t,i,e){var s,a=JSON.parse(JSON.stringify(filter_param)),r=this.shortTableFields||this.tableFields||this.tableHead;a[r[0]]=t[r[0]];for(s of this.dmFields)this.checkedFields.includes(s)&&(a["_"+s]=t[s]);var l=ds_refresh(this.tree_id,a,"list");l[0].push("treeid");for(let t=1;t<l.length;t++)l[t].push(ds_generateUUID());l[0][0]=r[0],e(ds_createMap_all(l))},search(){for(var t in this.currentPage=1,this.searchDict){var i;["date","month"].includes(this.typeDict[t])?(i=this.searchDict[t],ds_setParam(t+"_s",i?i[0]:""),ds_setParam(t+"_e",i?i[1]:"")):this.searchDict[t]instanceof Array?ds_setParam(t,this.searchDict[t].map(t=>"'"+t+"'").join(",")):ds_setParam(t,this.searchDict[t])}if(this.refreshTable(),this.data_filter(),this.chartids)for(var e of this.chartids)ds_refresh(e)},update_data(){this.stopClick(),this.$refs.form.validate(t=>{if(t){let a={};for(var i in this.form)if(!(this.modifyFlag&&this.clickRow[i]===this.form[i]||"remark"===this.typeDict[i])&&(this.modifyFlag||null!==this.form[i])&&(this.form[i]instanceof Array?a[i]=this.form[i].join(","):a[i]=this.form[i],this.qrCheckStr)&&"qr"===this.typeDict[i]&&a[i]&&!a[i].startsWith(this.qrCheckStr))return void this.$message.error("\u4e0d\u662f\u6b63\u786e\u7684\u4e8c\u7ef4\u7801");for(var e in this.autoform)a[e]=this.autoform[e];if(this.detailData.length||this.detailDatabk.length)if(this.modifyFlag){let i=0,e=[],s=[],t=[];for(let t=0;t<this.detailDatabk.length;t++)if(i<this.detailData.length&&this.detailDatabk[t].id===this.detailData[i].id){var r,l={};for(r in this.detailData[i])this.detailData[i][r]!==this.detailDatabk[t][r]&&(l[r]=this.detailData[i][r]);0<Object.keys(l).length&&(l.id=this.detailData[i].id,s.push(l)),i++}else e.push(this.detailDatabk[t].id);i<this.detailData.length&&(t=this.detailData.slice(i)),e.length||s.length||t.length?(a._child={fid:this.clickRow[this.constFields[0]]},e.length&&(a._child.del=e),s.length&&(a._child.mod=s),t.length&&(a._child.add=t)):Object.keys(a).length&&(a._child={fid:this.clickRow[this.constFields[0]]})}else this.detailData.length&&(a._child=this.detailData);if(0===Object.keys(a).length)this.$message.error("\u6ca1\u6709\u4efb\u4f55\u4fee\u6539\u9879");else if(this.modifyFlag&&(a[this.constFields[0]]=this.clickRow[this.constFields[0]]),this.isEditRequest&&this.modifyFlag)this.$prompt("\u8bf7\u8f93\u5165\u53d8\u66f4\u539f\u56e0").then(({value:t})=>{delete a[this.constFields[0]],this.rform={code:this.clickRow[this.constFields[0]],newvalue:JSON.stringify(a),request_remark:t};t=ds_save(this.audit_id,this.rform);200==t.status?(this.$message.success("\u5b8c\u6210\u63d0\u4ea4,\u7b49\u5f85\u5ba1\u6838\u901a\u8fc7 Submitted, Wait for check"),this.dialogFormVisible=!1):this.$message.error(t.msg)}).catch(()=>{this.$message({type:"info",message:"\u53d6\u6d88\u4fee\u6539"})});else{if(this.addb_id){t=ds_refresh(this.addb_id,{...a},"list");if(void 0===t.status)return void this.$message.error("\u65b0\u589e\u524d\u6821\u9a8c\u9700\u8981\u8fd4\u56destatus");if(200!==t.status)return void this.$message.error(t.msg);t.data&&(a=t.data),t.msg&&this.$message.info(t.msg)}var s,t=ds_save(this.modifyFlag?this.update_id:this.add_id,a,this.modifyFlag);if(200==t.status){if(this.adda_id&&(200!==(s=ds_refresh(this.adda_id,{...a},"list")).status?this.$message.error(s.msg):this.$message.info(s.msg)),this.$message.success("\u5b8c\u6210\u6570\u636e\u4fdd\u5b58 Completed Save"),this.remainFields&&!this.modifyFlag)for(var h in this.form)this.remainFields.includes(h)||(this.form[h]=null);else{for(var d in this.form)this.form[d]=null;this.dialogFormVisible=!1}this.detailData=[],this.refreshTable(),this.data_filter()}else this.$message.error(t.msg)}}})},update_data_r(){this.stopClick(),this.$refs.rform.validate(t=>{t&&(200==(t=ds_save(this.audit_id,this.rform)).status?(this.$message.success("\u5b8c\u6210\u63d0\u4ea4,\u7b49\u5f85\u5ba1\u6838\u901a\u8fc7 Submitted, Wait for check"),this.dialogFormVisible_r=!1):this.$message.error(t.msg))})},action_batch(t,i){this.stopClick();let e=[];for(item of this.multipleSelection)e.push(item[this.constFields[0]]);t={action:t,updatelist:e=""+e.map(t=>"number"!=typeof t?"'"+t+"'":t).join(","),...filter_param};if(i){if(i.endsWith("!"))return i=i.slice(0,-1),vapp.dialogTableVisible=!0,void ds_refresh(i,t)}else i=this.action_id;i=ds_refresh(i,t,"list");this.refreshTable(),this.data_filter(),200==i.status?this.$message.success(i.msg):i.msg&&this.$message.error(i.msg)},handleEditClick(t){if(this.iseditadd)for(var i in this.handleAdd(),this.constF=this.constFields,this.form)null===this.form[i]&&(t[i]&&"selects"===this.typeDict[i]?this.form[i]=t[i].split(","):this.form[i]=t[i]);else if(this.constFields.length<1)this.$message.error("\u4f60\u9700\u8981\u5728\u53ea\u8bfb\u5b57\u6bb5\u4e2d\u8bbe\u5b9a\u7b2c\u4e00\u4f4d\u4e3a\u4e3b\u952e");else if(t.hasOwnProperty(this.constFields[0])){for(var e in this.modifyFlag=1,this.dialogFormVisible=!0,this.constF=this.constFields,this.mform&&(this.form=this.mform),this.clickRow=t,this.form1=this.mform1,this.ztable_id&&(this.detailData=ds_refresh(this.ztable_id,{fid:t[this.constFields[0]]},"map"),this.detailDatabk=JSON.parse(JSON.stringify(this.detailData)),console.log("d",this.detailData)),this.form)t[e]&&"selects"===this.typeDict[e]?this.form[e]=t[e].split(","):this.form[e]=t[e];this.$refs.form&&this.$refs.form.clearValidate()}else this.$message.error("\u672a\u627e\u5230\u4e3b\u952e,\u8bf7\u786e\u8ba4\u8bbe\u5b9a\u662f\u5426\u6b63\u786e")},handleDeleteClick(t){t=ds_save(this.delete_id,[t[this.constFields[0]]],2);200==t.status?(this.$message.success("\u5b8c\u6210\u6570\u636e\u5220\u9664 Completed Delete"),this.refreshTable(),this.data_filter()):this.$message.error(t.msg)},async handleViewClick(t,i){if(i=i||this.detail_id){if(this.detail=null,i.endsWith("!!"))return i=i.slice(0,-2),void ds_refresh(i,{...t,...filter_param});if(i.endsWith("!"))return i=i.slice(0,-1),vapp.dialogTableVisible=!0,void ds_refresh(i,{...t,...filter_param});i=ds_refresh(i,{...t,...filter_param},"list");if(await ds_chart(i))return void(this.dialogTableVisible=!0);this.detail=ds_createMap_all(i)}else this.detail=[t];this.dialogTableVisible=!0},handleRequestClick(t){this.dialogFormVisible_r=!0,this.clickRow=t,this.rform={code:"",columnname:"",oldvalue:"",newvalue:"",request_remark:""},this.rform.code=t[this.constFields[0]]},handleAdd(){for(var t in this.addHead||(this.dialogFormVisible=!0),this.modifyFlag=0,this.selectDsDict?this.constF=this.constFields.slice(1):this.constF=[],this.aform&&(this.form=this.aform),this.form)this.form[t]=null,this.adefaultDict&&this.adefaultDict[t]&&(this.form[t]=this.adefaultDict[t]);this.form1=this.aform1,this.detailData=[],this.$refs.form&&this.$refs.form.clearValidate()},daochu(i){if("t"===i)this.daochut_id?ds_download(this.title+"_\u6a21\u677f",ds_refresh(this.daochut_id,null,"list"),i):this.$message.error("\u7ba1\u7406\u5458\u8fd8\u672a\u8bbe\u5b9a\u5bfc\u5165\u6a21\u677f");else if(this.daochu_id)ds_download(this.title+"_\u5bfc\u51fa",ds_refresh(this.daochu_id,null,"list"),i);else{var e=[];let t=[];var s,a,r=this.shortTableFields||this.tableFields||this.tableHead;for(s of r)t.push(this.nameDict[s]||s);e.push(t);for(a of this.fullData){t=[];for(var l of r)t.push(a[l]);e.push(t)}ds_download(this.title+"_\u4e0b\u8f7d",e,i)}},data_filter(){let tempData=this.fullData;for(let key in this.filterDict)if(this.filterDict[key]){let v=this.filterDict[key].trim(),op=v[0];if(["<","=",">",">=","<="].includes(op)){if(v.length<2)return;"="==v[1]&&(op+="="),v=v.slice(op.length),"="==op&&(op="==");let fun=eval(`item => item${op}'${v}'`);tempData=tempData.filter(t=>fun(t[key]))}else{let regex=new RegExp(v,"i");tempData=tempData.filter(t=>regex.test(t[key]))}}this.isBackPage?this.tableData=tempData:(this.currentPage=1,this.tableData=tempData.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize),this.total=tempData.length)},stopClick(){this.isClicked=!0,setTimeout(()=>{this.isClicked=!1},1e3)},refreshTable(){if(this.statistic_id){var i=ds_refresh(this.statistic_id,null,"list");let t=[[],[]];if(i instanceof Array)t=i;else for(var e in i)t[0]=t[0].concat(i[e][0]),t[1]=t[1].concat(i[e][1]);this.statistic=ds_createMap_all(t)[0]}if(this.isBackPage&&(ds_setParam("limit",this.pageSize),ds_setParam("offset",vapp.pageSize*(vapp.currentPage-1))),0<=this.table_id){let i=ds_refresh(this.table_id,null,"list");if(this.isBackPage){if(i instanceof Array)return void this.$message.error("\u540e\u7aef\u5206\u9875,\u67e5\u8be2\u6570\u636e\u96c6\u9700\u5e26\u603b\u6570");this.total=i.df0[1][0],i=i.df1}else this.total=i.length-1;if(this.tree_id){i[0].push("treeid"),i[0].push("hasChildren");for(let t=1;t<i.length;t++)i[t].push(ds_generateUUID()),i[t].push(1);this.tableHead=i[0].slice(0,i[0].length-2)}else this.tableHead=i[0];this.fullData=ds_createMap_all(i),this.isBackPage?this.tableData=this.fullData:this.tableData=this.fullData.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize)}},rform_select_change(){this.rform.oldvalue=this.clickRow[this.rform.columnname]},selectChange(h,d=null){setTimeout(()=>{-1<this.optionParam.indexOf(h)&&this.refresh_option();var i=this.selectDsDict[h];if(i){var e,s=(d=d||this.form)[h],a={};let t=[];if((a[h]=s)||!this.selectDsHead[h]){if(s instanceof Array&&(a[h]=s.map(t=>"'"+t+"'").join(",")),this.selectParamDict[h])for(var r of this.selectParamDict[h])a[r]=d[r];t=ds_refresh(i,a,"list"),this.selectDsHead[h]=[t[0]]}else t=this.selectDsHead[h];for(e in d){var l=t[0].indexOf(e);-1<l&&(1<t.length?d[e]=t[1][l]:d[e]=null)}}},200)},remoteMethod(t,i){if(t){this.loadingDict[i]=!0;var e=this.remoteDsDict[i];if(e){var s={};if(s[i]=t,this.selectParamDict[i])for(var a of this.selectParamDict[i])s[a]=this.form[a];this.loadingDict[i]=!1,this.optionDict2[i]=ds_refresh(e,s,"list").slice(1)}}else this.optionDict2[i]=[]},querySearch(i,e,s){if(i){var a=this.remoteDsDict[s],r={};if(r[s]=i,this.selectParamDict[s])for(var l of this.selectParamDict[s])r[l]=this.form[l];let t=ds_refresh(a,r,"list");t[0][0]="value",e(t=ds_createMap_all(t))}else e([])},handleUpload(t,i,e){200===t.status?(t.key?this.form[t.key]=t.data[0]:this.refreshTable(),this.$message.success(t.msg)):this.$message.error(t.msg)},beforeUpload(t){t=t.size/1024/1024<10;return t||this.$message.error("\u6587\u4ef6\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7 10MB!"),t},async handleQr(t,i){await ds_loadjs("smt_qrcode",True),this.qrVisible={f:t,k:i}},qrDecode(t){this[this.qrVisible.f][this.qrVisible.k]=t,"searchDict"===this.qrVisible.f&&this.change(this.qrVisible.k),"form"===this.qrVisible.f&&this.selectChange(this.qrVisible.k),this.scanSubmit?this.update_data():this.qrVisible=!1},qrTrack(t,i){for(const l of t){var e,s,[a,...r]=l.cornerPoints;i.strokeStyle="red",i.beginPath(),i.moveTo(a.x,a.y);for({x:e,y:s}of r)i.lineTo(e,s);i.lineTo(a.x,a.y),i.closePath(),i.stroke()}},calcChange(t){},async printTable(t){await ds_loadjs("printJS",True);printJS({printable:t,style:".el-dialog{position:static!important;width: auto !important;margin: 0 auto !important;box-shadow: none !important;}.el-dialog__footer{display:none!important}",...this.printOpt})},searchDisplay(){this.addHead=!this.addHead,this.searchHead=!this.searchHead},reload(){window.location.reload()},getSummaries({columns:t,data:s}){const a=[];return t.forEach((i,t)=>{var e;0===t?a[t]="\u603b\u8ba1":this.exSumFields.includes(i.property)||(e=s.map(t=>Number(t[i.property]))).every(t=>isNaN(t))||(e=e.reduce((t,i)=>{i=Number(i);return isNaN(i)?t:t+i},0),a[t]=Number.isInteger(e)?e:parseFloat(e.toFixed(2)))}),a},loadchart(){this.isChart&&ds_loadjs("/static/echart/dist/echarts.min.js")},diyFun(){},addDetailRow(){const i={};this.form1.forEach(t=>{i[t]=""}),this.detailData.push(i)},removeDetailRow(t){this.detailData.splice(t,1)},rend(){this.refreshTable(),this.transfer_config(),this.startRender=!0}}});