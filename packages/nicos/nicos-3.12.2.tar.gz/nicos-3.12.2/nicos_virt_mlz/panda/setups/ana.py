description = 'Analyser'

includes = ['system', 'sampletable']

group = 'lowlevel'

devices = dict(
    att_step = device('nicos.devices.generic.VirtualMotor',
        unit = 'deg',
        abslimits = (-140, 140),
        speed = 1,
        visibility = (),
        curvalue = -40,
    ),
    att_enc = device('nicos.devices.generic.VirtualCoder',
        motor = 'att_step',
        unit = 'deg',
        visibility = (),
    ),
    anablocks = device('nicos_virt_mlz.panda.devices.stubs.AnaBlocks',
        description = 'Control for ana shielding blocks',
        visibility = (),
        unit = '',
    ),
    att = device('nicos_mlz.panda.devices.ana.ATT_Axis',
        description = 'Analyser two theta',
        anablocks = 'anablocks',
        motor = 'att_step',
        coder = 'att_enc',
        precision = 0.05,
        jitter = 0.5,
        maxtries = 10,
        offset = 0.54568,
    ),

    ath_step = device('nicos.devices.generic.VirtualMotor',
        unit = 'deg',
        abslimits = (-120, 5),
        speed = 1,
        visibility = (),
        curvalue = -20,
    ),
    ath_enc = device('nicos.devices.generic.VirtualCoder',
        motor = 'ath_step',
        unit = 'deg',
        visibility = (),
    ),
    ath = device('nicos.devices.generic.Axis',
        description = 'analyser rocking angle',
        motor = 'ath_step',
        coder = 'ath_enc',
        precision = 0.03,
        maxtries = 50,
        offset = -2.209,
    ),

    agx_step = device('nicos.devices.generic.VirtualMotor',
        unit = 'deg',
        abslimits = (-5, 5),
        speed = 1,
        visibility = (),
    ),
    agx_enc = device('nicos.devices.generic.VirtualCoder',
        motor = 'agx_step',
        unit = 'deg',
        visibility = (),
    ),
    agx = device('nicos.devices.generic.Axis',
        description = 'analyser tilt (up/down)',
        motor = 'agx_step',
        coder = 'agx_enc',
        precision = 0.01,
    ),

    aty_step = device('nicos.devices.generic.VirtualMotor',
        unit = 'mm',
        abslimits = (-10, 10),
        speed = 1,
        visibility = (),
    ),
    aty_enc = device('nicos.devices.generic.VirtualCoder',
        motor = 'aty_step',
        unit = 'mm',
        visibility = (),
    ),
    aty = device('nicos.devices.generic.Axis',
        description = 'analyser translation along Y (thickness correction)',
        motor = 'aty_step',
        coder = 'aty_enc',
        precision = 0.05,
        fmtstr = '%.1f',
    ),

    afh_step = device('nicos.devices.generic.VirtualMotor',
        unit = 'deg',
        abslimits = (-179, 179),
        speed = 1,
        visibility = (),
    ),
    afh_enc = device('nicos.devices.generic.VirtualCoder',
        motor = 'afh_step',
        unit = 'deg',
        visibility = (),
    ),

    afh_pg = device('nicos_mlz.panda.devices.rot_axis.RotAxis',
        description = 'horizontal focus of PG analyser',
        motor = 'afh_step',
        dragerror = 5,
        coder = 'afh_enc',
        abslimits = (-179, 179),
        precision = 1,
        fmtstr = '%.1f',
        autoref = None,  # disable autoref since there is no refswitch
    ),
    afh = device('nicos.devices.generic.DeviceAlias',
        alias = 'afh_pg',
    ),
)
