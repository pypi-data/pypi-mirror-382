# ï¼ï¼ï¼ä½ çš„ä»»åŠ¡ï¼šåŸºäºä¸‹è¿°è®ºæ–‡å¤§çº²ï¼Œç¼–å†™å®Œæ•´çš„2ä¸‡å­—ï¼ˆä¸¤ä¸‡å­—ï¼‰è®ºæ–‡

```è®ºæ–‡å¤§çº²
  
**æ ‡é¢˜**ï¼šé«˜æ€§èƒ½Base94ç¼–è§£ç å™¨è®¾è®¡ï¼šåŸºäºPythonè§£é‡Šå™¨ç‰¹æ€§ä¸Rusté›¶æˆæœ¬æŠ½è±¡çš„ååŒåŠ é€Ÿç­–ç•¥  

---

#### **æ‘˜è¦**  
1. ç ”ç©¶èƒŒæ™¯ï¼šæ•°æ®ç¼–ç éœ€æ±‚ä¸ç°æœ‰æ–¹æ¡ˆï¼ˆå¦‚Base64ã€Base85ã€Base122ï¼‰çš„å±€é™æ€§ã€‚  
2. æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•åœ¨æ˜“ç”¨æ€§ä¸æ€§èƒ½é—´å–å¾—å¹³è¡¡ã€‚ä¼ ç»ŸBase64æ‰©å±•æ–¹æ¡ˆçš„æ€§èƒ½é™åˆ¶ä¸PythonåŸç”Ÿå®ç°æ•ˆç‡ä¸è¶³ 
3. è§£å†³æ–¹æ¡ˆï¼šæå‡ºPythonä¸RustååŒåŠ é€Ÿç­–ç•¥ï¼Œç»“åˆPythonçš„åŠ¨æ€æ€§ä¸Rustçš„é›¶æˆæœ¬æŠ½è±¡ã€‚  
4. æˆæœï¼šå®ç°æ€§èƒ½æå‡14-40å€ï¼Œä¿æŒAPIå…¼å®¹æ€§ä¸å†…å­˜å®‰å…¨ã€‚  

---

#### **1. å¼•è¨€**  
- æ•°æ®ç¼–ç åœ¨æ•°æ®ä¼ è¾“/å­˜å‚¨ä¸­çš„é‡è¦æ€§ã€‚  
- Base94çš„è®¾è®¡ç›®æ ‡ï¼šæ‰©å±•å­—ç¬¦é›†åˆ©ç”¨ç‡ä¸ç´§å‡‘æ€§ã€‚  
- Pythonä¸Rustçš„äº’è¡¥æ€§ï¼šåŠ¨æ€è¯­è¨€å¿«é€Ÿè¿­ä»£ + é™æ€è¯­è¨€é«˜æ€§èƒ½æ‰§è¡Œã€‚  
- è®ºæ–‡è´¡çŒ®ï¼š  
  - æå‡ºè·¨è¯­è¨€ååŒåŠ é€Ÿæ¡†æ¶ã€‚  
  - å®ç°åŸºäºPyO3çš„é«˜æ•ˆPythonç»‘å®šã€‚  
  - éªŒè¯æ€§èƒ½ä¸å…¼å®¹æ€§ä¼˜åŠ¿ã€‚  

---

#### **2. ç›¸å…³å·¥ä½œ**  
- ç°æœ‰ç¼–è§£ç æ–¹æ¡ˆåˆ†æï¼šBase64ã€Base91ã€Base85çš„ä¼˜ç¼ºç‚¹ã€‚  
- Pythonæ‰©å±•ä¼˜åŒ–æŠ€æœ¯ï¼šCæ‰©å±•ã€Cythonã€PyO3ã€‚  
- Rustå¯¹è¡Œä¸šå’Œç ”ç©¶çš„å½±å“ï¼šå¼ºè°ƒç»“åˆPythonå’ŒRustè¿›è¡Œé«˜æ€§èƒ½è®¡ç®—çš„ä¼˜åŠ¿ã€‚
- Rusté›¶æˆæœ¬æŠ½è±¡åœ¨ç³»ç»Ÿç¼–ç¨‹ä¸­çš„åº”ç”¨æ¡ˆä¾‹ã€‚  

---

#### **3. Base94ç®—æ³•è®¾è®¡**  
- **3.1 ç¼–ç åŸç†**ï¼š  
  - æä¾›æµç¨‹å›¾ä»¥å¯è§†åŒ–ç¼–ç è¿‡ç¨‹ã€‚
  - åˆ†å—å¤„ç†ï¼ˆ9å­—èŠ‚â†’11å­—ç¬¦ï¼‰ã€‚  
  - åŸºæ•°94åˆ†è§£ä¸é¢„è®¡ç®—æŸ¥æ‰¾è¡¨ï¼ˆB94_ENCODE_TAB2ï¼‰ã€‚  
- **3.2 è§£ç åŸç†**ï¼š  
  - æä¾›æµç¨‹å›¾ä»¥å¯è§†åŒ–è§£ç è¿‡ç¨‹ã€‚
  - åå‘æ˜ å°„ä¸å¿«é€Ÿè§£ç è¡¨ï¼ˆB94_DECODE_TABï¼‰ã€‚  
  - å¤§æ•´æ•°è½¬æ¢ä¸å†…å­˜å¯¹é½ä¼˜åŒ–ã€‚  

---

#### **4. ååŒåŠ é€Ÿç­–ç•¥è®¾è®¡**  
- **4.1 Pythonå®ç°çš„åŠ¨æ€ä¼˜åŒ–**ï¼š  
  - åˆ©ç”¨è§£é‡Šå™¨ç‰¹æ€§ï¼šåŠ¨æ€ç±»å‹ã€é¢„è®¡ç®—è¡¨ï¼ˆ`b94tab2`ï¼‰ã€åˆ†å—è¿­ä»£ã€‚  
  - å¡«å……é€»è¾‘çš„åŠ¨æ€å†…å­˜åˆ†é…ä¼˜åŒ–ã€‚  
- **4.2 Rustçš„é›¶æˆæœ¬æŠ½è±¡ä¼˜åŒ–**ï¼š  
  - æ— å †åˆ†é…ï¼šæ ˆå†…å­˜æ“ä½œä¸é¢„åˆ†é…ç¼“å†²åŒºã€‚  
  - SIMDå‹å¥½å†…å­˜å¸ƒå±€è®¾è®¡å’ŒæŸ¥æ‰¾è¡¨é¢„ç”Ÿæˆï¼ˆ`lazy_static`ï¼‰ã€‚  
  - é”™è¯¯å¤„ç†ä¸å®‰å…¨è¾¹ç•Œæ£€æŸ¥ã€‚  
- **4.3 è·¨è¯­è¨€ååŒæœºåˆ¶**ï¼š  
  - åŠ¨æ€å®ç°é€‰æ‹©é€»è¾‘ï¼ˆ`__init__.py`ä¸­çš„åŠ è½½ç­–ç•¥ï¼‰ã€‚  
  - PyO3ç»‘å®šçš„é«˜æ•ˆæ•°æ®ä¼ é€’ï¼ˆé›¶æ‹·è´å­—èŠ‚æµå¤„ç†ï¼‰ã€‚ 
  - æä¾›æµç¨‹å›¾ä»¥å¯è§†åŒ–ç»‘å®šå’Œè°ƒç”¨è¿‡ç¨‹ã€‚ 

---

#### **5. æŠ€æœ¯ç»†èŠ‚**  
- **5.1 Pythonæ¨¡å—ç»“æ„**ï¼š  
  - çº¯Pythonå®ç°ï¼ˆ`base94.py`ï¼‰ä¸ç±»å‹æç¤ºï¼ˆ`_base94.pyi`ï¼‰ã€‚  
  - æ€§èƒ½ç“¶é¢ˆåˆ†æï¼ˆåŠ¨æ€ç±»å‹ä¸å¾ªç¯å¼€é”€ï¼‰
  - å…¼å®¹æ€§æµ‹è¯•è®¾è®¡ï¼ˆ`test_cons_ende.py`ï¼‰ã€‚  
- **5.2 Rustæ ¸å¿ƒä¼˜åŒ–**ï¼š  
  - åŒå­—ç¬¦ç¼–ç è¡¨é¢„è®¡ç®—ï¼ˆ`B94_ENCODE_TAB2`ï¼‰ã€‚  
  - å¤§æ•´æ•°åˆ†å—è®¡ç®—çš„ä½æ“ä½œä¼˜åŒ–ï¼ˆ`u128`é«˜æ•ˆè½¬æ¢ï¼‰ã€‚   
  - å†…å­˜å¯¹é½ä¸ç¼“å­˜é¢„å–ç­–ç•¥

---

#### **6. å®éªŒè¯„ä¼°**  
- **6.1 å®éªŒç¯å¢ƒ**ï¼šç¡¬ä»¶é…ç½®ã€æµ‹è¯•æ•°æ®é›†ï¼ˆ10KBâ€“10MBéšæœºæ•°æ®ï¼‰ã€‚  
- **6.2 æ€§èƒ½æŒ‡æ ‡**ï¼š  
  - ç¼–ç /è§£ç é€Ÿåº¦å¯¹æ¯”ï¼ˆPython Native vs. Rust Acceleratedï¼‰ã€‚  
  - å¯¹æ¯”åŸºçº¿ï¼ˆPythonåŸç”Ÿå®ç°ã€Base64/Base85ï¼‰ 
- **6.3 æ­£ç¡®æ€§éªŒè¯**ï¼š  
  - è·¨ç‰ˆæœ¬ä¸€è‡´æ€§æµ‹è¯•ï¼ˆ`test_cons_pyrs.py`ï¼‰ã€‚  
  - è¾¹ç•Œæ¡ä»¶æµ‹è¯•ï¼ˆç©ºè¾“å…¥ã€å¡«å……è¾¹ç•Œï¼‰ã€‚  
- **6.4 ç»“æœåˆ†æ**ï¼š  
  - RuståŠ é€Ÿç‰ˆè§£ç é€Ÿåº¦è¾¾70.26 MB/sï¼ˆ10KBæ•°æ®ï¼‰ã€‚  
  - Pythonä¸Rustå®ç°çš„çº¿æ€§æ‰©å±•æ€§éªŒè¯ã€‚  

---

#### **7. è®¨è®º**  
- ååŒåŠ é€Ÿç­–ç•¥çš„æ™®é€‚æ€§ï¼šå…¶ä»–ç¼–ç åœºæ™¯çš„åº”ç”¨æ½œåŠ›ã€‚   
- å¼€å‘è€…ä½“éªŒæƒè¡¡ï¼šPythonçš„æ˜“ç”¨æ€§ä¸Rustçš„ç¼–è¯‘æˆæœ¬ã€‚  
- å¼‚æ„ç¼–ç¨‹æ¨¡å‹çš„é€‚ç”¨åœºæ™¯  
- Pythonç”Ÿæ€ä¸Rusté«˜æ€§èƒ½çš„ååŒè¾¹ç•Œ  
- æ½œåœ¨ä¼˜åŒ–æ–¹å‘ï¼ˆAVXæŒ‡ä»¤é›†ã€GPUå¸è½½ï¼‰  

---

#### **8. ç»“è®ºä¸å±•æœ›**  
- æ€»ç»“ï¼šååŒç­–ç•¥åœ¨Base94ç¼–è§£ç ä¸­çš„æ˜¾è‘—æ€§èƒ½æå‡ã€‚  
- åº”ç”¨ä»·å€¼ï¼šé€‚ç”¨äºæ•°æ®è½¬ç ã€äºŒè¿›åˆ¶æ•°æ®ä¼ è¾“ç­‰åœºæ™¯ã€‚  
- æœªæ¥å·¥ä½œï¼š  
  - æ”¯æŒå¤šçº¿ç¨‹åˆ†å—å¹¶è¡Œå¤„ç†ã€‚  
  - è®¨è®ºæ”¯æŒå…¶ä»–ç¼–ç æ–¹æ¡ˆçš„å¯èƒ½æ€§ã€‚
  - æ¢ç´¢æ½œåœ¨çš„ä¼˜åŒ–å’Œæ‰©å±•ã€‚

---

#### **å‚è€ƒæ–‡çŒ®**  
- PyO3å®˜æ–¹æ–‡æ¡£ã€Rustå†…å­˜æ¨¡å‹ç ”ç©¶ã€Base91ä¼˜åŒ–æ–¹æ¡ˆã€‚  
- é«˜æ€§èƒ½Pythonæ‰©å±•å¼€å‘ç›¸å…³æ–‡çŒ®ã€‚  

---

#### **é™„å½•**  
- ä»£ç ä»“åº“åœ°å€ã€æ€§èƒ½æµ‹è¯•åŸå§‹æ•°æ®ã€æ ¸å¿ƒä»£ç ç‰‡æ®µï¼ˆPython/Rustå…³é”®å‡½æ•°å¯¹æ¯”ï¼‰ã€‚  

--- 

**æ³¨**ï¼šè®ºæ–‡éœ€ç»“åˆä»£ç ä¸­çš„æŠ€æœ¯ç»†èŠ‚ï¼ˆå¦‚åˆ†å—ç®—æ³•ã€æŸ¥æ‰¾è¡¨è®¾è®¡ï¼‰ä¸æ€§èƒ½æµ‹è¯•æ•°æ®ï¼Œçªå‡ºâ€œååŒåŠ é€Ÿâ€çš„åˆ›æ–°æ€§ä¸å®è·µä»·å€¼ã€‚
```

ä»¥ä¸‹æ˜¯è®ºæ–‡å¼€æºä»£ç åº“çš„ç›®å½•æ ‘å’Œå†…å®¹ï¼š

```ç›®å½•æ ‘
â”‚  .gitignore
â”‚  Cargo.lock
â”‚  Cargo.toml
â”‚  LICENSE
â”‚  pyproject.toml
â”‚  README.md
â”‚  uv.lock
â”‚
â”œâ”€python
â”‚  â”œâ”€base94
â”‚  â”‚  â”‚  base94.py
â”‚  â”‚  â”‚  _base94.pyi
â”‚  â”‚  â”‚  __init__.py
â”‚  â”‚
â”‚  â”œâ”€benchmarks
â”‚  â”‚  â”‚  performance_test.py
â”‚  â”‚  â”‚  __main__.py
â”‚  â”‚
â”‚  â””â”€tests
â”‚      â”‚  test_cons_ende.py
â”‚      â”‚  test_cons_pyrs.py
â”‚      â”‚  test_decode.py
â”‚      â”‚  test_encode.py
â”‚
â””â”€src
        lib.rs
```

å†…å®¹ï¼š
README.md

```README.md
# base94 ğŸš€

åŸºäºPyO3çš„é«˜æ€§èƒ½Base94ç¼–ç /è§£ç Rustå®ç°ï¼Œæ¯”åŸç”ŸPythonç‰ˆæœ¬å¿«14-40å€ã€‚

## ç‰¹æ€§

- âš¡ **æé€Ÿå¤„ç†**ï¼šä½¿ç”¨Rustä¼˜åŒ–æ ¸å¿ƒç®—æ³•
- ğŸ”„ **æ— ç¼å…¼å®¹**ï¼šå®Œç¾å…¼å®¹çº¯Pythonç‰ˆæœ¬
- ğŸ›¡ï¸ **å†…å­˜å®‰å…¨**ï¼šé›¶æ‹·è´æ“ä½œä¸é¢„åˆ†é…ç¼“å†²åŒº
- ğŸ“¦ **ç®€å•API**ï¼š`b94encode`/`b94decode` ä¸¤ä¸ªç›´è§‚å‡½æ•°

## å®‰è£…

### å‰ç½®è¦æ±‚

- Rustå·¥å…·é“¾ (1.74+)
- Python 3.8+
- maturin (`pip install maturin`)

### å®‰è£…æ­¥éª¤

## pip å®‰è£…

```bash
# å®‰è£…ç¨³å®šç‰ˆæœ¬
pip install 'base94-rs'

# å®‰è£…æµ‹è¯•ç‰ˆæœ¬
pip install git+https://github.com/hibays/base94.git
```

## ä»æºç ç¼–è¯‘

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/hibays/base94.git
cd base94

# ç¼–è¯‘å®‰è£…
pip install .
```

## ä½¿ç”¨ç¤ºä¾‹

```python
import base94

# ç¼–ç ç¤ºä¾‹
data = b"Hello Base94!"
encoded = base94.b94encode(data)
print(f"Encoded: {encoded}")  # b'4Tk7J#qZcjYw'

# è§£ç ç¤ºä¾‹
decoded = base94.b94decode(encoded)
print(f"Decoded: {decoded}")  # b'Hello Base94!'
```

## æ€§èƒ½å¯¹æ¯”

| æ•°æ®å¤§å° | å®ç°ç‰ˆæœ¬         | ç¼–ç æ—¶é—´ (s) | è§£ç æ—¶é—´ (s) | ç¼–ç é€Ÿåº¦   | è§£ç é€Ÿåº¦   |
|----------|------------------|--------------|--------------|------------|------------|
| 10KB     | Python Native    |       0.0088 |       0.0067 | 1.11 MB/s  | 1.45 MB/s  |
| 10KB     | Rust Accelerated |       0.0003 |       0.0001 | 31.75 MB/s | 70.26 MB/s |
| 100KB    | Python Native    |       0.0523 |       0.0704 | 1.87 MB/s  | 1.39 MB/s  |
| 100KB    | Rust Accelerated |       0.0035 |       0.0014 | 28.13 MB/s | 72.17 MB/s |
| 1MB      | Python Native    |       0.5254 |       0.7434 | 1.90 MB/s  | 1.35 MB/s  |
| 1MB      | Rust Accelerated |       0.0388 |       0.0220 | 25.79 MB/s | 45.54 MB/s |
| 10MB     | Python Native    |       5.5060 |       7.6613 | 1.82 MB/s  | 1.31 MB/s  |
| 10MB     | Rust Accelerated |       0.3819 |       0.2030 | 26.19 MB/s | 49.27 MB/s |

> æµ‹è¯•ç¯å¢ƒï¼ši7-13620H @ 2.4GHz, 32GB DDR5 RAM

## æŠ€æœ¯ç»†èŠ‚

### æ ¸å¿ƒä¼˜åŒ–

- **æŸ¥æ‰¾è¡¨é¢„è®¡ç®—**ï¼šä½¿ç”¨`lazy_static`åŠ é€Ÿå­—ç¬¦æ˜ å°„
- **SIMDå†…å­˜å¸ƒå±€**ï¼šå¯¹é½å†…å­˜è®¿é—®æ¨¡å¼
- **å—çº§å¹¶è¡Œ**ï¼š9å­—èŠ‚ç¼–ç å—çš„æ— é”å¤„ç†
- **é›¶å †åˆ†é…**ï¼šå®Œå…¨æ ˆå†…å­˜æ“ä½œ

### ç¼–ç æµç¨‹

```mermaid
graph TD
    %% ç¼–ç æµç¨‹å¼€å§‹
    A[è¾“å…¥å­—èŠ‚æµ] --> B{å¡«å……å¤„ç†}
    B -->|è¡¥é›¶| C[åˆ†å—å¤„ç† 9bytes/chunk]
    C --> D[è½¬æ¢ä¸º128ä½æ•´æ•°]
    D --> E[åŸºæ•°94åˆ†è§£]
    E --> F[æŸ¥è¡¨ç¼–ç ]
    F --> G[è¾“å‡ºBase94å­—ç¬¦ä¸²]

    %% Python Binding éƒ¨åˆ†
    H[Pythonè°ƒç”¨b94encode] --> I{è‡ªåŠ¨é€‰æ‹©å®ç°}
    I -->|Python Native| J[py_b94encode]
    I -->|Rust Accelerated| K[rs_b94encode]

    %% ç¼–ç ç®—æ³•åŠåŠ é€Ÿç»†èŠ‚
    L[æŸ¥æ‰¾è¡¨é¢„è®¡ç®—] --> M[SIMDå†…å­˜å¸ƒå±€]
    M --> N[å—çº§å¹¶è¡Œ]
    N --> O[é›¶å †åˆ†é…]
    O --> G

    %% ç¼–ç æœ€ç»ˆç»“æœ
    G --> P[ç¼–ç æœ€ç»ˆç»“æœ]

    %% è§£ç æµç¨‹å¼€å§‹
    Q[è¾“å…¥Base94å­—ç¬¦ä¸²] --> R{å¡«å……å¤„ç†}
    R -->|è¡¥é›¶| S[åˆ†å—å¤„ç† 11bytes/chunk]
    S --> T[Base94å­—ç¬¦æ˜ å°„]
    T --> U[ç»„åˆæˆ9å­—èŠ‚]
    U --> V[è¾“å‡ºè§£ç å­—èŠ‚æµ]

    %% Python Binding éƒ¨åˆ†
    W[Pythonè°ƒç”¨b94decode] --> X{è‡ªåŠ¨é€‰æ‹©å®ç°}
    X -->|Python Native| Y[py_b94decode]
    X -->|Rust Accelerated| Z[rs_b94decode]

    %% è§£ç ç®—æ³•åŠåŠ é€Ÿç»†èŠ‚
    AA[æŸ¥æ‰¾è¡¨é¢„è®¡ç®—] --> BB[SIMDå†…å­˜å¸ƒå±€]
    BB --> CC[å—çº§å¹¶è¡Œ]
    CC --> DD[é›¶å †åˆ†é…]
    DD --> V

    %% è§£ç æœ€ç»ˆç»“æœ
    V --> EE[è§£ç æœ€ç»ˆç»“æœ]
```

## åŸºå‡†æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
python -m pytest

# è¿è¡Œæ€§èƒ½æµ‹è¯•
python -m python.benchmarks
```

## æœ¬åœ°å¼€å‘

> å»ºè®®ä½¿ç”¨`uv`ç®¡ç†è™šæ‹Ÿç¯å¢ƒ

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
uv venv
# å®‰è£…ä¾èµ–
uv pip install maturin twine
# æ‰“åŒ…å‘å¸ƒ
uv build && twine upload dist/*
# æœ¬åœ°æµ‹è¯•æ€§å®‰è£…
maturin develop --release
```

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤PRï¼å»ºè®®æµç¨‹ï¼š

1. Forkä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature`)
3. æäº¤ä¿®æ”¹ (`git commit -am 'Add feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature`)
5. åˆ›å»ºPull Request

## è®¸å¯è¯

[GPLv3](LICENSE)
```

Cargo.toml

```Cargo.toml
[package]
name = "base94"
version = "0.1.6"
edition = "2021"

[lib]
name = "_base94"
crate-type = ["cdylib"]

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[dependencies]
lazy_static = "1.5.0"
pyo3 = "0.23.4"
```

pyproject.toml

```pyproject.toml
[build-system]
requires = ["maturin>=1.8,<2.0"]
build-backend = "maturin"

[project]
name = "base94-rs"
authors = [
    {name = "hibays", email = "hibays@github.com"},
]
description = "A package allows you to en/decode using base94."
keywords = ["Codec", "Rust", "Base", "Base94"]
readme = "README.md"
requires-python = ">=3.8"
license = {file = "LICENSE"}
classifiers = [
    "Programming Language :: Rust",
    "Programming Language :: Python :: Implementation :: CPython",
    "Programming Language :: Python :: Implementation :: PyPy",
]
dependencies = [
]
dynamic = ["version"]

[project.urls]
repository = "https://github.com/hibays/base94.git"

[project.optional-dependencies]
test = [
    "pytest"
]

[tool.maturin]
python-source = "python"
module-name = "base94._base94"
strip = true
features = ["pyo3/extension-module"]
```

python/base94/base94.py

```base94.py
# Implementation of Base94 encode and decode in Python 3.
#
# THE GPLv3 LICENSE
# Copyleft (Â©) 2022 hibays
#

''' 
For example:

>>> from base94 import *

>>> b94encode(b'ABC')
b'Wg\\`y'

>>> b94encode(b'123456')
b'Q<-{{@fN'

>>> b94decode(b'Wg\\`y')
b'ABC'

>>> b94decode(b'Q<-{{@fN')
b'123456'
'''

__all__ = ['b94encode', 'b94decode']

_b94alphabet = (b'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!"#$%&\'()*+,-./:;<=>?@[\\]^_`{|}~')
#_b94alphabet = sorted(_b94alphabet)

def b94encode(data,
	## HACK: turn globals into locals
	len=len,
	range=range,
	bnjoin=b''.join,
	from_bytes=int.from_bytes,
	b94tab=[bytes((i,)) for i in _b94alphabet] # The type of (b'ABC')[0] is int. This makes it from int to bytes.
	) -> bytes :
	'''Input bytes-like object, return bytes.
	This algorithm transform 9 bytes to 11 bytes
	The encoded data is about 22.2% larger.
	'''
	b94tab2 = [bnjoin((i, j)) for i in b94tab for j in b94tab] # A simple magic.

	datlen = len(data)
	padding = (-datlen) % 9
	if padding :
		data, datlen = \
			data + b'\0' * padding, datlen + padding
	
	encoded = []
	for i in range(0, datlen, 9) :
		c = from_bytes(data[i: i + 9], 'big') # from data get 9 bytes data to int
		
		# This is faster.
		d2_3 = c // 94
		d4_5 = d2_3 // 8836
		d6_7 = d4_5 // 8836
		d8_9 = d6_7 // 8836

		encoded.append(bnjoin(
			(
				b94tab2[d8_9 // 8836],
				b94tab2[d8_9 % 8836],
				b94tab2[d6_7 % 8836],
				b94tab2[d4_5 % 8836],
				b94tab2[d2_3 % 8836],
				b94tab[c % 94]
			)
		))

	if padding :
		encoded[-1] = encoded[-1][: -padding]

	return bnjoin(encoded)
	
def b94decode(data,
	## HACK: turn globals into locals
	len=len,
	range=range,
	bnjoin = b''.join,
	_intto_byte = int.to_bytes,
	b94nums = {j: i for i,j in enumerate(_b94alphabet)} # dict faster
	) -> bytes :
	'''This function decodes the data that has been encoded by base94.
	Input bytes-like object, return bytes.
	'''
	datlen = len(data)
	padding = (-datlen) % 11
	if padding :
		data, datlen = \
			data + b'~' * padding, datlen + padding
	
	# To revert base94-encoded data. 11 bytes -> 9 bytes.
	# Just like a number of base 94 convert to decimal, each chunk is a number.
	result = bnjoin(
		_intto_byte((((((((((
				 b94nums[data[i    ]] # byte 11
		  * 94 + b94nums[data[i + 1]] # byte 10
		) * 94 + b94nums[data[i + 2]] # byte 9
		) * 94 + b94nums[data[i + 3]] # byte 8
		) * 94 + b94nums[data[i + 4]] # byte 7
		) * 94 + b94nums[data[i + 5]] # byte 6
		) * 94 + b94nums[data[i + 6]] # byte 5
		) * 94 + b94nums[data[i + 7]] # byte 4
		) * 94 + b94nums[data[i + 8]] # byte 3
		) * 94 + b94nums[data[i + 9]] # byte 2
		) * 94 + b94nums[data[i +10]] # byte 1
		, 9, 'big')
		 for i in range(0, datlen, 11)
	)
	
	if padding :
		result = result[: -padding]

	return result

if __name__ == '__main__' :
	from os import system as osSys, name as osName
	osSys('cls' if osName in ('nt', 'dos') else 'clear')

	def c(size, depth=0, pint=('b', 'Kb', 'Mb', 'Gb', 'Tb', 'Pb'))-> str :
		if size > 1024 :
			return c(size/1024, depth+1)
		return '%f%s' % (size, pint[depth])
		
	try :
		from base91 import encode as b91encode, decode as b91decode # type: ignore
	except :
		b91decode = b91encode = lambda _ : str(print('(No Base91 Modular)', end=''))

	from base64 import b64encode, b64decode, b85encode, b85decode
	
	from time import perf_counter
	from os import urandom as osUrandom
	data = osUrandom(1048575)#hash(perf_counter()) & 1048575*16//8)
	
	def _test_mes(base, enData, norData=data) :
		'''A function uses to test the encode and decode function.'''
		t = perf_counter()
		deData = eval('b%ddecode' % base)(enData)
		t = perf_counter() - t
		print('base%d done decoded in %f seconds.' % (base, t))
		if deData == norData :
			return 'Succese! Base%s-encoded data can 100%% revert to normal data.' % (base)
		from difflib import SequenceMatcher as dataSimilarity
		bdesim = dataSimilarity(None, deData, norData).quick_ratio()
		return 'Bad new! Cannot revert %f%% of base%d-encoded data.' % (1e2 - 1e2*bdesim, base)

	def _test_en(base, norData=data) :
		t = perf_counter()
		enTest = eval('b%dencode'%base)(norData)
		t = perf_counter() - t
		print('base%d done encoded in %f seconds.' % (base, t))
		return enTest

	en64,en85,en91,en94 = _test_en(64),_test_en(85),_test_en(91),_test_en(94)
	lno,l64,l85,l91,l94 = len(data), len(en64), len(en85), len(en91), len(en94)
	la = lambda n : 100*n / lno - 100
	
	print()
	#print('normal: %s\nbase64: %s\nbase85: %s\nbase91: %s\nbase94: %s\n'%(data, en64, en85, en91, en94))
	print('normal: %s\nbase64: %d(%.2f%%)\nbase85: %d(%.2f%%)\nbase91: %d(%.2f%%)\nbase94: %d(%.2f%%)\n'%(c(lno), l64, la(l64), l85, la(l85), l91, la(l91), l94, la(l94)))
	print(          '\nbase64: %s\nbase85: %s\nbase91: %s\nbase94: %s\n'%(_test_mes(64, en64), _test_mes(85, en85), _test_mes(91, en91), _test_mes(94, en94)))
```

python/base94/_base94.pyi

```_base94.pyi
def b94encode(data: bytes) -> bytes: ...
def b94decode(data: bytes) -> bytes: ...
```

python/base94/__init__.py

```__init__.py
__all__ = ['b94encode', 'b94decode', 'rs_b94encode', 'rs_b94decode', 'py_b94encode', 'py_b94decode']

from .base94 import b94encode as py_b94encode, b94decode as py_b94decode

try :
	from ._base94 import b94encode, b94decode
	rs_b94encode, rs_b94decode = b94encode, b94decode
except ImportError :
	rs_b94encode, rs_b94decode = None, None

b94encode = py_b94encode if rs_b94encode is None else rs_b94encode

b94decode = py_b94decode if rs_b94decode is None else rs_b94decode
```

python/benchmarks/performance_test.py

```performance_test.py
import timeit
import os
import sys
from functools import partial

# æµ‹è¯•æ•°æ®å¤§å°é…ç½®ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰
TEST_CASES = [
    ("10KB", 10*1024),
    ("100KB", 100*1024),
    ("1MB", 1024*1024),
    ("10MB", 10*1024*1024),
]

def verify_correctness(impl):
    """éªŒè¯å®ç°æ­£ç¡®æ€§"""
    test_data = b"Base94 Test String"
    try:
        encoded = impl['encode'](test_data)
        decoded = impl['decode'](encoded)
        assert decoded == test_data, "Decode result mismatch"
    except Exception as e:
        print(f"âš ï¸ {impl['name']} å®ç°éªŒè¯å¤±è´¥: {str(e)}")
        sys.exit(1)

def run_benchmark(impl, data):
    """æ‰§è¡Œå•ä¸ªåŸºå‡†æµ‹è¯•"""
    results = {'encode': [], 'decode': []}
    
    # é¢„çƒ­ç¼“å­˜
    impl['encode'](data[:1024])
    impl['decode'](impl['encode'](data[:1024]))
    
    # ç¼–ç æµ‹è¯•
    encode_timer = timeit.Timer(
        partial(impl['encode'], data),
        setup='gc.enable()'
    )
    results['encode'] = encode_timer.repeat(number=10, repeat=3)
    
    # è§£ç æµ‹è¯•
    encoded_data = impl['encode'](data)
    decode_timer = timeit.Timer(
        partial(impl['decode'], encoded_data),
        setup='gc.enable()'
    )
    results['decode'] = decode_timer.repeat(number=10, repeat=3)
    
    return {
        'encode': min(results['encode']),
        'decode': min(results['decode'])
    }

def format_speed(bytes_size, seconds):
    """è®¡ç®—å¹¶æ ¼å¼åŒ–é€Ÿåº¦"""
    if seconds == 0:
        return "âˆ MB/s"
    mb = bytes_size / (1024*1024)
    return f"{mb/seconds:.2f} MB/s"

def main():
    try:
        # å¯¼å…¥ä¸åŒå®ç°
        import base94
        
        implementations = [
            {
                'name': 'Python Native',
                'encode': base94.py_b94encode,
                'decode': base94.py_b94decode
            },
            {
                'name': 'Rust Accelerated',
                'encode': base94.rs_b94encode,
                'decode': base94.rs_b94decode
            }
        ]
        
        # é¢„å…ˆéªŒè¯æ‰€æœ‰å®ç°
        for impl in implementations:
            verify_correctness(impl)
        
        print("ğŸš€ å¼€å§‹æ€§èƒ½åŸºå‡†æµ‹è¯•...\n")
        
        # æ‰§è¡Œæµ‹è¯•
        results = {}
        for case_name, data_size in TEST_CASES:
            print(f"\nğŸ”§ ç”Ÿæˆæµ‹è¯•æ•°æ®: {case_name}...")
            data = os.urandom(data_size)
            results[case_name] = []
            
            for impl in implementations:
                print(f"ğŸ” æµ‹è¯• {impl['name']} ({case_name})...")
                try:
                    stats = run_benchmark(impl, data)
                    results[case_name].append({
                        'name': impl['name'],
                        'encode_time': stats['encode'],
                        'decode_time': stats['decode'],
                        'encode_speed': format_speed(data_size, stats['encode']),
                        'decode_speed': format_speed(data_size, stats['decode'])
                    })
                except MemoryError:
                    print(f"âŒ å†…å­˜ä¸è¶³ï¼Œè·³è¿‡ {case_name} æµ‹è¯•")
                    continue
        
        # æ‰“å°ç»“æœè¡¨æ ¼
        print("\nğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»:")
        print("| æ•°æ®å¤§å° | å®ç°ç‰ˆæœ¬         | ç¼–ç æ—¶é—´ (s) | è§£ç æ—¶é—´ (s) | ç¼–ç é€Ÿåº¦   | è§£ç é€Ÿåº¦   |")
        print("|----------|------------------|--------------|--------------|------------|------------|")
        for case in TEST_CASES:
            case_name = case[0]
            for result in results.get(case_name, []):
                print(f"| {case_name:8} | {result['name']:16} | "
                      f"{result['encode_time']:12.4f} | {result['decode_time']:12.4f} | "
                      f"{result['encode_speed']:10} | {result['decode_speed']:10} |")
        
        # æ‰“å°æ€§èƒ½æå‡æ¯”ä¾‹
        print("\nğŸ’¹ æ€§èƒ½æå‡æ¯”ä¾‹:")
        for case in TEST_CASES:
            case_name = case[0]
            if len(results.get(case_name, [])) == 2:
                py = results[case_name][0]
                rs = results[case_name][1]
                encode_ratio = py['encode_time'] / rs['encode_time']
                decode_ratio = py['decode_time'] / rs['decode_time']
                print(f"{case_name}:")
                print(f"  ç¼–ç é€Ÿåº¦æå‡: {encode_ratio:.1f}x")
                print(f"  è§£ç é€Ÿåº¦æå‡: {decode_ratio:.1f}x")
        
    except ImportError as e:
        print(f"âŒ å¯¼å…¥é”™è¯¯: {str(e)}")
        print("è¯·ç¡®ä¿å·²æ­£ç¡®å®‰è£…ï¼š")
        print("1. PythonåŸç”Ÿç‰ˆæœ¬: pip install base94")
        print("2. RuståŠ é€Ÿç‰ˆæœ¬: maturin develop --release")
        sys.exit(1)

if __name__ == "__main__":
    main()
```

python/tests/test_cons_ende.py

```test_cons_ende.py
from os import urandom
from base94 import b94encode, b94decode
from base94 import py_b94encode, py_b94decode
from base94 import rs_b94encode, rs_b94decode

def test_cons_ende_default():
    for i in range(1, 512):
        assert b94decode(b94encode(plain:=urandom(i))) == plain

def test_cons_ende_py():
    for i in range(1, 512):
        assert py_b94decode(py_b94encode(plain:=urandom(i))) == plain

def test_cons_ende_rs():
    for i in range(1, 512):
        assert rs_b94decode(rs_b94encode(plain:=urandom(i))) == plain
```

python/tests/test_cons_pyrs.py

```test_cons_pyrs.py
from os import urandom
from base94 import py_b94encode, py_b94decode
from base94 import rs_b94encode, rs_b94decode

def test_cons_encode_pyrs():
    """
    Test base94 encoding.
    """
    for i in range(1, 512):
        assert py_b94encode(plain:=urandom(i)) == rs_b94encode(plain)
        
def test_cons_decode_pyrs():
    """
    Test base94 decoding.
    """
    for i in range(1, 512):
        print(rs_b94encode(urandom(i)))
        assert py_b94decode(ub94d := py_b94encode(urandom(i))) == rs_b94decode(ub94d)
        assert py_b94decode(ub94d := rs_b94encode(urandom(i))) == rs_b94decode(ub94d)
```

python/tests/test_decode.py

```test_decode.py
from os import urandom
from base94 import b94decode
from base94 import py_b94decode
from base94 import rs_b94decode

def test_b94decode_default():
    """
    Test base94 encoding.
    """
    assert b94decode(b'') == b''
    assert b94decode(b'Wg\\`y') == b'ABC'
    assert b94decode(b'Q<-{{@fN') == b'123456'

def test_b94decode_py():
    """
    Test base94 encoding.
    """
    assert py_b94decode(b'') == b''
    assert py_b94decode(b'Wg\\`y') == b'ABC'
    assert py_b94decode(b'Q<-{{@fN') == b'123456'

def test_b94decode_rs():
    """
    Test base94 encoding.
    """
    assert rs_b94decode(b'') == b''
    assert rs_b94decode(b'Wg\\`y') == b'ABC'
    assert rs_b94decode(b'Q<-{{@fN') == b'123456'
```

python/tests/test_encode.py

```test_encode.py
from os import urandom
from base94 import b94encode
from base94 import py_b94encode
from base94 import rs_b94encode

def test_b94encode_default():
    """
    Test base94 encoding.
    """
    assert b94encode(b'') == b''
    assert b94encode(b'ABC') == b'Wg\\`y'
    assert b94encode(b'123456') == b'Q<-{{@fN'

def test_b94encode_py():
    """
    Test base94 encoding.
    """
    assert py_b94encode(b'') == b''
    assert py_b94encode(b'ABC') == b'Wg\\`y'
    assert py_b94encode(b'123456') == b'Q<-{{@fN'

def test_b94encode_rs():
    """
    Test base94 encoding.
    """
    assert rs_b94encode(b'') == b''
    assert rs_b94encode(b'ABC') == b'Wg\\`y'
    assert rs_b94encode(b'123456') == b'Q<-{{@fN'
```

src/lib.rs

```lib.rs
// lib.rs
// Implementation of Base94 encode and decode in Rust for Python 3.
//
// THE GPLv3 LICENSE
// Copyleft (Â©) 2025 hibays
//

use lazy_static::lazy_static;
use pyo3::prelude::*;

lazy_static! {
    // Base94 å­—æ¯è¡¨ï¼ˆä¸ Python å®ç°å®Œå…¨ä¸€è‡´ï¼‰
    static ref B94_ENCODE_TAB: [u8; 94] = [
        b'A', b'B', b'C', b'D', b'E', b'F', b'G', b'H', b'I', b'J', b'K', b'L', b'M',
        b'N', b'O', b'P', b'Q', b'R', b'S', b'T', b'U', b'V', b'W', b'X', b'Y', b'Z',
        b'a', b'b', b'c', b'd', b'e', b'f', b'g', b'h', b'i', b'j', b'k', b'l', b'm',
        b'n', b'o', b'p', b'q', b'r', b's', b't', b'u', b'v', b'w', b'x', b'y', b'z',
        b'0', b'1', b'2', b'3', b'4', b'5', b'6', b'7', b'8', b'9', b'!', b'"', b'#',
        b'$', b'%', b'&', b'\'', b'(', b')', b'*', b'+', b',', b'-', b'.', b'/', b':',
        b';', b'<', b'=', b'>', b'?', b'@', b'[', b'\\', b']', b'^', b'_', b'`', b'{',
        b'|', b'}', b'~'
    ];

    // å¿«é€Ÿè§£ç è¡¨ï¼ˆ256 é•¿åº¦æ•°ç»„ï¼Œç›´æ¥é€šè¿‡ ASCII å€¼ç´¢å¼•ï¼‰
    static ref B94_DECODE_TAB: [u8; 256] = {
        let mut tab = [0xFF; 256];
        for (i, &c) in B94_ENCODE_TAB.iter().enumerate() {
            tab[c as usize] = i as u8;
        }
        tab
    };

    // é¢„ç”ŸæˆåŒå­—ç¬¦ç¼–ç è¡¨ï¼ˆ94x94 ç»„åˆï¼‰
    static ref B94_ENCODE_TAB2: [[u8; 2]; 94*94] = {
        let mut tab: [[u8; 2]; 94*94] = [[0; 2]; 94*94];
        let mut index = 0;
        for &c1 in B94_ENCODE_TAB.iter() {
            for &c2 in B94_ENCODE_TAB.iter() {
                tab[index] = [c1, c2];
                index += 1;
            }
        }
        tab
    };
}

/// Base94 ç¼–ç ï¼ˆRust åŠ é€Ÿç‰ˆï¼‰
fn b94_encode_rust(data: &[u8]) -> Vec<u8> {
    let orig_len = data.len();
    let padding = (9 - (orig_len % 9)) % 9;
    let data = if padding > 0 {
        let mut padded = data.to_vec();
        padded.extend(vec![0u8; padding]);
        padded
    } else {
        data.to_vec()
    };

    let mut output = Vec::with_capacity((data.len() / 9) * 11);
    for chunk in data.chunks(9) {
        // å°† 9 å­—èŠ‚è½¬æ¢ä¸ºå¤§ç«¯ u128
        let mut n_bytes = [0u8; 16];
        n_bytes[7..16].copy_from_slice(chunk);
        let n = u128::from_be_bytes(n_bytes);

        // åˆ†è§£ä¸º 6 ä¸ªéƒ¨åˆ†
        let (d8_9, rem1) = (n / 94, (n % 94) as usize);
        let (d6_7, rem2) = (d8_9 / 8836, (d8_9 % 8836) as usize);
        let (d4_5, rem3) = (d6_7 / 8836, (d6_7 % 8836) as usize);
        let (d2_3, rem4) = (d4_5 / 8836, (d4_5 % 8836) as usize);
        let (d1, rem5) = (d2_3 / 8836, (d2_3 % 8836) as usize);

        // æŸ¥è¡¨ç»„åˆç»“æœ
        output.extend_from_slice(&B94_ENCODE_TAB2[d1 as usize]);
        output.extend_from_slice(&B94_ENCODE_TAB2[rem5]);
        output.extend_from_slice(&B94_ENCODE_TAB2[rem4]);
        output.extend_from_slice(&B94_ENCODE_TAB2[rem3]);
        output.extend_from_slice(&B94_ENCODE_TAB2[rem2]);
        output.push(B94_ENCODE_TAB[rem1]);
    }

    // ç§»é™¤å¡«å……
    if padding > 0 {
        let len = output.len();
        output.truncate(len - padding);
    }
    output
}

/// Base94 è§£ç ï¼ˆRust åŠ é€Ÿç‰ˆï¼‰
fn b94_decode_rust(data: &[u8]) -> Result<Vec<u8>, String> {
    let orig_len = data.len();
    let padding = (11 - (orig_len % 11)) % 11;
    let data = if padding > 0 {
        let mut padded = data.to_vec();
        padded.extend(vec![b'~'; padding]);
        padded
    } else {
        data.to_vec()
    };

    let mut output = Vec::with_capacity((data.len() / 11) * 9);
    for chunk in data.chunks(11) {
        let mut num = 0u128;
        for &c in chunk {
            let digit = B94_DECODE_TAB[c as usize];
            if digit == 0xFF {
                return Err(format!("Invalid character: {}", c as char));
            }
            num = num * 94 + digit as u128;
        }

        // å°† u128 è½¬æ¢å› 9 å­—èŠ‚å¤§ç«¯æ ¼å¼
        let bytes = num.to_be_bytes();
        output.extend_from_slice(&bytes[7..16]);
    }

    // ç§»é™¤å¡«å……
    if padding > 0 {
        let len = output.len();
        output.truncate(len - padding);
    }
    Ok(output)
}

// PyO3 ç»‘å®š
#[pyfunction]
fn b94encode(data: &[u8]) -> PyResult<Vec<u8>> {
    Ok(b94_encode_rust(data))
}

#[pyfunction]
fn b94decode(data: &[u8]) -> PyResult<Vec<u8>> {
    b94_decode_rust(data).map_err(|e| PyErr::new::<pyo3::exceptions::PyValueError, _>(e))
}

#[pymodule]
fn _base94(_py: Python<'_>, module: &Bound<'_, PyModule>) -> PyResult<()> {
    module.add_function(wrap_pyfunction!(b94encode, module)?)?;
    module.add_function(wrap_pyfunction!(b94decode, module)?)?;
    Ok(())
}
```
