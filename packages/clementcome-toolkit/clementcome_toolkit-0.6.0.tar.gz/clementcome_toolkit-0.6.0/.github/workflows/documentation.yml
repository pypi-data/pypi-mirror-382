name: Documentation

on:
    push:
        paths-ignore:
            - "docs/**"
            - "docs_preparation/**"

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4
              with:
                token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
            
            - name: Install uv
              uses: astral-sh/setup-uv@v4
              with:
                version: "latest"
            
            - name: Set up Python 3.12
              run: uv python install 3.12
            
            - name: Install dependencies
              run: uv sync --only-group docs
            
            - name: Build documentation
              run: |
                uv run sphinx-apidoc -o docs/reference cc_tk
            
            - name: Commit generated documentation
              uses: stefanzweifel/git-auto-commit-action@v5
              with:
                commit_message: Automatic documentation build
