{# templates/enap_designsystem/pages/capsula_index_page.html #}
{% load static wagtailcore_tags capsula_tags %}

{% block extra_css %}
<style>
    /* ============================================ */
    /* LAYOUT PRINCIPAL */
    /* ============================================ */
    
    .capsulas-busca-page {
        background: #f8f9fa;
        min-height: 100vh;
    }
    
    .capsulas-busca-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem 1rem;
        display: grid;
        grid-template-columns: 350px 1fr;
        gap: 2rem;
    }
    
    @media (max-width: 968px) {
        .capsulas-busca-container {
            grid-template-columns: 1fr;
        }
    }
    
    /* ============================================ */
    /* SIDEBAR DE BUSCA E FILTROS */
    /* ============================================ */
    
    .busca-sidebar {
        position: sticky;
        top: 2rem;
        height: fit-content;
    }
    
    .busca-input-wrapper {
        position: relative;
        margin-bottom: 1.5rem;
    }
    
    .busca-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
        width: 20px;
        height: 20px;
    }
    
    .busca-input {
        width: 100%;
        padding: 0.875rem 1rem 0.875rem 3rem;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 0.9375rem;
        background: white;
    }
    
    .busca-input:focus {
        outline: 2px solid #0c5a5a;
        outline-offset: 0;
        border-color: #0c5a5a;
    }
    
    .filtros-avancados {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        overflow: hidden;
    }
    
    .filtros-avancados-header {
        padding: 1rem 1.25rem;
        background: white;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        user-select: none;
    }
    
    .filtros-avancados-header:hover {
        background: #f9fafb;
    }
    
    .filtros-avancados-titulo {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
        color: #0c5a5a;
        font-size: 1rem;
    }
    
    .filtros-icon {
        width: 20px;
        height: 20px;
        color: #0c5a5a;
    }
    
    .toggle-icon {
        width: 20px;
        height: 20px;
        transition: transform 0.2s;
    }
    
    .filtros-avancados-header[aria-expanded="false"] .toggle-icon {
        transform: rotate(-90deg);
    }
    
    .filtros-content {
        padding: 1.5rem 1.25rem;
    }
    
    .filtros-content[hidden] {
        display: none;
    }
    
    /* Grupo de filtros */
    .filtro-grupo {
        border: none;
        padding: 0;
        margin: 0 0 1.75rem;
    }
    
    .filtro-grupo:last-child {
        margin-bottom: 0;
    }
    
    .filtro-grupo-titulo {
        font-size: 0.9375rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.75rem;
        display: block;
    }
    
    .filtro-opcoes {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    /* Checkbox customizado */
    .filtro-checkbox {
        display: flex;
        align-items: center;
        cursor: pointer;
        padding: 0.375rem 0;
    }
    
    .filtro-checkbox input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
        margin-right: 0.625rem;
        flex-shrink: 0;
        accent-color: #0c5a5a;
    }
    
    .checkbox-label {
        font-size: 0.9375rem;
        color: #374151;
    }
    
    .filtro-checkbox:hover .checkbox-label {
        color: #0c5a5a;
    }
    
    /* ============================================ */
    /* ÁREA DE RESULTADOS */
    /* ============================================ */
    
    .resultados-area {
        min-width: 0;
    }
    
    .resultados-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .resultados-count {
        font-size: 1.125rem;
        font-weight: 600;
        color: #1f2937;
    }
    
    .resultados-sort {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .sort-label {
        font-size: 0.875rem;
        color: #6b7280;
    }
    
    .sort-select {
        padding: 0.5rem 2rem 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.9375rem;
        background: white;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%236B7280' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
    }
    
    .sort-select:focus {
        outline: 2px solid #0c5a5a;
        outline-offset: 0;
        border-color: #0c5a5a;
    }
    
    /* ============================================ */
    /* GRID DE CÁPSULAS */
    /* ============================================ */
    
    .capsulas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 1.5rem;
    }
    
    @media (max-width: 768px) {
        .capsulas-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .capsula-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 1.75rem;
        transition: all 0.2s ease;
        display: flex;
        flex-direction: column;
    }
    
    .capsula-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-color: #0c5a5a;
    }
    
    .capsula-card-icon {
        width: 48px;
        height: 48px;
        background: #0c5a5a;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        flex-shrink: 0;
    }
    
    .capsula-card-icon svg {
        width: 24px;
        height: 24px;
        color: white;
    }
    
    .capsula-card-titulo {
        font-size: 1.125rem;
        font-weight: 600;
        color: #0c5a5a;
        margin-bottom: 0.75rem;
        line-height: 1.4;
        min-height: 3rem;
    }
    
    .capsula-card-titulo a {
        color: inherit;
        text-decoration: none;
    }
    
    .capsula-card-titulo a:hover {
        text-decoration: underline;
    }
    
    .capsula-card-descricao {
        font-size: 0.9375rem;
        color: #6b7280;
        line-height: 1.6;
        margin-bottom: 1.25rem;
        flex-grow: 1;
    }
    
    /* Tags de deficiência */
    .capsula-tags-deficiencia {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .tag-deficiencia {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.25rem 0.625rem;
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: 16px;
        font-size: 0.8125rem;
        color: #0c5a5a;
    }
    
    .tag-deficiencia-icon {
        width: 14px;
        height: 14px;
        flex-shrink: 0;
    }
    
    /* Badge de prioridade */
    .capsula-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.25rem 0.75rem;
        border-radius: 16px;
        font-size: 0.8125rem;
        font-weight: 600;
        margin-bottom: 1rem;
        width: fit-content;
    }
    
    .capsula-badge-obrigatorio {
        background: #fef2f2;
        color: #dc2626;
        border: 1px solid #fecaca;
    }
    
    .capsula-badge-recomendado {
        background: #eff6ff;
        color: #2563eb;
        border: 1px solid #bfdbfe;
    }
    
    .badge-icon {
        width: 14px;
        height: 14px;
    }
    
    /* Tags de recurso */
    .capsula-tags-recurso {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1.25rem;
        padding-top: 1rem;
        border-top: 1px solid #f3f4f6;
    }
    
    .tag-recurso {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.25rem 0.625rem;
        background: #f9fafb;
        border-radius: 6px;
        font-size: 0.8125rem;
        color: #4b5563;
    }
    
    .tag-recurso-icon {
        width: 14px;
        height: 14px;
    }
    
    /* Botão de ação */
    .capsula-card-btn {
        width: 100%;
        padding: 0.75rem 1.25rem;
        background: #0c5a5a;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9375rem;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
        text-decoration: none;
        display: block;
    }
    
    .capsula-card-btn:hover {
        background: #094444;
    }
    
    .capsula-card-btn:focus {
        outline: 2px solid #0c5a5a;
        outline-offset: 2px;
    }
    
    /* Estado vazio */
    .resultados-vazio {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
    }
    
    .resultados-vazio-icon {
        width: 64px;
        height: 64px;
        margin: 0 auto 1.5rem;
        color: #d1d5db;
    }
    
    .resultados-vazio h2 {
        font-size: 1.5rem;
        color: #374151;
        margin-bottom: 0.5rem;
    }
    
    .resultados-vazio p {
        color: #6b7280;
    }
    
    .resultados-vazio a {
        color: #0c5a5a;
        font-weight: 600;
        text-decoration: none;
    }
    
    .resultados-vazio a:hover {
        text-decoration: underline;
    }
</style>
{% endblock %}

{% block content %}
<div class="capsulas-busca-page">
    <div class="capsulas-busca-container">
        
        {# ============================================ #}
        {# SIDEBAR DE BUSCA E FILTROS #}
        {# ============================================ #}
        <aside class="busca-sidebar" role="complementary" aria-label="Busca e filtros">
            
            {# Campo de busca #}
            <div class="busca-input-wrapper">
                <svg class="busca-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <input 
                    type="text" 
                    class="busca-input" 
                    placeholder="Digite palavras-chave (ex: contraste, legendas)"
                    aria-label="Buscar cápsulas">
            </div>
            
            {# Filtros avançados #}
            <div class="filtros-avancados">
                <button class="filtros-avancados-header" 
                        aria-expanded="true"
                        aria-controls="filtros-content"
                        onclick="toggleFiltros()">
                    <div class="filtros-avancados-titulo">
                        <svg class="filtros-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                        </svg>
                        Filtros Avançados
                    </div>
                    <svg class="toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                
                <div id="filtros-content" class="filtros-content">
                    <form method="get" id="filtros-form">
                        
                        {# TIPO DE DEFICIÊNCIA #}
                        <fieldset class="filtro-grupo">
                            <legend class="filtro-grupo-titulo">Tipo de Deficiência</legend>
                            <div class="filtro-opcoes">
                                {% for value, label in opcoes_filtros.tipos_deficiencia %}
                                    <label class="filtro-checkbox">
                                        <input type="checkbox" 
                                               name="tipo_deficiencia" 
                                               value="{{ value }}"
                                               {% if value in filtros_ativos.tipo_deficiencia %}checked{% endif %}
                                               onchange="this.form.submit()">
                                        <span class="checkbox-label">{{ label }}</span>
                                    </label>
                                {% endfor %}
                            </div>
                        </fieldset>
                        
                        {# FORMATO DE AÇÃO #}
                        <fieldset class="filtro-grupo">
                            <legend class="filtro-grupo-titulo">Formato de Ação de Desenvolvimento</legend>
                            <div class="filtro-opcoes">
                                {% for value, label in opcoes_filtros.formatos_acao %}
                                    <label class="filtro-checkbox">
                                        <input type="checkbox" 
                                               name="formato_acao" 
                                               value="{{ value }}"
                                               {% if value in filtros_ativos.formato_acao %}checked{% endif %}
                                               onchange="this.form.submit()">
                                        <span class="checkbox-label">{{ label }}</span>
                                    </label>
                                {% endfor %}
                            </div>
                        </fieldset>
                        
                        {# TIPO DE RECURSO #}
                        <fieldset class="filtro-grupo">
                            <legend class="filtro-grupo-titulo">Tipo de Recurso</legend>
                            <div class="filtro-opcoes">
                                {% for value, label in opcoes_filtros.tipos_recurso %}
                                    <label class="filtro-checkbox">
                                        <input type="checkbox" 
                                               name="tipo_recurso" 
                                               value="{{ value }}"
                                               {% if value in filtros_ativos.tipo_recurso %}checked{% endif %}
                                               onchange="this.form.submit()">
                                        <span class="checkbox-label">{{ label }}</span>
                                    </label>
                                {% endfor %}
                            </div>
                        </fieldset>
                        
                    </form>
                </div>
            </div>
            
        </aside>
        
        {# ============================================ #}
        {# ÁREA DE RESULTADOS #}
        {# ============================================ #}
        <main class="resultados-area" role="main">
            
            <div class="resultados-header">
                <div class="resultados-count">
                    {{ total_resultados }} cápsula{{ total_resultados|pluralize:",s" }} encontrada{{ total_resultados|pluralize:",s" }}
                </div>
                
                <div class="resultados-sort">
                    <label for="sort-select" class="sort-label">Relevância</label>
                    <select id="sort-select" class="sort-select">
                        <option value="relevancia">Relevância</option>
                        <option value="recente">Mais recentes</option>
                        <option value="titulo">A-Z</option>
                    </select>
                </div>
            </div>
            
            {% if capsulas %}
                <div class="capsulas-grid">
                    {% for capsula in capsulas %}
                        <article class="capsula-card">
                            <div class="capsula-card-icon">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                            </div>
                            
                            <h2 class="capsula-card-titulo">
                                <a href="{% pageurl capsula %}">{{ capsula.title }}</a>
                            </h2>
                            
                            <p class="capsula-card-descricao">
                                {{ capsula.resumo_card|default:"Aprenda sobre este importante aspecto da acessibilidade digital." }}
                            </p>
                            
                            {# Tags de deficiência #}
                            {% if capsula.tipos_deficiencia %}
                                <div class="capsula-tags-deficiencia">
                                    {% for tipo in capsula.get_tipos_deficiencia_display|slice:":2" %}
                                        <span class="tag-deficiencia">
                                            <svg class="tag-deficiencia-icon" fill="currentColor" viewBox="0 0 20 20">
                                                <circle cx="10" cy="10" r="4"></circle>
                                            </svg>
                                            {{ tipo }}
                                        </span>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            
                            {# Badge de prioridade #}
                            {% if capsula.prioridade %}
                                <div class="capsula-badge capsula-badge-{{ capsula.prioridade }}">
                                    <svg class="badge-icon" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    {{ capsula.get_prioridade_display }}
                                </div>
                            {% endif %}
                            
                            {# Tags de recurso #}
                            {% if capsula.tipos_recurso %}
                                <div class="capsula-tags-recurso">
                                    {% for recurso in capsula.get_tipos_recurso_display|slice:":3" %}
                                        <span class="tag-recurso">
                                            <svg class="tag-recurso-icon" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path>
                                            </svg>
                                            {{ recurso }}
                                        </span>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            
                            <a href="{% pageurl capsula %}" class="capsula-card-btn">
                                Acessar Cápsula
                            </a>
                        </article>
                    {% endfor %}
                </div>
                
            {% else %}
                <div class="resultados-vazio">
                    <svg class="resultados-vazio-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h2>Nenhuma cápsula encontrada</h2>
                    <p>Tente ajustar os filtros ou <a href="{{ page.url }}">limpe os filtros</a> para ver todas as cápsulas.</p>
                </div>
            {% endif %}
            
        </main>
        
    </div>
</div>

<script>
function toggleFiltros() {
    const header = document.querySelector('.filtros-avancados-header');
    const content = document.getElementById('filtros-content');
    const expanded = header.getAttribute('aria-expanded') === 'true';
    
    header.setAttribute('aria-expanded', !expanded);
    content.hidden = expanded;
}
</script>
{% endblock %}