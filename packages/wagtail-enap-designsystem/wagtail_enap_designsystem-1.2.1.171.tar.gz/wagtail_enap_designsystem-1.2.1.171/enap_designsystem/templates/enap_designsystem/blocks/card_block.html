{% load static %}
{% load wagtailcore_tags wagtailimages_tags %}

<!-- Adicionar o CSS mobile se não estiver em arquivo separado -->
<link rel="stylesheet" type="text/css" href="{% static 'enap_designsystem/blocks/cards.css' %}">

<div class="{{ value.type }} enap-card-wrapper">
    {% if value.type == 'card-bgimage' %}
        {% if value.image %}
            {% image value.image original format-webp as card_bg_img %}
            <div class="card-bgimage" style="background-image: url('{{ card_bg_img.url }}');">
        {% elif value.icone %}
            <i class="card-icone {{ value.icone }}"></i>
                <!-- Link overlay para o primeiro botão -->
                {% if value.links %}
                    {% for link_block in value.links %}
                        {% if forloop.first and link_block.block_type == 'button' %}
                            {% with button_value=link_block.value %}
                                {% if button_value.link_url %}
                                    <a href="{{ button_value.link_url }}" class="card-overlay-link" 
                                        {% if button_value.link_target %}target="{{ button_value.link_target }}"{% endif %}></a>
                                {% elif button_value.link_page %}
                                    <a href="{{ button_value.link_page.url }}" class="card-overlay-link"></a>
                                {% endif %}
                            {% endwith %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                
                <div class="wrapper-text-card-bgimage">
                    {% if value.title %}
                    <h2 class="h2-card" style="
                    display: -webkit-box;
                    -webkit-line-clamp: 2;
                    -webkit-box-orient: vertical;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    margin-bottom: 10px;
                  ">
                    {{ value.title }}
                  </h2>
                    {% endif %}

                    {% if value.description %}
                        <div class="p-card">{{ value.description|richtext }}</div>
                    {% endif %}

                    {% if value.links %}
                        <div class="wrapper-button-right">
                            <div class="card-buttons">
                                {% for link_block in value.links %}
                                    {% if link_block.block_type == 'button' %}
                                        {% include_block link_block %}
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    {% elif value.type == 'card-horizontal' %}
        <div class="card-horizontal-container">
            <!-- Link overlay para o primeiro botão -->
            {% if value.links %}
                {% for link_block in value.links %}
                    {% if forloop.first and link_block.block_type == 'button' %}
                        {% with button_value=link_block.value %}
                            {% if button_value.link_url %}
                                <a href="{{ button_value.link_url }}" class="card-overlay-link" 
                                    {% if button_value.link_target %}target="{{ button_value.link_target }}"{% endif %}></a>
                            {% elif button_value.link_page %}
                                <a href="{{ button_value.link_page.url }}" class="card-overlay-link"></a>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                {% endfor %}
            {% endif %}
            
            <div class="card-horizontal-image-container">
                {% if value.image %}
                    {% image value.image fill-800x450 format-webp preserve-svg as card_img %}
                    <div class="img-card" style="background-image: url('{{ card_img.url }}');"></div>
                {% elif value.icone %}
                    <i class="card-icone {{ value.icone }}"></i>
                {% endif %}
            </div>

            <div class="wrapper-text-card-horizontal">
                <div class="card-content-wrapper">
                    {% if value.title %}
                        <h2 class="h2-card">{{ value.title }}</h2>
                    {% endif %}

                    {% if value.description %}
                        <div class="p-card">{{ value.description|richtext }}</div>
                    {% endif %}
                </div>
                {% if value.links %}
                    <div class="wrapper-button-left">
                        <div class="card-buttons">
                            {% for link_block in value.links %}
                                {% if link_block.block_type == 'button' %}
                                    {% include_block link_block %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    {% elif value.type == 'card-horizontal-reverse' %}
        <div class="card-horizontal-reverse-container">
            <!-- Link overlay para o primeiro botão -->
            {% if value.links %}
                {% for link_block in value.links %}
                    {% if forloop.first and link_block.block_type == 'button' %}
                        {% with button_value=link_block.value %}
                            {% if button_value.link_url %}
                                <a href="{{ button_value.link_url }}" class="card-overlay-link" 
                                   {% if button_value.link_target %}target="{{ button_value.link_target }}"{% endif %}></a>
                            {% elif button_value.link_page %}
                                <a href="{{ button_value.link_page.url }}" class="card-overlay-link"></a>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                {% endfor %}
            {% endif %}
            
            <div class="wrapper-text-card-horizontal-reverse">
                <div class="card-content-wrapper">
                    {% if value.title %}
                        <h2 class="h2-card">{{ value.title }}</h2>
                    {% endif %}

                    {% if value.description %}
                        <div class="p-card">{{ value.description|richtext }}</div>
                    {% endif %}
                </div>

                {% if value.links %}
                    <div class="wrapper-button-left">
                        <div class="card-buttons">
                            {% for link_block in value.links %}
                                {% if link_block.block_type == 'button' %}
                                    {% include_block link_block %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            </div>

            <div class="card-horizontal-reverse-image-container">
                {% if value.image %}
                    {% image value.image fill-800x450 format-webp preserve-svg as card_img %}
                    <div class="img-card" style="background-image: url('{{ card_img.url }}');"></div>
                {% elif value.icone %}
                    <i class="card-icone {{ value.icone }}"></i>
                {% endif %}
            </div>
        </div>
    {% else %}
        {% if value.image %}
            {% image value.image fill-800x450 format-webp preserve-svg as card_img %}
            <div class="img-card" style="background-image: url('{{ card_img.url }}');"></div>
        {% elif value.icone %}
            <i class="card-icone {{ value.icone }}"></i>
        {% endif %}

        <div class="wrapper-text-button_card-terciary">
            <!-- Link overlay para o primeiro botão -->
            {% if value.links %}
                {% for link_block in value.links %}
                    {% if forloop.first and link_block.block_type == 'button' %}
                        {% with button_value=link_block.value %}
                            {% if button_value.link_url %}
                                <a href="{{ button_value.link_url }}" class="card-overlay-link" 
                                   {% if button_value.link_target %}target="{{ button_value.link_target }}"{% endif %}></a>
                            {% elif button_value.link_page %}
                                <a href="{{ button_value.link_page.url }}" class="card-overlay-link"></a>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                {% endfor %}
            {% endif %}
            
            <div class="wrapper-text-card">
                {% if value.title %}
                    <h2 class="h2-card{% if value.type == 'card-secondary' %}text-center{% endif %}{% if value.type == 'card-secondary' or value.type == 'card-terciary' %}white{% endif %}">{{ value.title }}</h2>
                {% endif %}

                {% if value.description %}
                    <div class="p-card{% if value.type == 'card-secondary' %}text-center{% endif %}{% if value.type == 'card-secondary' or value.type == 'card-terciary' %}white{% endif %}">{{ value.description|richtext }}</div>
                {% endif %}
            </div>

            {% if value.links %}
                {% if value.type == 'card-secondary' %}
                    <div class="wrapper-button-center">
                        <div class="card-buttons">
                            {% for link_block in value.links %}
                                {% if link_block.block_type == 'button' %}
                                    {% include_block link_block %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                {% elif value.type == 'card-terciary' %}
                    <div class="wrapper-button-right">
                        <div class="card-buttons">
                            {% for link_block in value.links %}
                                {% if link_block.block_type == 'button' %}
                                    {% include_block link_block %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <div class="wrapper-button-left">
                        <div class="card-buttons">
                            {% for link_block in value.links %}
                                {% if link_block.block_type == 'button' %}
                                    {% include_block link_block %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endif %}
        </div>
    {% endif %}
</div>
<style>
.card-icone{
    text-align: center;
    font-size: 72px;
    padding: 15px 0;
    {% if value.cor_texto_hex %}
    color: {{value.cor_texto_hex}};
    {% elif value.cor_texto %}
    color: {{value.cor_texto}};
    {% endif %}
}

.h2-card, ul {
    font-size: 20px;
}

.h2-card{
    font-weight: 600;
}

.h2-card, .p-card p{
    {% if value.cor_texto_hex %}
    color: {{value.cor_texto_hex}};
    {% elif value.cor_texto %}
    color: {{value.cor_texto}};
    {% endif %}
    text-align: {{ value.text_align }};
}
</style>