#!/usr/bin/env python3
"""
–ë–æ—Ç valera - —Å–æ–∑–¥–∞–Ω —Å –ø–æ–º–æ—â—å—é Smart Bot Factory
"""

import asyncio

from smart_bot_factory import (
    BotBuilder,
    event_handler,
    schedule_task,
    send_message_by_human
)

# =============================================================================
# –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
# =============================================================================

@event_handler("example_event", "–ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏—è")
async def handle_example_event(user_id: int, event_data: dict):
    """–ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏—è"""
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    await send_message_by_human(
        user_id=user_id,
        message_text="‚úÖ –°–æ–±—ã—Ç–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ!"
    )
    
    return {
        "status": "success",
        "message": "–°–æ–±—ã—Ç–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ"
    }

# =============================================================================
# –ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù–ù–´–ï –ó–ê–î–ê–ß–ò
# =============================================================================

@schedule_task("example_task", "–ü—Ä–∏–º–µ—Ä –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏")
async def example_task(user_id: int, message: str):
    """–ü—Ä–∏–º–µ—Ä –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏"""
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    await send_message_by_human(
        user_id=user_id,
        message_text=f"üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: {message}"
    )
    
    return {
        "status": "sent",
        "user_id": user_id,
        "message": message
    }

# =============================================================================
# –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø
# =============================================================================

async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    try:
        # –°–æ–∑–¥–∞–µ–º –∏ —Å–æ–±–∏—Ä–∞–µ–º –±–æ—Ç–∞
        bot_builder = BotBuilder("valera")
        await bot_builder.build()
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
        await bot_builder.start()
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}")
        raise

if __name__ == "__main__":
    asyncio.run(main())
