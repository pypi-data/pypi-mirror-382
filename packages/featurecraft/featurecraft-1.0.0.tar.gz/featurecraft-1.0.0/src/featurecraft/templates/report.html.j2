<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FeatureCraft Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2 { color: #333; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
        .card { border: 1px solid #ddd; border-radius: 8px; padding: 12px; }
        table { border-collapse: collapse; width: 100%; font-size: 13px; }
        th, td { border: 1px solid #ddd; padding: 6px 8px; text-align: left; }
        th { background: #f2f2f2; }
        .issue-WARN { color: #a66; font-weight: bold; }
        .issue-INFO { color: #555; }
        img { max-width: 100%; }
        .small { font-size: 12px; color: #666; }
        .mono { font-family: monospace; }
    </style>
</head>
<body>
    <h1>FeatureCraft Report</h1>
    <p class="small">Rows: {{ insights.n_rows }} | Cols: {{ insights.n_cols }} | Task: {{ insights.task.value }} | Target: {{ insights.target_name }}</p>

    <h2>Summary</h2>
    <div class="grid">
        <div class="card">
            <h3>Schema</h3>
            <ul>
                <li>Numeric: {{ summary.n_numeric }}</li>
                <li>Categorical: {{ summary.n_categorical }}</li>
                <li>Text: {{ summary.n_text }}</li>
                <li>Datetime: {{ summary.n_datetime }}</li>
            </ul>
        </div>
        <div class="card">
            <h3>Issues</h3>
            <table>
                <thead><tr><th>Severity</th><th>Column</th><th>Message</th></tr></thead>
                <tbody>
                    {% for issue in issues %}
                    <tr class="issue-{{ issue.severity }}">
                        <td>{{ issue.severity }}</td>
                        <td>{{ issue.column or "-" }}</td>
                        <td>{{ issue.message }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <h2>Column Profiles</h2>
    <table>
        <thead>
            <tr>
                <th>Column</th><th>dtype</th><th>card</th><th>missing</th><th>skew</th><th>outliers</th><th>num</th><th>cat</th><th>text</th><th>dt</th>
            </tr>
        </thead>
        <tbody>
            {% for p in profiles %}
            <tr>
                <td>{{ p.name }}</td>
                <td class="mono">{{ p.dtype }}</td>
                <td>{{ p.cardinality or "-" }}</td>
                <td>{{ "%.1f%%"|format(p.missing_rate * 100) }}</td>
                <td>{{ "%.2f"|format(p.skewness or 0) }}</td>
                <td>{{ "%.1f%%"|format((p.outlier_share or 0) * 100) }}</td>
                <td>{{ "✓" if p.is_numeric else "" }}</td>
                <td>{{ "✓" if p.is_categorical else "" }}</td>
                <td>{{ "✓" if p.is_text else "" }}</td>
                <td>{{ "✓" if p.is_datetime else "" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Plots</h2>
    <div class="grid">
        {% if figures.missingness %}
        <div class="card">
            <h3>Missingness</h3>
            <img src="data:image/png;base64,{{ figures.missingness }}" />
        </div>
        {% endif %}
        {% if figures.corr_heatmap %}
        <div class="card">
            <h3>Correlation Heatmap</h3>
            <img src="data:image/png;base64,{{ figures.corr_heatmap }}" />
        </div>
        {% endif %}
    </div>

    <h3>More Distributions</h3>
    <div class="grid">
        {% for key, img in figures.items() if key.startswith('dist_') %}
        <div class="card">
            <strong>{{ key }}</strong>
            <img src="data:image/png;base64,{{ img }}" />
        </div>
        {% endfor %}
    </div>

    <h3>Boxplots</h3>
    <div class="grid">
        {% for key, img in figures.items() if key.startswith('box_') %}
        <div class="card">
            <strong>{{ key }}</strong>
            <img src="data:image/png;base64,{{ img }}" />
        </div>
        {% endfor %}
    </div>

    <h3>Counts</h3>
    <div class="grid">
        {% for key, img in figures.items() if key.startswith('count_') %}
        <div class="card">
            <strong>{{ key }}</strong>
            <img src="data:image/png;base64,{{ img }}" />
        </div>
        {% endfor %}
    </div>

    <p class="small">Generated by FeatureCraft.</p>
</body>
</html>

