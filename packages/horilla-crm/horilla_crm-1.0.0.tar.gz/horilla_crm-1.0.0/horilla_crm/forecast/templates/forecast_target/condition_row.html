{% load horilla_tags %}
{% load static %}
<div class="flex items-center gap-2 mb-2 condition-row" data-row-id="{{ row_id }}" id="condition-row-{{ row_id }}">
    <div class="grid grid-cols-{{ condition_fields|length }} gap-2 flex-1">
        {% for field_name in condition_fields %}
            <div>
                <div id="id_{{ field_name }}_{{ row_id }}_container">
                    {% if field_name == 'assigned_to' %}
                        <select name="assigned_to_{{ row_id }}" 
                                class="js-example-basic-single headselect" 
                                id="id_assigned_to_{{ row_id }}">
                            <option value="">Select User</option>
                            {% for user in users %}
                                <option value="{{ user.id }}" 
                                        {% if submitted_condition_data|get_item:row_id|get_item:field_name == user.id|stringformat:"s" %}selected{% endif %}>
                                    {{ user.get_full_name|default:user.username }}
                                </option>
                            {% endfor %}
                        </select>
                    {% elif field_name == 'period' %}
                        <select name="period_{{ row_id }}" 
                                class="js-example-basic-single headselect" 
                                id="id_period_{{ row_id }}">
                            <option value="">Select Period</option>
                            {% for choice in period_choices %}
                                <option value="{{ choice.0 }}" 
                                        {% if submitted_condition_data|get_item:row_id|get_item:field_name == choice.0 %}selected{% endif %}>
                                    {{ choice.1 }}
                                </option>
                            {% endfor %}
                        </select>
                        {% elif field_name == 'forcasts_type' %}
                        <select name="forcasts_type_{{ row_id }}" 
                                class="js-example-basic-single headselect" 
                                id="id_forcasts_type_{{ row_id }}"
                                hx-post="{% url 'forecast:update_target_help_text' %}?row_id={{ row_id }}"
                                hx-target="{% if  row_id %}#target_amount_help_text_{{ row_id }}{% else %}#target_amount_help_text{% endif %}"
                                hx-swap="innerHTML"
                                hx-include="{% if  row_id %}#id_forcasts_type_{{ row_id }}{% else %}#id_forcasts_type_0{% endif %}"
                                hx-trigger="change">
                            <option value="">Select Forecast Type</option>
                            {% for choice in forecast_type_choices %}
                                <option value="{{ choice.0 }}" 
                                        {% if submitted_condition_data|get_item:row_id|get_item:field_name == choice.0 %}selected{% endif %}>
                                    {{ choice.1 }}
                                </option>
                            {% endfor %}
                        </select>
                    {% elif field_name == 'target_amount' %}
                        <input type="number" 
                               name="target_amount_{{ row_id }}" 
                               class="text-color-600 p-2 placeholder:text-xs pr-[40px] w-full border border-dark-50 rounded-md mt-1 focus-visible:outline-0 placeholder:text-dark-100 text-sm [transition:.3s] focus:border-primary-600"
                               placeholder="Enter target" 
                               step="0.01" 
                               min="0" 
                               id="id_target_amount_{{ row_id }}"
                               value="{{ submitted_condition_data|get_item:row_id|get_item:field_name|default:'' }}">
                               <div id="{% if  row_id %}target_amount_help_text_{{ row_id }}{% else %}target_amount_help_text{% endif %}" class="text-xs text-gray-500 mt-1">Enter the target amount</div>

                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>
    
    {% if row_id != "0" %}
        <button type="button" 
                class="remove-condition-row flex items-center justify-center w-6 h-6 text-red-500 hover:text-red-700"
                onclick="this.closest('.condition-row').remove();">
                <img src="{% static 'assets/icons/close-red.svg' %}" alt="Remove" class="w-3 h-3"/>

        </button>
    {% endif %}
</div>